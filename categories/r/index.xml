<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>r on Robin Lovelace&#39;s website. Energy. Transport. Technology. Change the World.</title>
    <link>/categories/r/</link>
    <description>Recent content in r on Robin Lovelace&#39;s website. Energy. Transport. Technology. Change the World.</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 25 Feb 2019 00:00:00 +0000</lastBuildDate>
    
        <atom:link href="/categories/r/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>stplanr paper published</title>
      <link>/2019/02/25/sustainable-transport-planning-with-r-stplanr-paper-published/</link>
      <pubDate>Mon, 25 Feb 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/02/25/sustainable-transport-planning-with-r-stplanr-paper-published/</guid>
      <description>


&lt;p&gt;I am very happy to announce that the paper &lt;em&gt;stplanr: A package for transport planning&lt;/em&gt; has been published in The R Journal &lt;span class=&#34;citation&#34;&gt;(Lovelace and Ellison 2018)&lt;/span&gt; üéâ.&lt;/p&gt;
&lt;p&gt;This is the result of around 3 years of work: it took us (co-author &lt;a href=&#34;https://business.sydney.edu.au/staff/richard.ellison&#34;&gt;Richard Ellison&lt;/a&gt; and me) over a year to get round to writing the paper after the &lt;strong&gt;stplanr&lt;/strong&gt; package was first released on &lt;a href=&#34;https://cran.r-project.org/package=stplanr&#34;&gt;CRAN&lt;/a&gt; in November 2015 (see its &lt;a href=&#34;https://cran.r-project.org/src/contrib/Archive/stplanr/&#34;&gt;archive on CRAN&lt;/a&gt; for details); it wasn‚Äôt until March 2017 that the paper was formally submitted.&lt;/p&gt;
&lt;p&gt;After that, it was in the review process for almost 2 years, before finally being published last week.&lt;a href=&#34;#fn1&#34; class=&#34;footnoteRef&#34; id=&#34;fnref1&#34;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; Confusingly, the paper has an official publication date of 2018, despite the second volume of The R Journal in 2018 actually being finished in 2019! See the &lt;a href=&#34;https://journal.r-project.org/archive/2018-1/&#34;&gt;current issue&lt;/a&gt; of The R Journal for all papers in this second 2018 volume. There are some interesting papers in there, not least an explanation of methods for visualising point density by &lt;span class=&#34;citation&#34;&gt;Evangelista and Beskow (2018)&lt;/span&gt;, and an explanation of &lt;em&gt;another&lt;/em&gt; pipe &lt;span class=&#34;citation&#34;&gt;(Mount and Zumel 2018)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Instead of going into the details of what the paper says (see the nicely formatted &lt;a href=&#34;https://journal.r-project.org/archive/2018/RJ-2018-053/RJ-2018-053.pdf&#34;&gt;pdf&lt;/a&gt; for that), I‚Äôd like to finish this post by saying a big THANK YOU to the editorial team behind The R Journal for such a high standard (better than many expensive journals I might add, The R Journal is volunteer-run to the best of my knowledge), especially Roger Bivand and John Verzani.&lt;/p&gt;
&lt;p&gt;Plans are afoot to build on the moment behind &lt;strong&gt;stplanr&lt;/strong&gt;, which originated as a place to store code that I was using to develop the Propensity to Cycle Tool (PCT, hosted at &lt;a href=&#34;http://www.pct.bike/&#34;&gt;www.pct.bike&lt;/a&gt;) &lt;span class=&#34;citation&#34;&gt;(Lovelace et al. 2017)&lt;/span&gt; and make additional, overdue improvements to the package. For more on that, please head-over to the issue tracker (input welcome) or take a read of the &lt;a href=&#34;https://journal.r-project.org/archive/2018/RJ-2018-053/RJ-2018-053.pdf#page=14&#34;&gt;final section&lt;/a&gt; of the just-publised paper.&lt;/p&gt;
&lt;div id=&#34;references&#34; class=&#34;section level2 unnumbered&#34;&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;div id=&#34;refs&#34; class=&#34;references&#34;&gt;
&lt;div id=&#34;ref-evangelista_geospatial_2018&#34;&gt;
&lt;p&gt;Evangelista, Paul F., and David Beskow. 2018. ‚ÄúGeospatial Point Density.‚Äù &lt;em&gt;The R Journal&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-lovelace_stplanr_2018&#34;&gt;
&lt;p&gt;Lovelace, Robin, and Richard Ellison. 2018. ‚ÄúStplanr: A Package for Transport Planning.‚Äù &lt;em&gt;The R Journal&lt;/em&gt; 10 (2): 7‚Äì23. doi:&lt;a href=&#34;https://doi.org/10.32614/RJ-2018-053&#34;&gt;10.32614/RJ-2018-053&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-lovelace_propensity_2017&#34;&gt;
&lt;p&gt;Lovelace, Robin, Anna Goodman, Rachel Aldred, Nikolai Berkoff, Ali Abbas, and James Woodcock. 2017. ‚ÄúThe Propensity to Cycle Tool: An Open Source Online System for Sustainable Transport Planning.‚Äù &lt;em&gt;Journal of Transport and Land Use&lt;/em&gt; 10 (1). doi:&lt;a href=&#34;https://doi.org/10.5198/jtlu.2016.862&#34;&gt;10.5198/jtlu.2016.862&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-mount_dot-pipe_2018&#34;&gt;
&lt;p&gt;Mount, John, and Nina Zumel. 2018. ‚ÄúDot-Pipe: An S3 Extensible Pipe for R.‚Äù &lt;em&gt;The R Journal&lt;/em&gt; 10 (2): 309‚Äì16.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;footnotes&#34;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&#34;fn1&#34;&gt;&lt;p&gt;I should say, that it was not the fault of The R Journal‚Äôs editorial team that it took so long to publish the paper: I asked for it to be put on hold while I completed the mammoth task of re-writing dozens of functions to support sf (see the pull request in which the &lt;a href=&#34;https://github.com/ropensci/stplanr/pull/198&#34;&gt;&lt;code&gt;sfr&lt;/code&gt;&lt;/a&gt; branch was merged into &lt;code&gt;master&lt;/code&gt; for the grizzly details).&lt;a href=&#34;#fnref1&#34;&gt;‚Ü©&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Aggregating lines, part II</title>
      <link>/2019/02/14/aggregating-lines-part-ii/</link>
      <pubDate>Thu, 14 Feb 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/02/14/aggregating-lines-part-ii/</guid>
      <description>


&lt;p&gt;The &lt;a href=&#34;https://www.robinlovelace.net/2018/10/27/aggregating-lines/&#34;&gt;previous post&lt;/a&gt; demonstrated a new method to aggregate overlapping lines. It showed how to combine 2 lines that have an area of overlap. More excitingly, it led to the creation of a new function in &lt;strong&gt;stplanr&lt;/strong&gt;, &lt;code&gt;overline_sf()&lt;/code&gt;, that lives in the development version of the package. The purpose of this post is to provide an update on the status of the work to refactor the &lt;code&gt;overline()&lt;/code&gt; function, in a human friendly alternative to discussion in the relevant GitHub issue: &lt;a href=&#34;https://github.com/ropensci/stplanr/issues/273&#34; class=&#34;uri&#34;&gt;https://github.com/ropensci/stplanr/issues/273&lt;/a&gt;&lt;/p&gt;
&lt;div id=&#34;set-up&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Set-up&lt;/h2&gt;
&lt;p&gt;To re-cap, these are the package versions we‚Äôll be using in this post (run this line to get the development version of stplanr if you want to reproduce the results):&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;remotes::install_github(&amp;quot;ropensci/stplanr&amp;quot;, ref = &amp;quot;refactor-overline&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The library is loaded and the input data from the previous post was loaded as follows:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(stplanr)
routes_fast_sf$value = 1
sl = routes_fast_sf[2:3, ]
sl$value = c(2, 5)
overline_sf2 = function(sl, attrib) {
  attrib = &amp;quot;value&amp;quot;
  attrib1 = paste0(attrib, &amp;quot;.1&amp;quot;)
  sl_intersection = sf::st_intersection(sl[1, attrib], sl[2, attrib])
  sl_intersection[[attrib]] = sl_intersection[[attrib]] + sl_intersection[[attrib1]]
  sl_intersection[[attrib1]] = NULL
  sl_seg = sf::st_difference(sl[attrib], sf::st_geometry(sl_intersection))
  rnet = rbind(sl_intersection, sl_seg)
  return(rnet)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This was used as the basis of a demonstration of how overline works, demonstrated in the following code chunk and resulting plot:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rnet = overline_sf(sl, &amp;quot;value&amp;quot;)
plot(rnet[&amp;quot;value&amp;quot;], lwd = rnet$value)
plot(sl[&amp;quot;value&amp;quot;], lwd = sl$value, col = sf::sf.colors(2, alpha = 0.5))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;dealing-with-many-lines&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Dealing with many lines&lt;/h2&gt;
&lt;p&gt;The above method worked with 2 lines but how can it be used to process many lines? Clearly the same function could be implemented on another line, but it would need to work from the 3 lines of the newly created &lt;code&gt;rnet&lt;/code&gt; object rather than the original 2 routes. Let‚Äôs introduce a 3&lt;sup&gt;rd&lt;/sup&gt; route into the equation, that does not intersect with this newly created &lt;strong&gt;rnet&lt;/strong&gt; object:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sl3 = routes_fast_sf[4, ]
rnet = overline_sf2(rnet, sl)
plot(rnet$geometry, lwd = rnet$value)
plot(sl3, col = &amp;quot;red&amp;quot;, add = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In this case the method of adding to rnet is simple: just add the entirety of the line to the &lt;code&gt;rnet&lt;/code&gt; object:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;attrib = &amp;quot;value&amp;quot;
rnet3 = rbind(rnet, sl3[attrib])
plot(rnet3$geometry, lwd = rnet3$value)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This works fine. In fact it works better than the original &lt;code&gt;overline&lt;/code&gt; function because it does not add the value of the existing thickest line in the previous figure onto the new line, a problem associated with &lt;code&gt;overline.sp()&lt;/code&gt; that is illustrated in the following code chunk and resulting figure:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sl1_3 = as(routes_fast_sf[2:4, ], &amp;quot;Spatial&amp;quot;)
rnet3_sp = overline(sl1_3, attrib = &amp;quot;value&amp;quot;)
plot(rnet3_sp, lwd = rnet3_sp$value)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A question that arises from the previous example is this: what if the next line intersects with the route network? It is no longer possible to simply add together two values. This can be illustrated by introducing 2 more lines:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sl4_5 = routes_fast_sf[5:6, ]
plot(rnet3$geometry, lwd = rnet3$value)
plot(sl4_5$geometry, col = &amp;quot;red&amp;quot;, add = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Both the new lines intersect with the newest part of the route network. This means that we cannot simply &lt;code&gt;rbind()&lt;/code&gt; them to it as we did for &lt;code&gt;sl3&lt;/code&gt;. They need to be dealt with separately.&lt;/p&gt;
&lt;p&gt;Before we deal with them, it‚Äôs worth taking some time to consider what we mean by ‚Äòintersect‚Äô. Intersection is actuall a specific type of geometric relation between 2 sets of features. We can see the type of relation by using the function &lt;code&gt;st_relate()&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;relations = sf::st_relate(sl4_5, rnet3)
relations
unique(as.vector(relations))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This shows us something important: although 2 elements (1 and 4) of &lt;code&gt;rnet&lt;/code&gt; relate &lt;em&gt;in some way&lt;/em&gt; to the new lines, only the 4&lt;sup&gt;th&lt;/sup&gt; feature has a linear, overlapping relation with it. That relation is &lt;code&gt;1F1F00102&lt;/code&gt; which, as far as I can tell, is not a &lt;a href=&#34;https://en.wikipedia.org/wiki/DE-9IM#Spatial_predicates&#34;&gt;named spatial predicate&lt;/a&gt; (&lt;code&gt;FF1F00102&lt;/code&gt; means ‚Äòintersects and touches‚Äô but does not have a linear overlap). This relation is what we need to decide whether or not to simply bind a new feature to the growing &lt;code&gt;rnet&lt;/code&gt;, whether we need to break it up (or at least part of it) into smaller lines before doing so (it also raises the wider question of which order should we do things).&lt;/p&gt;
&lt;p&gt;In the simple case of &lt;em&gt;whether&lt;/em&gt; to simply bind the next line (4) onto &lt;code&gt;rnet3&lt;/code&gt; the answer is simple now we know the string code associated with linear overlaps. First we‚Äôll test it on the previous example of &lt;code&gt;sl3&lt;/code&gt; and the original &lt;code&gt;rnet&lt;/code&gt; composed of 3 features:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;relate_rnet_3 = sf::st_relate(rnet, sl3, pattern = &amp;quot;1F1F00102&amp;quot;)
relate_rnet_3
any(lengths(relate_rnet_3))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The &lt;code&gt;FALSE&lt;/code&gt; meant there was no linear overlaps. So we simply used &lt;code&gt;rbind()&lt;/code&gt;. When we ask the same question of &lt;code&gt;rnet3&lt;/code&gt; and &lt;code&gt;sl4&lt;/code&gt;, however, the answer is &lt;code&gt;TRUE&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sl4 = sl4_5[1, ]
relate_rnet_4 = sf::st_relate(rnet3, sl4, pattern = &amp;quot;1F1F00102&amp;quot;)
relate_rnet_4
any(lengths(relate_rnet_4))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;How to proceed? We need to avoid &lt;code&gt;rnet&lt;/code&gt; objects containing any overlapping lines. Because &lt;code&gt;sl4&lt;/code&gt; overlaps with part of &lt;code&gt;rnet3&lt;/code&gt; we will need to remove the overlapping line, run the &lt;code&gt;overline_sf2()&lt;/code&gt; function, and then re-combine the result with the pre-existing route network object. We can split-up the &lt;code&gt;rnet3&lt;/code&gt; object into overlapping and non-overlapping features as follows:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sel_overlaps = lengths(relate_rnet_4) &amp;gt; 0
rnet_overlaps = rnet3[sel_overlaps, ]
rnet3_tmp = rnet3[!sel_overlaps, ]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can check that there is only one overlapping feature as follows:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;nrow(rnet_overlaps)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And we can proceed to join the two features together using our new function:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rnet_overlaps4 = overline_sf2(rbind(rnet_overlaps, sl4[attrib]))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Adding this back to the &lt;code&gt;rnet3&lt;/code&gt; object results in an larger &lt;code&gt;rnet&lt;/code&gt; object incorporating all the &lt;code&gt;value&lt;/code&gt; and &lt;code&gt;geometry&lt;/code&gt; column data we have so far:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rnet = rbind(rnet3_tmp, rnet_overlaps4)
plot(rnet$geometry, lwd = rnet$value)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The information provided so far informed the creation of the following function:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;stplanr::overline_sf&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This function made use of the slightly simpler individual route-joining function, and associated helper functions:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;stplanr::overline_sf2

stplanr::overlaps
stplanr::to_linestring&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Aside from being clunky, this approach has the additional flaw of not working. It works fine for lines 2 to 6 in &lt;code&gt;routes_fast_sf&lt;/code&gt;, as illustrated below.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;r6 = routes_fast_sf[2:6, ]
rnet6 = overline_sf(r6, attrib = &amp;quot;value&amp;quot;)
plot(rnet6)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A problem arises when we try to run the same command on the same data, but with one more line added. That will be the topic of the next post on aggregating lines to form route networks, which will also introduce a new function &lt;code&gt;overline2()&lt;/code&gt;, developed by my colleague &lt;a href=&#34;https://environment.leeds.ac.uk/transport/staff/964/dr-malcolm-morgan&#34;&gt;Malcolm Morgan&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;another-benchmark&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Another benchmark&lt;/h2&gt;
&lt;p&gt;To provide a taster of the new function, let‚Äôs see it in action in a benchmark on this latest route network consisting of the five lines illustrated in the previous plot. Again, we use &lt;code&gt;bench::mark()&lt;/code&gt; to benchmark each approach:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;bench::mark(check = FALSE,
  overline = stplanr::overline(r6, &amp;quot;value&amp;quot;),
  overline_sf = stplanr::overline_sf(r6, &amp;quot;value&amp;quot;),
  overline2 = stplanr::overline2(r6, &amp;quot;value&amp;quot;)
)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Again the results are not Earth-shattering and should be taken with a large pinch of salt: performance should not be evaluated against these relatively tiny datasets, but against the scale of datasets that the functions were designed to handle: city scale route networks involving thousands of overlapping lines. The same principle is used in the benchmarking section of the &lt;a href=&#34;https://h2oai.github.io/db-benchmark/&#34;&gt;h2oai website&lt;/a&gt;: focus on benchmarks that apply to the datasets you will actually be using. In this case, my hypothesis is that the geometric functions &lt;code&gt;overline()&lt;/code&gt; and &lt;code&gt;overline_sf()&lt;/code&gt; will perform disproportionately badly as the size of the input dataset grows (to be tested). Still, it is interesting to note that the new &lt;code&gt;overline2()&lt;/code&gt; function uses way more memory than the other functions. More next time!&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Aggregating lines, Part I</title>
      <link>/2018/10/27/aggregating-lines/</link>
      <pubDate>Sat, 27 Oct 2018 00:00:00 +0000</pubDate>
      
      <guid>/2018/10/27/aggregating-lines/</guid>
      <description>


&lt;div id=&#34;introduction&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;It‚Äôs been a busy 12 months but with the &lt;a href=&#34;https://geocompr.robinlovelace.net/&#34;&gt;Geocomputation with R&lt;/a&gt; book nearing completion&lt;a href=&#34;#fn1&#34; class=&#34;footnoteRef&#34; id=&#34;fnref1&#34;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; I‚Äôve finally found some time to update my blog and do a bit of thinking, about the tangled topic of line aggregation.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;why-aggregate-lines&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Why aggregate lines?&lt;/h2&gt;
&lt;p&gt;The transport ‚Äòflow‚Äô on any particular segment of the transport networks is the aggregate (sum) of trips that pass through it &lt;span class=&#34;citation&#34;&gt;(Hollander 2016)&lt;/span&gt;. Finding the flow across a transport network based on input data composed of individual routes, is therefore an aggregation problem. It requires a more complex solution than that provided by the &lt;code&gt;aggregate()&lt;/code&gt; function in the base R &lt;span class=&#34;citation&#34;&gt;(R Core Team 2018)&lt;/span&gt; package &lt;strong&gt;stats&lt;/strong&gt;, however, because the geometry of the output &lt;code&gt;LINESTRING&lt;/code&gt;s will be fundamentally different than the input &lt;code&gt;LINESTRINGS&lt;/code&gt; of the routes: a route network is composed of many small way segments, but a route is a single long &lt;code&gt;LINESTRING&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;aggregating-lines-with-overline-mki&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Aggregating lines with overline() MKI&lt;/h2&gt;
&lt;p&gt;Creating such a route network, with aggregated values per segment, is the problem that the &lt;a href=&#34;https://ropensci.github.io/stplanr/reference/overline.html&#34;&gt;&lt;code&gt;overline()&lt;/code&gt;&lt;/a&gt; function in the R package &lt;a href=&#34;https://github.com/ropensci/stplanr&#34;&gt;&lt;strong&gt;stplanr&lt;/strong&gt;&lt;/a&gt; was designed to solve (see a 3.5 yr-old question on &lt;a href=&#34;https://gis.stackexchange.com/questions/139681/overlaying-lines-and-aggregating-their-values-for-overlapping-segments&#34;&gt;gis.stackexchange.com&lt;/a&gt; for more context).&lt;/p&gt;
&lt;p&gt;The function works well and is the basis of the Route Network layer (MSOA) in the Propensity to Cycle Tool (&lt;a href=&#34;http://www.pct.bike/&#34;&gt;PCT&lt;/a&gt;). In fact it was developed precisely for this purpose, as illustrated in the image below, which shows a common visualization/analysis problem encountered by transport researchers when working with multiple routes: overlapping routes are not easy to identify from non-overlapping routes: notice the red lines in the centre of Leeds in the image look the same as the red lines on the outskirts, despite representing much more movement.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:unnamed-chunk-2&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/npct/pct-team/master/figures/early.png&#34; alt=&#34;Demonstration of the need for line aggregation from a very early version of the Propensity to Cycle Tool, developed at the &#39;Hack my Route&#39; data dive at [ODI Leeds](https://twitter.com/search?q=%23hackmyroute&amp;amp;src=typd).&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: Demonstration of the need for line aggregation from a very early version of the Propensity to Cycle Tool, developed at the ‚ÄòHack my Route‚Äô data dive at &lt;a href=&#34;https://twitter.com/search?q=%23hackmyroute&amp;amp;src=typd&#34;&gt;ODI Leeds&lt;/a&gt;.
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;To overcome the problem &lt;code&gt;overline()&lt;/code&gt; was born (credit to Barry Rowlingson who wrote the foundations of the function), and it works (on a tiny dataset of 2 lines) as follows:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(stplanr)
sl_sp = routes_fast[2:3, ]
sl_sp@data = data.frame(value = c(2, 5))
plot(sl_sp, lwd = 9, col = &amp;quot;yellow&amp;quot;)
rnet_sp = overline(sl_sp, attr = &amp;quot;value&amp;quot;)
plot(rnet_sp, add = TRUE, lwd = rnet_sp$value)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:unnamed-chunk-3&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;../../post/2018-10-27-aggregating-lines_files/figure-html/unnamed-chunk-3-1.png&#34; alt=&#34;Illustration of the overline() function for line aggregation in action on a tiny example dataset. Note the left-most line is wider than the two lines that feed into it, demonstrating how line aggregation can be used to estimate flow on a road network.&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 2: Illustration of the overline() function for line aggregation in action on a tiny example dataset. Note the left-most line is wider than the two lines that feed into it, demonstrating how line aggregation can be used to estimate flow on a road network.
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;The utility of such a function is illustrated in the figure below, which shows the original route network layer of the PCT in action over a similar area of Leeds:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:unnamed-chunk-4&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/npct/pct-team/master/figures/fastest-net-headingly.png&#34; alt=&#34;Early version of the route network layer in the Propensity to Cycle Tool.&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 3: Early version of the route network layer in the Propensity to Cycle Tool.
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;This works great and the resulting network is used for strategic network planning: you can download route network data in the ‚ÄòRegion data‚Äô tab of the PCT &lt;span class=&#34;citation&#34;&gt;(Lovelace et al. 2017)&lt;/span&gt;. The route network data for Leeds can, for example, be downloaded as a &lt;code&gt;.geojson&lt;/code&gt; file from &lt;a href=&#34;https://github.com/npct/pct-outputs-regional-notR/raw/master/commute/msoa/west-yorkshire/rnet.geojson&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;But there are some issues: the function works on the older &lt;code&gt;SpatialLinesDataFrame&lt;/code&gt; class defined in the &lt;strong&gt;sp&lt;/strong&gt; package &lt;span class=&#34;citation&#34;&gt;(&lt;span class=&#34;citeproc-not-found&#34; data-reference-id=&#34;pebesma_simple_2018&#34;&gt;&lt;strong&gt;???&lt;/strong&gt;&lt;/span&gt;)&lt;/span&gt;. This data class has been superseded by the simpler &lt;code&gt;sf&lt;/code&gt; class in the &lt;a href=&#34;https://github.com/r-spatial/sf&#34;&gt;&lt;strong&gt;sf&lt;/strong&gt;&lt;/a&gt; package, which is faster than &lt;strong&gt;sp&lt;/strong&gt; for &lt;a href=&#34;https://github.com/ATFutures/geobench&#34;&gt;some&lt;/a&gt; (if not many) operations. Another issue with &lt;code&gt;overline()&lt;/code&gt; is that in some cases when 2 lines meet, the resulting aggregated line can be longer than it should be. So there are performance and functionality issues to address. Rather than solve them all here, this post sets-out the issue using reproducible code and suggests next steps for a new &lt;code&gt;overline()&lt;/code&gt; function (or perhaps just an updated &lt;code&gt;overline.sf()&lt;/code&gt; function which currently just wraps &lt;code&gt;overline.sp()&lt;/code&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;aggregating-lines-with-sf&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Aggregating lines with sf&lt;/h2&gt;
&lt;p&gt;Rather that starting from scratch and writing a geographic algorithm from the ground-up, we will start by exploring solutions provided by existing packages, notably &lt;strong&gt;sf&lt;/strong&gt;, which provides an interface to the &lt;code&gt;GEOS&lt;/code&gt; library.&lt;/p&gt;
&lt;p&gt;Let‚Äôs start simple, with just 2 lines, which have an associated amount of flow (with illustrative values of 2 and 5 in this case):&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(stplanr)
sl = routes_fast_sf[2:3, ]
sl$value = c(2, 5)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;These lines clearly have a decent amount of overlap, which can be extracted using the function &lt;code&gt;st_intersection()&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sl_intersection = sf::st_intersection(sl[1, ], sl[2, ])
plot(sl$geometry, lwd = 9, col = sf::sf.colors(2, alpha = 0.5))
plot(sl_intersection, add = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:unnamed-chunk-6&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;../../post/2018-10-27-aggregating-lines_files/figure-html/unnamed-chunk-6-1.png&#34; alt=&#34;Illustration of the results of st_intersection&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 4: Illustration of the results of st_intersection
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Furthermore, we can find the aggregated value associated with this new segment as follows:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sl_intersection$value = sum(sl_intersection$value, sl_intersection$value.1)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We still do not have a full route network composed of 3 non-overlapping lines, however: the original lines need to be ‚Äòclipped‚Äô so that they do not overlap with &lt;code&gt;sl_intersection&lt;/code&gt;. This can be done as follows:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sl_seg1 = sf::st_difference(sl[1, ], sl_intersection)
sl_seg2 = sf::st_difference(sl[2, ], sl_intersection)
plot(sl$geometry, lwd = 9, col = sf::sf.colors(2, alpha = 0.5))
plot(sl_seg1, add = TRUE)
plot(sl_seg2, add = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2018-10-27-aggregating-lines_files/figure-html/Demonstration%20of%20%60st_difference()%60.-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We now have all the geographic components needed for a route network. The only remaining task is to combine them, using &lt;code&gt;rbind&lt;/code&gt;, right? Not quite: the following command fails:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rnet = rbind(sl_seg1, sl_seg2, sl_intersection)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error in rbind.data.frame(...): numbers of columns of arguments do not match&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Lesson: we need to be more careful in isolating the value to aggregate. We will therefore run the previous stages again, but with &lt;code&gt;attrib&lt;/code&gt; set to the attribute we would like to aggregate over (&lt;code&gt;value&lt;/code&gt; in this case):&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;attrib = &amp;quot;value&amp;quot;
attrib1 = paste0(attrib, &amp;quot;.1&amp;quot;)
sl_intersection = sf::st_intersection(sl[1, attrib], sl[2, attrib])
sl_intersection[[attrib]] = sl_intersection[[attrib]] + sl_intersection[[attrib1]]
sl_intersection[[attrib1]] = NULL&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That leaves us with a ‚Äòclean‚Äô object that only has a value (7) for the attribute column name we want (&lt;code&gt;value&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;On this basis we can proceed to create the other segments, keeping only the column we‚Äôre interested in. To save time and typing, we‚Äôll create both segments in a single command:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sl_seg = sf::st_difference(sl[attrib], sf::st_geometry(sl_intersection))
rnet = rbind(sl_intersection, sl_seg)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It worked! Now we‚Äôre in a position to plot the resulting route network, with ‚Äòwidth‚Äô proportional to the flow along each segment:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(rnet, lwd = rnet$value)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:unnamed-chunk-11&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;../../post/2018-10-27-aggregating-lines_files/figure-html/unnamed-chunk-11-1.png&#34; alt=&#34;Illustration of a route network generated with sf functions.&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 5: Illustration of a route network generated with sf functions.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;a-benchmark&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;A benchmark&lt;/h2&gt;
&lt;p&gt;To test that the method is fast, or is at least not slower than the original &lt;code&gt;overline()&lt;/code&gt; function, at least for this task, we‚Äôll package-up the method in a new function:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;overline_sf2 = function(sl, attrib) {
  attrib = &amp;quot;value&amp;quot;
  attrib1 = paste0(attrib, &amp;quot;.1&amp;quot;)
  sl_intersection = sf::st_intersection(sl[1, attrib], sl[2, attrib])
  sl_intersection[[attrib]] = sl_intersection[[attrib]] + sl_intersection[[attrib1]]
  sl_intersection[[attrib1]] = NULL
  sl_seg = sf::st_difference(sl[attrib], sf::st_geometry(sl_intersection))
  rnet = rbind(sl_intersection, sl_seg)
  return(rnet)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If you are new to scripts/algorithms/functions, it may be worth taking a look at the new &lt;a href=&#34;https://geocompr.robinlovelace.net/algorithms.html&#34;&gt;Algorithms&lt;/a&gt; chapter in our near-complete book that teaches a range of geographic methods that use R &lt;span class=&#34;citation&#34;&gt;(Lovelace, Nowosad, and Muenchow 2019)&lt;/span&gt;. Now the method has been put in a function, we can compare its performance with the per-existing &lt;code&gt;overline()&lt;/code&gt; function for comparison:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;bench::mark(check = F,
            overline.sp = overline(sl_sp, attrib = &amp;quot;value&amp;quot;),
            overline.sf = overline(sl, attrib = &amp;quot;value&amp;quot;),
            overline_sf2 = overline_sf2(sl, attrib = &amp;quot;value&amp;quot;)
            )&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 6
##   expression        min   median `itr/sec` mem_alloc `gc/sec`
##   &amp;lt;bch:expr&amp;gt;   &amp;lt;bch:tm&amp;gt; &amp;lt;bch:tm&amp;gt;     &amp;lt;dbl&amp;gt; &amp;lt;bch:byt&amp;gt;    &amp;lt;dbl&amp;gt;
## 1 overline.sp   12.19ms  12.53ms      79.8  727.76KB     2.05
## 2 overline.sf   16.62ms  17.11ms      58.0    2.32MB     9.28
## 3 overline_sf2   9.34ms   9.51ms     105.    97.62KB     4.20&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The results are not Earth-shattering: the new function seems to be around the same speed as the original, if a little faster. This is great news, but remember: the new function only works on 2 lines so is much simpler. More work needed!&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;next-steps&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Next steps&lt;/h2&gt;
&lt;p&gt;The next step is to generalist this method so it works for many (potentially thousands) of lines in a way that scales, something that should help on the visualization side, a topic that attracts much interest (see for example this &lt;a href=&#34;https://gis.stackexchange.com/questions/778/representation-of-network-flows&#34;&gt;gis.stackexchange post&lt;/a&gt; on the subject and, more broadly, a recent &lt;a href=&#34;https://nowosad.github.io/post/maps-distortion/&#34;&gt;article&lt;/a&gt; showing how to make animated maps by Jakub Nowosad). There is also work to do on performance but, as Donald Knuth said &lt;span class=&#34;citation&#34;&gt;(Knuth 1974)&lt;/span&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;premature optimization is the root of all evil (or at least most of it) in programming&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So a more complete &lt;code&gt;overline.sf()&lt;/code&gt; function is needed. That will (hopefully) be the topic of the next blog post.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;references&#34; class=&#34;section level2 unnumbered&#34;&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;div id=&#34;refs&#34; class=&#34;references&#34;&gt;
&lt;div id=&#34;ref-hollander_transport_2016&#34;&gt;
&lt;p&gt;Hollander, Yaron. 2016. &lt;em&gt;Transport Modelling for a Complete Beginner&lt;/em&gt;. CTthink!&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-knuth_computer_1974&#34;&gt;
&lt;p&gt;Knuth, Donald E. 1974. ‚ÄúComputer Programming as an Art.‚Äù &lt;em&gt;Commun. ACM&lt;/em&gt; 17 (12): 667‚Äì73. doi:&lt;a href=&#34;https://doi.org/10.1145/361604.361612&#34;&gt;10.1145/361604.361612&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-lovelace_propensity_2017&#34;&gt;
&lt;p&gt;Lovelace, Robin, Anna Goodman, Rachel Aldred, Nikolai Berkoff, Ali Abbas, and James Woodcock. 2017. ‚ÄúThe Propensity to Cycle Tool: An Open Source Online System for Sustainable Transport Planning.‚Äù &lt;em&gt;Journal of Transport and Land Use&lt;/em&gt; 10 (1). doi:&lt;a href=&#34;https://doi.org/10.5198/jtlu.2016.862&#34;&gt;10.5198/jtlu.2016.862&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-lovelace_geocomputation_2019&#34;&gt;
&lt;p&gt;Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. 2019. &lt;em&gt;Geocomputation with R&lt;/em&gt;. CRC Press.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-rcoreteam_language_2018&#34;&gt;
&lt;p&gt;R Core Team. 2018. &lt;em&gt;R: A Language and Environment for Statistical Computing&lt;/em&gt;. Vienna, Austria: R Foundation for Statistical Computing.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;footnotes&#34;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&#34;fn1&#34;&gt;&lt;p&gt;Any input on that still welcome - see the &lt;a href=&#34;https://geocompr.robinlovelace.net/index.html#how-to-contribute&#34;&gt;contributing&lt;/a&gt; section for more.&lt;a href=&#34;#fnref1&#34;&gt;‚Ü©&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Switching to blogdown</title>
      <link>/2017/04/30/switching-to-blogdown/</link>
      <pubDate>Sun, 30 Apr 2017 00:00:00 +0000</pubDate>
      
      <guid>/2017/04/30/switching-to-blogdown/</guid>
      <description>


&lt;p&gt;I‚Äôve finally got a new blog post, to test that my new set-up is working, using the wonderful new &lt;a href=&#34;https://bookdown.org/yihui/blogdown/&#34;&gt;blogdown&lt;/a&gt; package.&lt;/p&gt;
&lt;p&gt;Here‚Äôs a test plot, to show how it allows R code to be embedded:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(1:9)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2017-04-30-switching-to-blogdown_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Now that I have a quick-fire and fun way of getting new content onto the web I expect to be blogging lots more.&lt;/p&gt;
&lt;p&gt;Watch this space!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Geostat2016 Albacete: a write-up</title>
      <link>/2016/09/28/geostat2016-albacete-a-write-up/</link>
      <pubDate>Wed, 28 Sep 2016 00:00:00 +0000</pubDate>
      
      <guid>/2016/09/28/geostat2016-albacete-a-write-up/</guid>
      <description>

&lt;p&gt;Last week I went to &lt;a href=&#34;http://geostat-course.org/2016&#34;&gt;GEOSTAT 2016&lt;/a&gt;. Given the amount of fun had at &lt;a href=&#34;http://robinlovelace.net/r/2015/08/31/geostat-writeup.html&#34;&gt;GEOSTAT 2015&lt;/a&gt;, expectations were high. The local organisers did not disappoint, with a week of lectures, workshops, spatial data competitions and of course lots of Geostatistics. It would be unwise to try to systematically document such a diverse range of activities, and the &lt;a href=&#34;http://geostat-course.org/node&#34;&gt;GEOSTAT website&lt;/a&gt; provides much further info. Instead this &amp;lsquo;miniwriteup&amp;rsquo; is designed to summarise some of my memories from the event, and encourage you to get involved for GEOSTAT 2017.&lt;/p&gt;

&lt;p&gt;To put things in context, the first session was a brief overview of the history of GEOSTAT. This is the 12&lt;sup&gt;th&lt;/sup&gt; GEOSTAT summer school. In some ways GEOSTAT can be seen as a physical manifestation of the lively &lt;a href=&#34;https://stat.ethz.ch/mailman/listinfo/r-sig-geo&#34;&gt;R-SIG-GEO email list&lt;/a&gt;. That may not sound very exciting. But there is a strong community spirit at the event and, unlike other academic conferences, the focus is on practical learning rather than transmitting research findings or theories. And the event was so much more than that.&lt;/p&gt;

&lt;p&gt;There were 5 action packed days covering many topics within the broad field of Geostatistics. What follows is an overview of each that I went to (there were 2 streams), with links to the source material. It is hoped that this will be of use to people who were not present in person.&lt;/p&gt;

&lt;h2 id=&#34;day-1&#34;&gt;Day 1&lt;/h2&gt;

&lt;p&gt;After an introduction to the course and spatial data by Tom Hengl, Roger Bivand delivered a technical and applied webinar on &lt;a href=&#34;http://geostat-course.org/system/files/geostat_talk16.pdf&#34;&gt;bridges between R and other GIS software&lt;/a&gt;. With a focus on GRASS, we learned how R could be used as a &amp;lsquo;front end&amp;rsquo; to other programs. An example using the famous &amp;lsquo;Cholera pump&amp;rsquo; data mapped by &lt;a href=&#34;https://en.wikipedia.org/wiki/John_Snow&#34;&gt;John Snow&lt;/a&gt; was used to demonstrate the potential benefits of &amp;lsquo;bridging&amp;rsquo; to other software. The data can be downloaded and partially plotted in R as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;u = &amp;quot;http://geostat-course.org/system/files/data_0.zip&amp;quot;
download.file(u, &amp;quot;data_0.zip&amp;quot;)
unzip(&amp;quot;data_0.zip&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;old = setwd(&amp;quot;~/repos/geostat2016-rl/&amp;quot;)
library(raster)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## Loading required package: sp
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;bbo = shapefile(&amp;quot;data/bbo.shp&amp;quot;)
buildings = shapefile(&amp;quot;data/buildings.shp&amp;quot;)
deaths = shapefile(&amp;quot;data/deaths.shp&amp;quot;)
b_pump = shapefile(&amp;quot;data/b_pump.shp&amp;quot;)
nb_pump = shapefile(&amp;quot;data/nb_pump.shp&amp;quot;)
plot(buildings)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-3-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;setwd(old)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In the afternoon Robert Hijmans gave a high level overview of software for spatial data analysis, with a discussion of the &lt;a href=&#34;http://www.diva-gis.org/&#34;&gt;Diva GIS&lt;/a&gt; software he developed and why he now uses R for most of his geospatial analysis.&lt;/p&gt;

&lt;p&gt;The talk touched on the &lt;a href=&#34;https://cran.r-project.org/web/packages/gdistance/&#34;&gt;&lt;strong&gt;gdistance&lt;/strong&gt;&lt;/a&gt; package, and many others. Robert showcased the power of R for understanding major civilisational problems such as the impacts of climate change on agriculture. His animated global maps of agricultural productivity and precipitation showed how R can scale to tackle large datasets, up to the global level involving spatial and temporal data simultaneously.&lt;/p&gt;

&lt;p&gt;There were a few political asides. Robert mentioned how agrotech giant Monsanto paid almost &lt;a href=&#34;https://www.fastcoexist.com/3019387/why-monsanto-just-spent-1-billion-to-buy-a-climate-data-company&#34;&gt;$1 billion&lt;/a&gt; for a weather prediction company. He detoured deftly through a discussion of &amp;lsquo;big data&amp;rsquo;, making the observation that often ensembles of models can provide better predictions than any single model working on its own, with political analogies about the importance of democracy.&lt;/p&gt;

&lt;p&gt;More examples included health and estimates of dietary deficiencies at high levels of geographic resolution. A paper showing fish and fruit consumption across Rwanda illustrated how map making in R, used intelligently, can save lives.&lt;/p&gt;

&lt;p&gt;It was revealing to learn how Robert got into R. While he was working at the &lt;a href=&#34;http://irri.org/&#34;&gt;International Rice Research Institute&lt;/a&gt;. &amp;ldquo;It forces you to write scripts.&amp;rdquo; This is good for ensuring reproducibility, a critical component of scientific research. It encourages you to focus on and understand the data primarily, rather than visualising it. On the other hand, R is not always the fastest way to do things, although &amp;ldquo;people often worry too much about this&amp;rdquo;. Your time is more important than your computers, so setting an analysis running is fine. Plus there are ways to make things run faster, as mentioned in a book that I&amp;rsquo;m working on, &lt;a href=&#34;https://csgillespie.github.io/efficientR/&#34;&gt;Efficient R Programming&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;R is great if you use it every data, but if you only use it less than once a week it becomes difficult.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;If you just want a one-off spatial analysis data program, Robert recommended QGIS. After a brief overview of spatial data in R, Robert moved on to talk about the &lt;a href=&#34;https://cran.r-project.org/web/packages/raster/index.html&#34;&gt;&lt;strong&gt;raster&lt;/strong&gt;&lt;/a&gt; package, which he developed. This package was developed to overcome some of the limitations with &lt;strong&gt;sp&lt;/strong&gt;, the foundational package for spatial data in R.&lt;/p&gt;

&lt;!-- This led on to discussion of C++ code, which Robert is increasingly developing in to extend **raster**. Here is a brief benchmark to show how much faster C++ code can be: --&gt;

&lt;!-- ```{r} --&gt;

&lt;!-- sumR = function(x){ --&gt;

&lt;!--   b = NULL --&gt;

&lt;!--   for(i in 1:length(x)){ --&gt;

&lt;!--     b = b + a[i] --&gt;

&lt;!--   } --&gt;

&lt;!-- } --&gt;

&lt;!-- ``` --&gt;

&lt;!-- ```{r, engine=&#39;cpp&#39;, eval=FALSE} --&gt;

&lt;!-- library(Rcpp) --&gt;

&lt;!-- cppFunction(code =  --&gt;

&lt;!--               &#34;// [[Rcpp::export]] --&gt;

&lt;!-- double cumulater(std::vector&lt;doubl&gt;d) { --&gt;

&lt;!--   int n = x.size(); --&gt;

&lt;!--   double result = 0; --&gt;

&lt;!--   for (int i=0;i &lt; n; i++) { --&gt;

&lt;!--     result = result + d[i]; --&gt;

&lt;!--   } --&gt;

&lt;!--   double r = cumulater(v) --&gt;

&lt;!-- }return r;&#34;) --&gt;

&lt;!-- ``` --&gt;

&lt;!-- According to Robert, once you can write R functions, &#34;writing C++ functions is relatively easy&#34;. While I&#39;m not quite convinced, based on the number of characters needed to write a simple sum code, he certainly convinced me of the merits of developing new spatial functions in this low level language, because of its speed and the fact that it&#39;s the main development language of GDAL.  --&gt;

&lt;p&gt;A final resource that Robert promoted was &lt;a href=&#34;http://www.rspatial.org/&#34;&gt;RSpatial.org&lt;/a&gt;, a free online resource for teaching R as a command line GIS.&lt;/p&gt;

&lt;p&gt;Edzer Pebesmer delivered the final session of the first day, on &lt;strong&gt;Free and Open Source Software (FOSS) for Geoinformatics and Geosciences&lt;/strong&gt;. After the highly technical final C++ examples from the previous talk, I was expecting a high level overview of the landscape. Instead Edzer went straight in to talk about source code, the raw material that defines all software. The fundamental feature of open source software is that its source code is free, and will remain free.&lt;/p&gt;

&lt;!-- An example of this is Apple, the most profitable computer company on Earth, used parts of the BSD kernel in its proprietary operating system. --&gt;

&lt;!-- Another feature of open source software is that it must have a license. It has a legal meaning, the details of which vary from licence to license. By deciding a license, you can choose whether you use a more *restrictive* license (which prevents people from using the software in software that is solved) or a more *permisive* license. R&#39;s &#39;backend&#39; is licensed --&gt;

&lt;!-- GPL is used for R&#39;s. ESRI is now using R as a back-end in commercial software. Its lawers have explored the legal implications of this and concluded that it is not breaking the law by doing so. --&gt;

&lt;!-- GitHub is an online system for developing open source software. It is free to use, but some of the best things in GitHub are not open source. Edzer says that the advantages of using their service, in terms of community engagement and ease of use and accessibility, currently outweigh any potential future disbenefits of GitHub not being completely open source.  --&gt;

&lt;!-- Another example is open source software for geosciences. Researchers may want to make their software open for anyone to use, while remaining protected from exploitation from large companies like oil com --&gt;

&lt;h2 id=&#34;day-2&#34;&gt;Day 2&lt;/h2&gt;

&lt;p&gt;The second day of the course was divided in two: stream A focussed on environmental modelling and stream B compositional data. I attended the environmental modelling course taught by Robert Hijmans. The course was based on his teaching material at &lt;a href=&#34;http://rspatial.org/spatial/index.html&#34;&gt;rspatial.org&lt;/a&gt; and can be found &lt;a href=&#34;http://gfc.ucdavis.edu/events/albacete/day2.html&#34;&gt;online&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We started off by looking at the fundamental data structures underlying spatial data in R. Why? It&amp;rsquo;s useful to be able to create simple example datasets from scratch, to understand them.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(sp)
x &amp;lt;- c(4,7,3,8)
y &amp;lt;- c(9,6,12,11)
xy &amp;lt;- data.frame(x, y)
SpatialPoints(xy)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## class       : SpatialPoints 
## features    : 4 
## extent      : 3, 8, 6, 12  (xmin, xmax, ymin, ymax)
## coord. ref. : NA
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;d = data.frame(v1 = 1:4, v2 = LETTERS[1:4])
spd = SpatialPointsDataFrame(coords = xy, data = d)
plot(spd)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-6-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;The basic functions of the &lt;strong&gt;raster&lt;/strong&gt; package are similar.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(raster)
r = raster(nc = 10, nr = 10)
values(r) = 1:ncell(r)
plot(r)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-7-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;as.matrix(r)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    1    2    3    4    5    6    7    8    9    10
##  [2,]   11   12   13   14   15   16   17   18   19    20
##  [3,]   21   22   23   24   25   26   27   28   29    30
##  [4,]   31   32   33   34   35   36   37   38   39    40
##  [5,]   41   42   43   44   45   46   47   48   49    50
##  [6,]   51   52   53   54   55   56   57   58   59    60
##  [7,]   61   62   63   64   65   66   67   68   69    70
##  [8,]   71   72   73   74   75   76   77   78   79    80
##  [9,]   81   82   83   84   85   86   87   88   89    90
## [10,]   91   92   93   94   95   96   97   98   99   100
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;q = sqrt(r)
plot(q)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-7-2.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x = q + r
s = stack(r, q, x)
ss = s * r # r is recycled so each layer is multiplied by r
1:3 * 2 # here 2 is recycled
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## [1] 2 4 6
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Raster also provides simple yet powerful functions for manipulating and analysing raster data, including &lt;code&gt;crop()&lt;/code&gt;, &lt;code&gt;merge()&lt;/code&gt; for manipulation and &lt;code&gt;predict()&lt;/code&gt;, &lt;code&gt;focal()&lt;/code&gt; and &lt;code&gt;distance()&lt;/code&gt;. &lt;code&gt;predict()&lt;/code&gt; is particularly interesting as it allows raster values to be estimated using any of R&amp;rsquo;s powerful statistical methods.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(dismo)
g = gmap(&amp;quot;Albacete, Spain&amp;quot;, scale = T, lonlat = T)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;## Loading required namespace: XML
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;plot(g, interpolate = T)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-9-1.png&#34; alt=&#34;&#34; /&gt;&lt;img src=&#34;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-9-2.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;dismo::geocode(&amp;quot;Universidad Castilla la Mancha&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;##                    originalPlace
## 1 Universidad Castilla la Mancha
##                                          interpretedPlace longitude
## 1 Paseo Universidad, 13005 Ciudad Real, Cdad. Real, Spain -3.921711
##   latitude      xmin      xmax     ymin     ymax uncertainty
## 1 38.99035 -3.922007 -3.919309 38.98919 38.99189         131
&lt;/code&gt;&lt;/pre&gt;

&lt;!-- Supervised learning is the process of allowing a computer to estimate predictor variables based on explanatory variables. --&gt;

&lt;!-- There are 2 main things to consider when model fitting: the functional form to use and the explanatory variables X. --&gt;

&lt;!-- We worked through a practical on spatial interpolation from [rspatial.org](http://rspatial.org/analysis/rst/4-interpolation.html): --&gt;

&lt;!-- ```{r} --&gt;

&lt;!-- dir.create(&#34;data&#34;) --&gt;

&lt;!-- download.file(&#34;http://rspatial.org/analysis/data/precipitation.csv&#34;, &#34;data/precipitation.csv&#34;) --&gt;

&lt;!-- d = read.csv(&#34;data/precipitation.csv&#34;) --&gt;

&lt;!-- d$prec &lt;- rowSums(d[, c(6:17)]) --&gt;

&lt;!-- plot(sort(d$prec), ylab=&#39;Annual precipitation (mm)&#39;, las=1, xlab=&#39;Stations&#39;) --&gt;

&lt;!-- library(sp) --&gt;

&lt;!-- dsp &lt;- SpatialPoints(d[,4:3], proj4string=CRS(&#34;+proj=longlat +datum=NAD83&#34;)) --&gt;

&lt;!-- dsp &lt;- SpatialPointsDataFrame(dsp, d) --&gt;

&lt;!-- download.file(&#34;http://rspatial.org/analysis/data/counties.rds&#34;, &#34;data/counties.rds&#34;) --&gt;

&lt;!-- CA &lt;- readRDS(&#34;data/counties.rds&#34;) --&gt;

&lt;!-- # define groups for mapping --&gt;

&lt;!-- cuts &lt;- c(0,200,300,500,1000,3000) --&gt;

&lt;!-- # set up a palette of interpolated colors --&gt;

&lt;!-- blues &lt;- colorRampPalette(c(&#39;yellow&#39;, &#39;orange&#39;, &#39;blue&#39;, &#39;dark blue&#39;)) --&gt;

&lt;!-- pols &lt;- list(&#34;sp.polygons&#34;, CA, fill = &#34;lightgray&#34;) --&gt;

&lt;!-- spplot(dsp, &#39;prec&#39;, cuts=cuts, col.regions=blues(5), sp.layout=pols, pch=20, cex=2) --&gt;

&lt;!-- TA &lt;- CRS(&#34;+proj=aea +lat_1=34 +lat_2=40.5 +lat_0=0 +lon_0=-120 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +ellps=GRS80 +towgs84=0,0,0&#34;) --&gt;

&lt;!-- library(rgdal) --&gt;

&lt;!-- dta &lt;- spTransform(dsp, TA) --&gt;

&lt;!-- cata &lt;- spTransform(CA, TA) --&gt;

&lt;!-- ``` --&gt;

&lt;!-- Now the modelling work can begin.  --&gt;

&lt;!-- ```{r} --&gt;

&lt;!-- # First create a function to calculate the error: --&gt;

&lt;!-- RMSE &lt;- function(observed, predicted) { --&gt;

&lt;!--   sqrt(mean((predicted - observed)^2, na.rm=TRUE)) --&gt;

&lt;!-- } --&gt;

&lt;!-- null &lt;- RMSE(mean(dsp$prec), dsp$prec) --&gt;

&lt;!-- null --&gt;

&lt;!-- library(dismo) --&gt;

&lt;!-- v &lt;- voronoi(dta) --&gt;

&lt;!-- ## Loading required namespace: deldir --&gt;

&lt;!-- plot(dsp) --&gt;

&lt;!-- plot(v) --&gt;

&lt;!-- points(dta, col = &#34;red&#34;) --&gt;

&lt;!-- ca = aggregate(cata) --&gt;

&lt;!-- plot(ca) --&gt;

&lt;!-- vca = intersect(v, ca) --&gt;

&lt;!-- plot(vca) --&gt;

&lt;!-- vca2 = rgeos::gIntersection(v, ca, byid = T) --&gt;

&lt;!-- names(vca2) --&gt;

&lt;!-- plot(vca2) # not the same! --&gt;

&lt;!-- plot(vca) --&gt;

&lt;!-- names(vca) --&gt;

&lt;!-- ``` --&gt;

&lt;!-- Testing a first model --&gt;

&lt;!-- ```{r} --&gt;

&lt;!-- kf = kfold(dta@data) --&gt;

&lt;!-- rmse = NULL --&gt;

&lt;!-- for(k in 1:length(unique(kf))){ --&gt;

&lt;!--   test = dta[kf == k,] --&gt;

&lt;!--   train = dta[kf != k,] --&gt;

&lt;!--   v = voronoi(train) --&gt;

&lt;!--   p = extract(v, test) --&gt;

&lt;!--   rmse[k] = RMSE(observed = test$prec, predicted = p$prec) --&gt;

&lt;!-- } --&gt;

&lt;!-- rmse --&gt;

&lt;!-- ``` --&gt;

&lt;h2 id=&#34;day-3&#34;&gt;Day 3&lt;/h2&gt;

&lt;p&gt;The third day started with a live R demo by Edzer Pebesmer on &lt;a href=&#34;https://edzer.github.io/UseR2016/&#34;&gt;space-time data&lt;/a&gt;. Refreshingly for a conference primarily on spatial data, it started with an in-depth discussion of time. While base R natively supports temporal units (knowing the difference between days and seconds, for example) it does not know the difference between metres and miles.&lt;/p&gt;

&lt;p&gt;This led to the creation of the &lt;strong&gt;units&lt;/strong&gt; library, an taster of which is shown below:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;install.packages(&amp;quot;units&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(units)
m = with(ud_units,  m)
s = with(ud_units,  s)
km = with(ud_units, km)
h = with(ud_units,  h)
x = 1:3 * m/s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The rest of the day was spent analysing a range of spatio-temporal datasets using &lt;strong&gt;spacetime&lt;/strong&gt;, &lt;strong&gt;trajectories&lt;/strong&gt; and &lt;strong&gt;rgl&lt;/strong&gt; for interactive 3d spacetime plots.&lt;/p&gt;

&lt;p&gt;In the parallel session there were sessions on &lt;a href=&#34;http://geostat-course.org/node/1328&#34;&gt;CARTO&lt;/a&gt; and the &lt;a href=&#34;http://geostat-course.org/node/1329&#34;&gt;R gvSIG bridge&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;day-4&#34;&gt;Day 4&lt;/h2&gt;

&lt;p&gt;Day 4 was a highlight for me as I&amp;rsquo;ve wanted to learn how to use the &lt;strong&gt;INLA&lt;/strong&gt; package for ages. It was explained lucidly by Marta Blangiardo and Michela Cameletti, who have written an excellent book on the subject, which has a &lt;a href=&#34;https://sites.google.com/a/r-inla.org/stbook/&#34;&gt;website that I recommend checking out&lt;/a&gt;. Their materials can be found here: &lt;a href=&#34;http://geostat-course.org/node/1330&#34;&gt;http://geostat-course.org/node/1330&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;In parallel to this there was a session on &lt;a href=&#34;http://geostat-course.org/node/1326&#34;&gt;Spatial and Spatiotemporal point process analysis in R&lt;/a&gt; data in R by Virgilio Gomez Rubio and one on automated &lt;a href=&#34;http://geostat-course.org/node/1323&#34;&gt;spatial prediction and visualisation&lt;/a&gt; by Tom Hengl.&lt;/p&gt;

&lt;h2 id=&#34;day-5&#34;&gt;Day 5&lt;/h2&gt;

&lt;p&gt;After all that intense geospatial analysis and programming activity, and a night out in Albacete for some participants, we were relieved to learn that this final day of learning was more relaxed. Furthermore, by tradition, it was largely participant-led. I gave a talk on &lt;a href=&#34;https://csgillespie.github.io/efficientR/&#34;&gt;Efficient R Programming&lt;/a&gt;, a book I&amp;rsquo;ve written in collaboration with Colin Gillespie; Teresa Rojos gave a fascinating talk about her research into the spatial distribution of cancer rates in Peru; and S.J. Norder gave us the low-down on the Biogeography of islands with R.&lt;/p&gt;

&lt;p&gt;One of the most exciting sessions was the revelation of the results of the spatial prediction game. Interestingly, a team using a relatively simple approach with &lt;a href=&#34;https://cran.r-project.org/web/packages/randomForestSRC/index.html&#34;&gt;&lt;strong&gt;randomForestSRC&lt;/strong&gt;&lt;/a&gt; (and &lt;a href=&#34;https://github.com/ehrlinger/ggRandomForests&#34;&gt;&lt;strong&gt;ggRandomForests&lt;/strong&gt;&lt;/a&gt; for visualisation) one against others who had spent hours training complex multi-level models.&lt;/p&gt;

&lt;h2 id=&#34;summary&#34;&gt;Summary&lt;/h2&gt;

&lt;p&gt;Overall it was an amazing event and inspiring to spend time with so many researchers using open geospatial software for tackling &lt;a href=&#34;https://t.co/UqMyCnXOsG&#34;&gt;pressing real world issues&lt;/a&gt;. Furthermore, it was great fun. I strongly recommend people dipping their toes in the &lt;a href=&#34;https://cran.r-project.org/web/views/Spatial.html&#34;&gt;sea of spatial capabilities&lt;/a&gt; provided by R check out the &lt;a href=&#34;http://geostat-course.org/node&#34;&gt;GEOSTAT website&lt;/a&gt;, not least for the excellent &lt;a href=&#34;http://archive.org/search.php?query=GEOSTAT&#34;&gt;video resources to be found there&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I look forward to hearing plans for future GEOSTATs and recommend the event, and associated materials, to researchers interested in using free geospatial software for the greater good.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>R vs QGIS for sustainable transport planning</title>
      <link>/2015/01/20/r-vs-qgis-for-sustainable-transport-planning/</link>
      <pubDate>Tue, 20 Jan 2015 00:00:00 +0000</pubDate>
      
      <guid>/2015/01/20/r-vs-qgis-for-sustainable-transport-planning/</guid>
      <description>

&lt;p&gt;The 23rd iteration of the GIS Research UK conference
(&lt;a href=&#34;https://github.com/Robinlovelace/stplanr&#34;&gt;#GISRUK&lt;/a&gt;)
conference was the largest ever. 250 researchers,
industry representatives and academics attended from the
vibrant geospatial research communities in the
UK, Europe and beyond. GISRUK has become a centrepoint for discussion
of new methods, software and applications in the field. I
was on the &lt;a href=&#34;http://leeds.gisruk.org/contact.html&#34;&gt;organising committee&lt;/a&gt;,
reviewed some excellent papers for the event
(a full list of these is
&lt;a href=&#34;http://leeds.gisruk.org/programme.html&#34;&gt;available for download here&lt;/a&gt;) and
attended some truly ground-breaking talks.
This experience has shown that the geospatial community
in the UK is strong,
especially with regards to growth in open access
data and open source software in the field.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.flickr.com/photos/97888609@N02/17025120518&#34; title=&#34;img_2814 by Robin Lovelace, on Flickr&#34;&gt;&lt;img src=&#34;https://farm6.staticflickr.com/5450/17025120518_ebfba47bff_s.jpg&#34; width=&#34;75&#34; height=&#34;75&#34; alt=&#34;img_2814&#34;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This article is about one part of GISRUK and insights gleaned from it
about R, QGIS and other tools for sustainable transport planning.
&lt;a href=&#34;https://github.com/Robinlovelace/GIS4TA&#34;&gt;GIS for Transport Applications&lt;/a&gt;
(&lt;a href=&#34;https://twitter.com/hashtag/gis4ta?src=hash&#34;&gt;#GIS4TA for short&lt;/a&gt;) was a practical day-long workshop
that preceded the main event.
I organised the workshop and (with help from
&lt;a href=&#34;http://www.geog.leeds.ac.uk/people/e.odiari&#34;&gt;Eusebio Odiari&lt;/a&gt;,
&lt;a href=&#34;https://tgrg.wordpress.com/&#34;&gt;The Transport Geography Research Group&lt;/a&gt;
and the
&lt;a href=&#34;http://www.rgs.org/HomePage.htm&#34;&gt;Royal Geographical Society&lt;/a&gt;)
it seems to have been a great success. More than 30
people attended, including a decent portion
from transport consultancies such as
&lt;a href=&#34;http://www.itpworld.net/index.html&#34;&gt;Integrated Transport Planning Ltd&lt;/a&gt;
&lt;a href=&#34;http://www.trpconsult.com/&#34;&gt;TRP Consulting&lt;/a&gt; and the
&lt;a href=&#34;http://www.era.europa.eu/Pages/Home.aspx&#34;&gt;European Railway Association (ERA)&lt;/a&gt;.
Specifically, it is about the use of R
and QGIS tools for transport planning and the potential for their
adoption in academic, public and private-sector transport planning.
The focus of the workshop was deliberately on open source software
and sustainable transport because these are growth
areas in the field that are essential for
democratic
and healthy
transport systems compatible with the
science of climate change (&lt;a href=&#34;http://www.opentraffic.net/en/&#34;&gt;&lt;span class=&#34;citation&#34;&gt;Tamminga, 2012&lt;/span&gt;&lt;/a&gt;).
A recent report, for example, suggests we need to almost completely
transition away from fossil fuels by 2050
(&lt;a href=&#34;http://dx.doi.org/10.1038/nature14016&#34;&gt;McGlade et al., 2015&lt;/a&gt;).
New datasets and methods for analysing and modelling them can
help get us there in the recalcitrant transport sector
(&lt;a href=&#34;http://dx.doi.org/10.1016/j.jtrangeo.2014.07.010&#34;&gt;Gossling, 2014&lt;/a&gt;).&lt;/p&gt;

&lt;h1 id=&#34;r-for-transport-applications&#34;&gt;R for transport applications&lt;/h1&gt;

&lt;p&gt;The workshop kicked-off with a short
talk on &amp;lsquo;R and QGIS for transport applications&amp;rsquo;,
which laid out some of the motivations for running the
workshop outlined above. Other than a few
&amp;lsquo;early adopters&amp;rsquo;, the transport modelling community
is generally conservative, based largely on mature
proprietary products such as
&lt;a href=&#34;http://www.saturnsoftware.co.uk/7.html&#34;&gt;SATURN&lt;/a&gt;
and
&lt;a href=&#34;http://vision-traffic.ptvgroup.com/en-us/products/ptv-vissim/&#34;&gt;Vissim&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The slides from this talk are available here:&lt;/p&gt;

&lt;script async class=&#34;speakerdeck-embed&#34; data-id=&#34;91fce9cf5c36405b8969c6b6954c4fe6&#34; data-ratio=&#34;1.41436464088398&#34; src=&#34;//speakerdeck.com/assets/embed.js&#34;&gt;&lt;/script&gt;

&lt;p&gt;&lt;strong&gt;Tutorial: &lt;a href=&#34;https://github.com/Robinlovelace/GIS4TA/releases/download/0.1/intro-r-qgis-4ta.pdf&#34;&gt;Introduction to R and QGIS for transport applications&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h1 id=&#34;routing-with-r&#34;&gt;Routing with R&lt;/h1&gt;

&lt;p&gt;The second talk was by Nick Bearman, who provided an overview of
routing in R, as well as an excellent
&lt;a href=&#34;https://github.com/nickbearman/transport-workshop/blob/master/transport-workshop.pdf&#34;&gt;practical tutorial&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The practical demonstrated 2 ways of routing in R:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Using &lt;strong&gt;ggmap&lt;/strong&gt;. The following code was used to navigate to the event!&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from &amp;lt;- &#39;Leeds station, New Station Street, Leeds LS1 5DL, United Kingdom&#39;
to &amp;lt;- &#39;LS2 9JT&#39;
route_df &amp;lt;- route(from, to, structure = &#39;route&#39;, mode = &#39;walking&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;qmap(&#39;Merrion Centre&#39;, zoom = 15) +
geom_path(
aes(x = lon, y = lat),  colour = &#39;red&#39;, size = 1.5,
data = route_df, lineend = &#39;round&#39;)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&#34;https://github.com/Robinlovelace/robinlovelace.github.io/raw/master/_posts/writeup_files/figure-html/unnamed-chunk-2-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;The &lt;a href=&#34;https://github.com/Robinlovelace/stplanr&#34;&gt;package I created, &lt;strong&gt;stplanr&lt;/strong&gt;&lt;/a&gt;,
to get routes optimised for cyclists (see &lt;a href=&#34;https://github.com/nickbearman/transport-workshop/blob/master/transport-workshop.Rmd&#34;&gt;transport-workshop.Rmd&lt;/a&gt; for a working version):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;rquiet &amp;lt;- gLines2CyclePath(l = rlines, plan = &amp;quot;quietest&amp;quot;)
plot(rquiet[1,]) # route from Leeds station to Leeds University (North - South)
plot(rquiet[2,]) # route from Leeds to Manchester!
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&#34;https://github.com/Robinlovelace/robinlovelace.github.io/raw/master/_posts/writeup_files/figure-html/unnamed-chunk-4-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Tutorial: &lt;a href=&#34;https://github.com/nickbearman/transport-workshop/blob/master/transport-workshop.pdf&#34;&gt;Route analysis using R&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h1 id=&#34;large-gps-datasets-with-postgis&#34;&gt;Large gps datasets with PostGIS&lt;/h1&gt;

&lt;p&gt;The most technical session involved using R to query huge datasets storing
GPS data containing 100,000+ rows. Amazingly, Richard and Adrian Ellison
set up a remotely accessible database instance &lt;strong&gt;from their laptop&lt;/strong&gt; which
participants queried via
&lt;a href=&#34;http://cran.r-project.org/web/packages/RPostgreSQL/index.html&#34;&gt;&lt;strong&gt;RPostgreSQL&lt;/strong&gt;&lt;/a&gt;.
Their session information can be seen here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/richardellison/GIS4TA_GPS&#34;&gt;&lt;strong&gt;github.com/richardellison/GIS4TA_GPS&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&#34;a-hackathon&#34;&gt;A hackathon&lt;/h1&gt;

&lt;p&gt;Finally there was a miniature hackathon organised by Godwin Yeboah.
Participants made progress in better understanding the travel
patterns of cyclists using real data. The hackathon notes can be found here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/spatialscientist/GIS4TA2015&#34;&gt;github.com/spatialscientist/GIS4TA2015&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&#34;summary&#34;&gt;Summary&lt;/h1&gt;

&lt;p&gt;GIS is a field of knowledge that has a huge amount to offer transport
planners and researchers, especially regarding new and open source
software tools that can effectively generate, process and analyse
transport-related data. R is well-suited to fill this research gap and
has a wide range of tools to help. Packages such as &lt;strong&gt;ggmap&lt;/strong&gt;
(Kahle and Wickham 2013),
&lt;strong&gt;RPostgreSQL&lt;/strong&gt;
and the new &lt;a href=&#34;https://github.com/Robinlovelace/stplanr&#34;&gt;&lt;strong&gt;stplanr&lt;/strong&gt;&lt;/a&gt;
have great potential to help plan the transport systems of the future.
QGIS is also increasingly attractive for transport applications, with
it inbuilt support for
&lt;a href=&#34;http://planet.qgis.org/planet/tag/pgrouting/&#34;&gt;PGRouting&lt;/a&gt;,
&lt;a href=&#34;http://plugins.qgis.org/plugins/FlowMapper/&#34;&gt;flow analysis&lt;/a&gt;
and a friendly user interface that many will be used to.&lt;/p&gt;

&lt;p&gt;Photos taken during the hackathon are testament to its role as a forum
for not only learning but also debate about the future of GIS in transport.
These can be seen here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.flickr.com/photos/97888609@N02/sets/72157652012715766&#34;&gt;flickr.com/photos/97888609@N02/sets/72157652012715766&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hearing feedback from users new to R using it to solve transport problems
provided an insight into how it compares to traditional tools. The removal
of &amp;lsquo;glass ceilings&amp;rsquo; imposed by restrictive licenses or the need to buy
&amp;lsquo;add-on&amp;rsquo; features was one comment, but that applies equally to QGIS and
other &lt;a href=&#34;http://foss4g.org/&#34;&gt;FOSS4G&lt;/a&gt;
offerings. The steep learning curve of R seems to still
be an issue compared with QGIS, although this is becoming less of an issue
with the evolution of RStudio as an GUI for R. In conclusion, both R and
QGIS are coming of age as tools in the transport planner&amp;rsquo;s &amp;lsquo;war cabinet&amp;rsquo;.
The latest evidence unequivocally shows the impact of transport decisions
on obesity, environmental degradation and quality of life. So it is time,
surely, to harness this new open source software to &amp;lsquo;save the world&amp;rsquo;!&lt;/p&gt;

&lt;h1 id=&#34;acknowledgements&#34;&gt;Acknowledgements&lt;/h1&gt;

&lt;p&gt;Thanks to the Consumer Data Research Centre and the Royal Geographical
society for subsidising the event. Thanks to all the participants and
especially the demonstrators Godwin, Nick, Adrian and Richard for making it
happen.&lt;/p&gt;

&lt;h1 id=&#34;references&#34;&gt;References&lt;/h1&gt;

&lt;p&gt;G√∂ssling, Stefan, and Scott Cohen. 2014. ‚ÄúWhy sustainable transport policies will fail: EU climate policy in the light of transport taboos.‚Äù Journal of Transport Geography 39 (July). Elsevier Ltd: 197‚Äì207. doi:10.1016/j.jtrangeo.2014.07.010.&lt;/p&gt;

&lt;p&gt;Kahle, D, and Hadley Wickham. 2013. ‚Äúggmap: Spatial Visualization with ggplot2.‚Äù The R Journal 5: 144‚Äì61. &lt;a href=&#34;http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.375.8693&amp;amp;rep=rep1&amp;amp;type=pdf&#34;&gt;citeseerx.ist.psu.edu&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;McGlade, Christophe, and Paul Ekins. 2015. ‚ÄúThe geographical distribution of fossil fuels unused when limiting global warming to 2 ¬∞C.‚Äù Nature 517 (7533). Nature Publishing Group: 187‚Äì90. doi:10.1038/nature14016.&lt;/p&gt;

&lt;p&gt;Tamminga, Guus, Marc Miska, Edgar Santos, Hans van Lint, Arturo Nakasone, Helmut Prendinger, and Serge Hoogendoorn. 2012. ‚ÄúDesign of Open Source Framework for Traffic and Travel Simulation.‚Äù Transportation Research Record: Journal of the Transportation Research Board 2291 (-1): 44‚Äì52. doi:10.&lt;sup&gt;3141&lt;/sup&gt;&amp;frasl;&lt;sub&gt;2291&lt;/sub&gt;-06.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>