<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>Robin Lovelace</title>
 <link href="http://robinlovelace.github.com/atom.xml" rel="self"/>
 <updated>2016-12-06T01:30:23+00:00</updated>
 <id>http://robinlovelace.github.com/</id>
 <author>
   <name>Robin Lovelace</name>
   <email>rob00x@gmail.com</email>
 </author>
 
 
 <entry>
   <title>Estimating cycling potential with CycleStreet.net</title>
   <link href="http://robinlovelace.github.com//2016/12/06/estimating-cycling-potential-with-cyclestreet-net.html"/>
   <updated>2016-12-06T01:21:14+00:00</updated>
   <id>http://robinlovelace.github.com//2016/12/06/estimating-cycling-potential-with-cyclestreet-net</id>
   <content type="html">&lt;p&gt;Today was released the &lt;a href=&quot;https://www.jtlu.org/index.php/jtlu/article/view/862/824&quot;&gt;paper&lt;/a&gt; that describes the Propensity to Cycle Tool (PCT) and some of the thinking behind it.&lt;/p&gt;

&lt;p&gt;There are many things to say about the PCT, from the methods that underly it to evidence-based policy. This post focusses on just one aspect of the PCT, however: its use of CycleStreets.net to convert straight travel desire lines into wiggly paths on the road network that someone cycling could plausibly take.&lt;/p&gt;

&lt;p&gt;Before saying something about the routes themselves it’s worth taking a step back to look at the underlying data behind the PCT. The PCT relies on orgin-destination (OD) data. That is simply data in the following form:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;origin&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;destination&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;V1&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;V2&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;100&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;50&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;What this example OD table means is that 100 units of ‘V1’ and 3 units of V2 travel between zone 1 and zone 2. There is also movement represented between Zone 2 and 3.&lt;/p&gt;

&lt;p&gt;Now, imagine that V1 represents the total number of people travelling between the origin and destination and that V2 represents the number who regularly cycle. That is the basic input dataset that we are using as an input into the PCT. We use 2011 OD data on travel to work, because that is the most&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Geostat2016 Albacete: a write-up</title>
   <link href="http://robinlovelace.github.com//2016/09/28/geostat-2016.html"/>
   <updated>2016-09-28T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2016/09/28/geostat-2016</id>
   <content type="html">&lt;p&gt;Last week I went to &lt;a href=&quot;http://geostat-course.org/2016&quot;&gt;GEOSTAT 2016&lt;/a&gt;. Given the amount of fun had at &lt;a href=&quot;http://robinlovelace.net/r/2015/08/31/geostat-writeup.html&quot;&gt;GEOSTAT 2015&lt;/a&gt;, expectations were high. The local organisers did not disappoint, with a week of lectures, workshops, spatial data competitions and of course lots of Geostatistics. It would be unwise to try to systematically document such a diverse range of activities, and the &lt;a href=&quot;http://geostat-course.org/node&quot;&gt;GEOSTAT website&lt;/a&gt; provides much further info. Instead this ‘miniwriteup’ is designed to summarise some of my memories from the event, and encourage you to get involved for GEOSTAT 2017.&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;To put things in context, the first session was a brief overview of the history of GEOSTAT. This is the 12&lt;sup&gt;th&lt;/sup&gt; GEOSTAT summer school. In some ways GEOSTAT can be seen as a physical manifestation of the lively &lt;a href=&quot;https://stat.ethz.ch/mailman/listinfo/r-sig-geo&quot;&gt;R-SIG-GEO email list&lt;/a&gt;. That may not sound very exciting. But there is a strong community spirit at the event and, unlike other academic conferences, the focus is on practical learning rather than transmitting research findings or theories. And the event was so much more than that.&lt;/p&gt;

&lt;p&gt;There were 5 action packed days covering many topics within the broad field of Geostatistics. What follows is an overview of each that I went to (there were 2 streams), with links to the source material. It is hoped that this will be of use to people who were not present in person.&lt;/p&gt;

&lt;h2 id=&quot;day-1&quot;&gt;Day 1&lt;/h2&gt;

&lt;p&gt;After an introduction to the course and spatial data by Tom Hengl, Roger Bivand delivered a technical and applied webinar on &lt;a href=&quot;http://geostat-course.org/system/files/geostat_talk16.pdf&quot;&gt;bridges between R and other GIS software&lt;/a&gt;. With a focus on GRASS, we learned how R could be used as a ‘front end’ to other programs. An example using the famous ‘Cholera pump’ data mapped by &lt;a href=&quot;https://en.wikipedia.org/wiki/John_Snow&quot;&gt;John Snow&lt;/a&gt; was used to demonstrate the potential benefits of ‘bridging’ to other software. The data can be downloaded and partially plotted in R as follows:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://geostat-course.org/system/files/data_0.zip&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;download.file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data_0.zip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unzip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data_0.zip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;old&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setwd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;~/repos/geostat2016-rl/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;raster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## Loading required package: sp
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;bbo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shapefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data/bbo.shp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buildings&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shapefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data/buildings.shp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;deaths&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shapefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data/deaths.shp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_pump&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shapefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data/b_pump.shp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nb_pump&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shapefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data/nb_pump.shp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buildings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-3-1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;setwd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;old&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;In the afternoon Robert Hijmans gave a high level overview of software for spatial data analysis, with a discussion of the &lt;a href=&quot;http://www.diva-gis.org/&quot;&gt;Diva GIS&lt;/a&gt; software he developed and why he now uses R for most of his geospatial analysis.&lt;/p&gt;

&lt;p&gt;The talk touched on the &lt;a href=&quot;https://cran.r-project.org/web/packages/gdistance/&quot;&gt;&lt;strong&gt;gdistance&lt;/strong&gt;&lt;/a&gt; package, and many others. Robert showcased the power of R for understanding major civilisational problems such as the impacts of climate change on agriculture. His animated global maps of agricultural productivity and precipitation showed how R can scale to tackle large datasets, up to the global level involving spatial and temporal data simultaneously.&lt;/p&gt;

&lt;p&gt;There were a few political asides. Robert mentioned how agrotech giant Monsanto paid almost &lt;a href=&quot;https://www.fastcoexist.com/3019387/why-monsanto-just-spent-1-billion-to-buy-a-climate-data-company&quot;&gt;$1 billion&lt;/a&gt; for a weather prediction company. He detoured deftly through a discussion of ‘big data’, making the observation that often ensembles of models can provide better predictions than any single model working on its own, with political analogies about the importance of democracy.&lt;/p&gt;

&lt;p&gt;More examples included health and estimates of dietary deficiencies at high levels of geographic resolution. A paper showing fish and fruit consumption across Rwanda illustrated how map making in R, used intelligently, can save lives.&lt;/p&gt;

&lt;p&gt;It was revealing to learn how Robert got into R. While he was working at the &lt;a href=&quot;http://irri.org/&quot;&gt;International Rice Research Institute&lt;/a&gt;. “It forces you to write scripts.” This is good for ensuring reproducibility, a critical component of scientific research. It encourages you to focus on and understand the data primarily, rather than visualising it. On the other hand, R is not always the fastest way to do things, although “people often worry too much about this”. Your time is more important than your computers, so setting an analysis running is fine. Plus there are ways to make things run faster, as mentioned in a book that I’m working on, &lt;a href=&quot;https://csgillespie.github.io/efficientR/&quot;&gt;Efficient R Programming&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;R is great if you use it every data, but if you only use it less than once a week it becomes difficult.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;If you just want a one-off spatial analysis data program, Robert recommended QGIS. After a brief overview of spatial data in R, Robert moved on to talk about the &lt;a href=&quot;https://cran.r-project.org/web/packages/raster/index.html&quot;&gt;&lt;strong&gt;raster&lt;/strong&gt;&lt;/a&gt; package, which he developed. This package was developed to overcome some of the limitations with &lt;strong&gt;sp&lt;/strong&gt;, the foundational package for spatial data in R.&lt;/p&gt;

&lt;!-- This led on to discussion of C++ code, which Robert is increasingly developing in to extend **raster**. Here is a brief benchmark to show how much faster C++ code can be: --&gt;
&lt;!-- ```{r} --&gt;
&lt;!-- sumR = function(x){ --&gt;
&lt;!--   b = NULL --&gt;
&lt;!--   for(i in 1:length(x)){ --&gt;
&lt;!--     b = b + a[i] --&gt;
&lt;!--   } --&gt;
&lt;!-- } --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ```{r, engine='cpp', eval=FALSE} --&gt;
&lt;!-- library(Rcpp) --&gt;
&lt;!-- cppFunction(code =  --&gt;
&lt;!--               &quot;// [[Rcpp::export]] --&gt;
&lt;!-- double cumulater(std::vector&lt;doubl&gt;d) { --&gt;
&lt;!--   int n = x.size(); --&gt;
&lt;!--   double result = 0; --&gt;
&lt;!--   for (int i=0;i &lt; n; i++) { --&gt;
&lt;!--     result = result + d[i]; --&gt;
&lt;!--   } --&gt;
&lt;!--   double r = cumulater(v) --&gt;
&lt;!-- }return r;&quot;) --&gt;
&lt;!-- ``` --&gt;
&lt;!-- According to Robert, once you can write R functions, &quot;writing C++ functions is relatively easy&quot;. While I'm not quite convinced, based on the number of characters needed to write a simple sum code, he certainly convinced me of the merits of developing new spatial functions in this low level language, because of its speed and the fact that it's the main development language of GDAL.  --&gt;
&lt;p&gt;A final resource that Robert promoted was &lt;a href=&quot;http://www.rspatial.org/&quot;&gt;RSpatial.org&lt;/a&gt;, a free online resource for teaching R as a command line GIS.&lt;/p&gt;

&lt;p&gt;Edzer Pebesmer delivered the final session of the first day, on &lt;strong&gt;Free and Open Source Software (FOSS) for Geoinformatics and Geosciences&lt;/strong&gt;. After the highly technical final C++ examples from the previous talk, I was expecting a high level overview of the landscape. Instead Edzer went straight in to talk about source code, the raw material that defines all software. The fundamental feature of open source software is that its source code is free, and will remain free.&lt;/p&gt;

&lt;!-- An example of this is Apple, the most profitable computer company on Earth, used parts of the BSD kernel in its proprietary operating system. --&gt;
&lt;!-- Another feature of open source software is that it must have a license. It has a legal meaning, the details of which vary from licence to license. By deciding a license, you can choose whether you use a more *restrictive* license (which prevents people from using the software in software that is solved) or a more *permisive* license. R's 'backend' is licensed --&gt;
&lt;!-- GPL is used for R's. ESRI is now using R as a back-end in commercial software. Its lawers have explored the legal implications of this and concluded that it is not breaking the law by doing so. --&gt;
&lt;!-- GitHub is an online system for developing open source software. It is free to use, but some of the best things in GitHub are not open source. Edzer says that the advantages of using their service, in terms of community engagement and ease of use and accessibility, currently outweigh any potential future disbenefits of GitHub not being completely open source.  --&gt;
&lt;!-- Another example is open source software for geosciences. Researchers may want to make their software open for anyone to use, while remaining protected from exploitation from large companies like oil com --&gt;
&lt;p&gt;Day 2
—–&lt;/p&gt;

&lt;p&gt;The second day of the course was divided in two: stream A focussed on environmental modelling and stream B compositional data. I attended the environmental modelling course taught by Robert Hijmans. The course was based on his teaching material at &lt;a href=&quot;http://rspatial.org/spatial/index.html&quot;&gt;rspatial.org&lt;/a&gt; and can be found &lt;a href=&quot;http://gfc.ucdavis.edu/events/albacete/day2.html&quot;&gt;online&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We started off by looking at the fundamental data structures underlying spatial data in R. Why? It’s useful to be able to create simple example datasets from scratch, to understand them.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data.frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SpatialPoints&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## class       : SpatialPoints 
## features    : 4 
## extent      : 3, 8, 6, 12  (xmin, xmax, ymin, ymax)
## coord. ref. : NA
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data.frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;LETTERS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SpatialPointsDataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coords&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-6-1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The basic functions of the &lt;strong&gt;raster&lt;/strong&gt; package are similar.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;raster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;raster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nc&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nr&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ncell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-7-1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;as.matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    1    2    3    4    5    6    7    8    9    10
##  [2,]   11   12   13   14   15   16   17   18   19    20
##  [3,]   21   22   23   24   25   26   27   28   29    30
##  [4,]   31   32   33   34   35   36   37   38   39    40
##  [5,]   41   42   43   44   45   46   47   48   49    50
##  [6,]   51   52   53   54   55   56   57   58   59    60
##  [7,]   61   62   63   64   65   66   67   68   69    70
##  [8,]   71   72   73   74   75   76   77   78   79    80
##  [9,]   81   82   83   84   85   86   87   88   89    90
## [10,]   91   92   93   94   95   96   97   98   99   100
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-7-2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# r is recycled so each layer is multiplied by r
&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# here 2 is recycled
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] 2 4 6
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Raster also provides simple yet powerful functions for manipulating and analysing raster data, including &lt;code class=&quot;highlighter-rouge&quot;&gt;crop()&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;merge()&lt;/code&gt; for manipulation and &lt;code class=&quot;highlighter-rouge&quot;&gt;predict()&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;focal()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;distance()&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;predict()&lt;/code&gt; is particularly interesting as it allows raster values to be estimated using any of R’s powerful statistical methods.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dismo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Albacete, Spain&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lonlat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## Loading required namespace: XML
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;interpolate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-9-1.png&quot; alt=&quot;&quot; /&gt;&lt;img src=&quot;https://github.com/npct/pct/raw/master/figures/unnamed-chunk-9-2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;dismo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geocode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Universidad Castilla la Mancha&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;##                    originalPlace
## 1 Universidad Castilla la Mancha
##                                          interpretedPlace longitude
## 1 Paseo Universidad, 13005 Ciudad Real, Cdad. Real, Spain -3.921711
##   latitude      xmin      xmax     ymin     ymax uncertainty
## 1 38.99035 -3.922007 -3.919309 38.98919 38.99189         131
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;!-- Supervised learning is the process of allowing a computer to estimate predictor variables based on explanatory variables. --&gt;
&lt;!-- There are 2 main things to consider when model fitting: the functional form to use and the explanatory variables X. --&gt;
&lt;!-- We worked through a practical on spatial interpolation from [rspatial.org](http://rspatial.org/analysis/rst/4-interpolation.html): --&gt;
&lt;!-- ```{r} --&gt;
&lt;!-- dir.create(&quot;data&quot;) --&gt;
&lt;!-- download.file(&quot;http://rspatial.org/analysis/data/precipitation.csv&quot;, &quot;data/precipitation.csv&quot;) --&gt;
&lt;!-- d = read.csv(&quot;data/precipitation.csv&quot;) --&gt;
&lt;!-- d$prec &lt;- rowSums(d[, c(6:17)]) --&gt;
&lt;!-- plot(sort(d$prec), ylab='Annual precipitation (mm)', las=1, xlab='Stations') --&gt;
&lt;!-- library(sp) --&gt;
&lt;!-- dsp &lt;- SpatialPoints(d[,4:3], proj4string=CRS(&quot;+proj=longlat +datum=NAD83&quot;)) --&gt;
&lt;!-- dsp &lt;- SpatialPointsDataFrame(dsp, d) --&gt;
&lt;!-- download.file(&quot;http://rspatial.org/analysis/data/counties.rds&quot;, &quot;data/counties.rds&quot;) --&gt;
&lt;!-- CA &lt;- readRDS(&quot;data/counties.rds&quot;) --&gt;
&lt;!-- # define groups for mapping --&gt;
&lt;!-- cuts &lt;- c(0,200,300,500,1000,3000) --&gt;
&lt;!-- # set up a palette of interpolated colors --&gt;
&lt;!-- blues &lt;- colorRampPalette(c('yellow', 'orange', 'blue', 'dark blue')) --&gt;
&lt;!-- pols &lt;- list(&quot;sp.polygons&quot;, CA, fill = &quot;lightgray&quot;) --&gt;
&lt;!-- spplot(dsp, 'prec', cuts=cuts, col.regions=blues(5), sp.layout=pols, pch=20, cex=2) --&gt;
&lt;!-- TA &lt;- CRS(&quot;+proj=aea +lat_1=34 +lat_2=40.5 +lat_0=0 +lon_0=-120 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +ellps=GRS80 +towgs84=0,0,0&quot;) --&gt;
&lt;!-- library(rgdal) --&gt;
&lt;!-- dta &lt;- spTransform(dsp, TA) --&gt;
&lt;!-- cata &lt;- spTransform(CA, TA) --&gt;
&lt;!-- ``` --&gt;
&lt;!-- Now the modelling work can begin.  --&gt;
&lt;!-- ```{r} --&gt;
&lt;!-- # First create a function to calculate the error: --&gt;
&lt;!-- RMSE &lt;- function(observed, predicted) { --&gt;
&lt;!--   sqrt(mean((predicted - observed)^2, na.rm=TRUE)) --&gt;
&lt;!-- } --&gt;
&lt;!-- null &lt;- RMSE(mean(dsp$prec), dsp$prec) --&gt;
&lt;!-- null --&gt;
&lt;!-- library(dismo) --&gt;
&lt;!-- v &lt;- voronoi(dta) --&gt;
&lt;!-- ## Loading required namespace: deldir --&gt;
&lt;!-- plot(dsp) --&gt;
&lt;!-- plot(v) --&gt;
&lt;!-- points(dta, col = &quot;red&quot;) --&gt;
&lt;!-- ca = aggregate(cata) --&gt;
&lt;!-- plot(ca) --&gt;
&lt;!-- vca = intersect(v, ca) --&gt;
&lt;!-- plot(vca) --&gt;
&lt;!-- vca2 = rgeos::gIntersection(v, ca, byid = T) --&gt;
&lt;!-- names(vca2) --&gt;
&lt;!-- plot(vca2) # not the same! --&gt;
&lt;!-- plot(vca) --&gt;
&lt;!-- names(vca) --&gt;
&lt;!-- ``` --&gt;
&lt;!-- Testing a first model --&gt;
&lt;!-- ```{r} --&gt;
&lt;!-- kf = kfold(dta@data) --&gt;
&lt;!-- rmse = NULL --&gt;
&lt;!-- for(k in 1:length(unique(kf))){ --&gt;
&lt;!--   test = dta[kf == k,] --&gt;
&lt;!--   train = dta[kf != k,] --&gt;
&lt;!--   v = voronoi(train) --&gt;
&lt;!--   p = extract(v, test) --&gt;
&lt;!--   rmse[k] = RMSE(observed = test$prec, predicted = p$prec) --&gt;
&lt;!-- } --&gt;
&lt;!-- rmse --&gt;
&lt;!-- ``` --&gt;
&lt;p&gt;Day 3
—–&lt;/p&gt;

&lt;p&gt;The third day started with a live R demo by Edzer Pebesmer on &lt;a href=&quot;https://edzer.github.io/UseR2016/&quot;&gt;space-time data&lt;/a&gt;. Refreshingly for a conference primarily on spatial data, it started with an in-depth discussion of time. While base R natively supports temporal units (knowing the difference between days and seconds, for example) it does not know the difference between metres and miles.&lt;/p&gt;

&lt;p&gt;This led to the creation of the &lt;strong&gt;units&lt;/strong&gt; library, an taster of which is shown below:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;install.packages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;units&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;units&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ud_units&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ud_units&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;km&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ud_units&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;km&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ud_units&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The rest of the day was spent analysing a range of spatio-temporal datasets using &lt;strong&gt;spacetime&lt;/strong&gt;, &lt;strong&gt;trajectories&lt;/strong&gt; and &lt;strong&gt;rgl&lt;/strong&gt; for interactive 3d spacetime plots.&lt;/p&gt;

&lt;p&gt;In the parallel session there were sessions on &lt;a href=&quot;http://geostat-course.org/node/1328&quot;&gt;CARTO&lt;/a&gt; and the &lt;a href=&quot;http://geostat-course.org/node/1329&quot;&gt;R gvSIG bridge&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;day-4&quot;&gt;Day 4&lt;/h2&gt;

&lt;p&gt;Day 4 was a highlight for me as I’ve wanted to learn how to use the &lt;strong&gt;INLA&lt;/strong&gt; package for ages. It was explained lucidly by Marta Blangiardo and Michela Cameletti, who have written an excellent book on the subject, which has a &lt;a href=&quot;https://sites.google.com/a/r-inla.org/stbook/&quot;&gt;website that I recommend checking out&lt;/a&gt;. Their materials can be found here: &lt;a href=&quot;http://geostat-course.org/node/1330&quot;&gt;http://geostat-course.org/node/1330&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;In parallel to this there was a session on &lt;a href=&quot;http://geostat-course.org/node/1326&quot;&gt;Spatial and Spatiotemporal point process analysis in R&lt;/a&gt; data in R by Virgilio Gomez Rubio and one on automated &lt;a href=&quot;http://geostat-course.org/node/1323&quot;&gt;spatial prediction and visualisation&lt;/a&gt; by Tom Hengl.&lt;/p&gt;

&lt;h2 id=&quot;day-5&quot;&gt;Day 5&lt;/h2&gt;

&lt;p&gt;After all that intense geospatial analysis and programming activity, and a night out in Albacete for some participants, we were relieved to learn that this final day of learning was more relaxed. Furthermore, by tradition, it was largely participant-led. I gave a talk on &lt;a href=&quot;https://csgillespie.github.io/efficientR/&quot;&gt;Efficient R Programming&lt;/a&gt;, a book I’ve written in collaboration with Colin Gillespie; Teresa Rojos gave a fascinating talk about her research into the spatial distribution of cancer rates in Peru; and S.J. Norder gave us the low-down on the Biogeography of islands with R.&lt;/p&gt;

&lt;p&gt;One of the most exciting sessions was the revelation of the results of the spatial prediction game. Interestingly, a team using a relatively simple approach with &lt;a href=&quot;https://cran.r-project.org/web/packages/randomForestSRC/index.html&quot;&gt;&lt;strong&gt;randomForestSRC&lt;/strong&gt;&lt;/a&gt; (and &lt;a href=&quot;https://github.com/ehrlinger/ggRandomForests&quot;&gt;&lt;strong&gt;ggRandomForests&lt;/strong&gt;&lt;/a&gt; for visualisation) one against others who had spent hours training complex multi-level models.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;p&gt;Overall it was an amazing event and inspiring to spend time with so many researchers using open geospatial software for tackling &lt;a href=&quot;https://t.co/UqMyCnXOsG&quot;&gt;pressing real world issues&lt;/a&gt;. Furthermore, it was great fun. I strongly recommend people dipping their toes in the &lt;a href=&quot;https://cran.r-project.org/web/views/Spatial.html&quot;&gt;sea of spatial capabilities&lt;/a&gt; provided by R check out the &lt;a href=&quot;http://geostat-course.org/node&quot;&gt;GEOSTAT website&lt;/a&gt;, not least for the excellent &lt;a href=&quot;http://archive.org/search.php?query=GEOSTAT&quot;&gt;video resources to be found there&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I look forward to hearing plans for future GEOSTATs and recommend the event, and associated materials, to researchers interested in using free geospatial software for the greater good.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Modelling cycling potential with R</title>
   <link href="http://robinlovelace.github.com//2016/07/02/pct-shiny.html"/>
   <updated>2016-07-02T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2016/07/02/pct-shiny</id>
   <content type="html">&lt;p&gt;Here is some content.&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;Here’s some more!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>stplanr 0.1.1</title>
   <link href="http://robinlovelace.github.com//2016/01/18/stplanr-0.1.1.html"/>
   <updated>2016-01-18T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2016/01/18/stplanr-0.1.1</id>
   <content type="html">&lt;p&gt;Version 0.1.1 of the package
&lt;a href=&quot;https://cran.r-project.org/web/packages/stplanr/&quot;&gt;stplanr&lt;/a&gt; has been
released on CRAN. This is a major update with many new functions and a
new class definition, &lt;code class=&quot;highlighter-rouge&quot;&gt;SpatialLinesNetwork&lt;/code&gt;, for route planning and
network analysis using
&lt;a href=&quot;https://cran.r-project.org/web/packages/igraph/index.html&quot;&gt;igraph&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This short post, by myself and package co-author &lt;a href=&quot;http://sydney.edu.au/business/itls/staff/richarde&quot;&gt;Richard
Ellison&lt;/a&gt;, describes
how stplanr can be used for transport research with a few simple
examples from the package documentation. We hope that stplanr is of use
to transport researchers and practitioners worldwide and encourage
contributions to the development version hosted on
&lt;a href=&quot;https://github.com/ropensci/stplanr&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;working-with-origin-destination-data&quot;&gt;Working with origin-destination data&lt;/h2&gt;

&lt;p&gt;Origin-destination (OD) data is one of the basic data sources for
understanding travel behaviour. Usually OD data in R is represented by a
table containing at least the following columns:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Origin ID: a text string identifying the zone in which journeys
originate&lt;/li&gt;
  &lt;li&gt;Destination ID: a test string identifying the destination zone&lt;/li&gt;
  &lt;li&gt;Number of trips: the rate of travel between the unique OD pair&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Additional columns can provide a break-down by trip type such as by mode
of travel (e.g. car) and time of day. A sample of this data (also
referred to as ‘Flow data’ by some statistical organsiations) is
provided in the example dataset &lt;code class=&quot;highlighter-rouge&quot;&gt;flows&lt;/code&gt;, as illustrated in the Table
below.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;library(stplanr)

## Loading required package: sp

library(tmap)
data(&quot;flow&quot;)
knitr::kable(flow[1:3,c(1, 2, 3, 13)])
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th align=&quot;left&quot;&gt;&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;Area.of.residence&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;Area.of.workplace&lt;/th&gt;
&lt;th align=&quot;right&quot;&gt;All&lt;/th&gt;
&lt;th align=&quot;right&quot;&gt;On.foot&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td align=&quot;left&quot;&gt;920573&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;E02002361&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;E02002361&lt;/td&gt;
&lt;td align=&quot;right&quot;&gt;109&lt;/td&gt;
&lt;td align=&quot;right&quot;&gt;59&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td align=&quot;left&quot;&gt;920575&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;E02002361&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;E02002363&lt;/td&gt;
&lt;td align=&quot;right&quot;&gt;38&lt;/td&gt;
&lt;td align=&quot;right&quot;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td align=&quot;left&quot;&gt;920578&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;E02002361&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;E02002367&lt;/td&gt;
&lt;td align=&quot;right&quot;&gt;10&lt;/td&gt;
&lt;td align=&quot;right&quot;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;To link this data to geographical space we use a dataset stored as a
&lt;code class=&quot;highlighter-rouge&quot;&gt;SpatialPointsDataFrame&lt;/code&gt; from the sp package in &lt;code class=&quot;highlighter-rouge&quot;&gt;cents&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;data(cents)
plot(cents)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-2-1.png&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
 To link the flow data we can use the command &lt;code class=&quot;highlighter-rouge&quot;&gt;od2line()&lt;/code&gt; to create
&lt;code class=&quot;highlighter-rouge&quot;&gt;SpatialLinesDataFrame&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;odlines &amp;lt;- od2line(flow = flow, zones = cents)
plot(cents)
plot(odlines, add = TRUE)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-3-1.png&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
 Note that the function also accepts a &lt;code class=&quot;highlighter-rouge&quot;&gt;SpatialPolygonsDataFrame&lt;/code&gt; as an
input by setting the line start and end point to the zone’s geographic
centroid:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;odlines &amp;lt;- od2line(flow = flow, zones = zones)
plot(zones)
plot(odlines, add = TRUE)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-4-1.png&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
 To gain a basic understanding of the rate of travel in this simple
travel system, we can plot the &lt;code class=&quot;highlighter-rouge&quot;&gt;odlines&lt;/code&gt; with width proportional to the
number of people travelling:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;plot(odlines, lwd = odlines$All / mean(odlines$All) * 3, col = &quot;red&quot;)
plot(odlines, lwd = odlines$On.foot / mean(odlines$All) * 3, col = &quot;green&quot;, add = T)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-5-1.png&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
 In the resulting plot the total rate of travel is represented by the
width of red lines. The proportion of people who walk is illustrated by
the relationship between the width of the green and red lines. We can
use this data to explore the relationship between walking and distance:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;odlines &amp;lt;- spTransform(odlines, CRS(&quot;+init=epsg:27700&quot;))
odlines$dist &amp;lt;- rgeos::gLength(odlines, byid = T)
plot(odlines$dist, odlines$On.foot / odlines$All)

# fit a model to the curve
m &amp;lt;- lm(On.foot / All ~ dist, odlines@data)
lines(odlines$dist, m$fitted.values)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-6-1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;summary(m)

## 
## Call:
## lm(formula = On.foot/All ~ dist, data = odlines@data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.26915 -0.06987 -0.00694  0.06190  0.63195 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&amp;gt;|t|)    
## (Intercept)  5.365e-01  4.503e-02  11.915 8.36e-16 ***
## dist        -1.409e-04  2.501e-05  -5.633 9.64e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.1585 on 47 degrees of freedom
## Multiple R-squared:  0.403,  Adjusted R-squared:  0.3903 
## F-statistic: 31.73 on 1 and 47 DF,  p-value: 9.638e-07
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This is useful information: we can see a clear negative relationship
between the distance of the trip (in metres) and the proportion who are
willing to make the journey on foot.&lt;/p&gt;

&lt;h2 id=&quot;working-with-route-allocated-flow-data&quot;&gt;Working with route-allocated ‘flow’ data&lt;/h2&gt;

&lt;p&gt;stplanr includes functions for allocating OD pairs to the transport
network, including &lt;code class=&quot;highlighter-rouge&quot;&gt;route_cyclestreet()&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;route_graphhopper()&lt;/code&gt; and,
most rececently &lt;code class=&quot;highlighter-rouge&quot;&gt;viaroute()&lt;/code&gt; which provides an R interface to the
superfast &lt;a href=&quot;https://github.com/Project-OSRM/osrm-backend/wiki/Server-api&quot;&gt;OSRM routing
API&lt;/a&gt;. This
is useful because roads rarely take you directly from origin to
destination, as illustrated below for the trip from Leeds to London one could
take to to
attend the upcoming &lt;a href=&quot;http://www.gre.ac.uk/ach/services/events/gisruk2016/home&quot;&gt;GISRUK
conference&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;route &amp;lt;- route_cyclestreet(&quot;Leeds&quot;, &quot;Greenwich&quot;)
library(tmap)
tiles &amp;lt;- read_osm(bb(route, ext = 2))
tm_shape(tiles) +
  tm_raster() +
  tm_shape(route) +
  tm_lines()
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-8-1.png&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
 We can allocate all of the OD pairs in &lt;code class=&quot;highlighter-rouge&quot;&gt;odlines&lt;/code&gt; to the transport
network using these functions. The &lt;code class=&quot;highlighter-rouge&quot;&gt;routes_fast&lt;/code&gt; dataset, for example,
was created using &lt;code class=&quot;highlighter-rouge&quot;&gt;line2route()&lt;/code&gt; and represents the rastest route that a
cyclist may take, according to the &lt;a href=&quot;http://www.cyclestreets.net/api/&quot;&gt;CycleStreets.net
API&lt;/a&gt;. A sample of this dataset is
illustrated below:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;routes_fast$weight &amp;lt;- c(5, 10)
plot(routes_fast[1:2,], lwd = routes_fast$weight)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-9-1.png&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
 Note that there is some overlap between the two lines above. It is
sometimes useful to take aggregate statistics for the attributes of
overlapping lines, for example to estimate the number of people using
any particular part of the transport network. This can be acheived using
&lt;a href=&quot;http://gis.stackexchange.com/questions/139681/overlaying-lines-and-aggregating-their-values-for-overlapping-segments&quot;&gt;Barry
Rowlingson’s&lt;/a&gt;
function &lt;code class=&quot;highlighter-rouge&quot;&gt;overline()&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rnet &amp;lt;- overline(routes_fast[1:2,], attrib = &quot;weight&quot;, fun = sum)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Note that in the above plot the final segment to the east has a &lt;code class=&quot;highlighter-rouge&quot;&gt;weight&lt;/code&gt;
value that is the sum of the two overlapping lines in
&lt;code class=&quot;highlighter-rouge&quot;&gt;routes_fast[1:2,]&lt;/code&gt;: 5 + 10 = 15. We can verify this with Barry’s neat
function&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;plot(rnet, lwd = rnet$weight, col = &quot;red&quot;)
lineLabels(rnet, &quot;weight&quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-11-1.png&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
 ## Other functions&lt;/p&gt;

&lt;p&gt;There are many other functions designed to help transport researchers in
&lt;code class=&quot;highlighter-rouge&quot;&gt;stplanr&lt;/code&gt;. These include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;read_stats19*&lt;/code&gt; functions which import and format UK ‘Stats19’ road
traffic casualty data&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;calc_catchment*&lt;/code&gt; functions for calculating transport ‘catchment
areas’ using buffers around transport facilities&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gtfs2sldf()&lt;/code&gt; for reading-in Google’s
&lt;a href=&quot;https://developers.google.com/transit/gtfs/?hl=en&quot;&gt;GTFS&lt;/a&gt; format
into R&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;toptail*&lt;/code&gt; functions for removing the beginning and ends of
&lt;code class=&quot;highlighter-rouge&quot;&gt;SpatialLines&lt;/code&gt; objects&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The use of the &lt;code class=&quot;highlighter-rouge&quot;&gt;calc_catchment*&lt;/code&gt; functions can be illustrated using some
simple data from Sydney showing the potential catchment of a possible
separated cycle paths. First we import the data that we want to use:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;library(rgdal)

## rgdal: version: 1.1-3, (SVN revision 594)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 1.11.2, released 2015/02/10
##  Path to GDAL shared files: /usr/share/gdal/1.11
##  Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
##  Path to PROJ.4 shared files: (autodetected)
##  Linking to sp version: 1.2-2

data_dir &amp;lt;- system.file(&quot;extdata&quot;, package = &quot;stplanr&quot;)
unzip(file.path(data_dir, 'smallsa1.zip'))
unzip(file.path(data_dir, 'testcycleway.zip'))
sa1income &amp;lt;- readOGR(&quot;.&quot;,&quot;smallsa1&quot;) # Import some population data

## OGR data source with driver: ESRI Shapefile 
## Source: &quot;.&quot;, layer: &quot;smallsa1&quot;
## with 638 features
## It has 19 fields

testcycleway &amp;lt;- readOGR(&quot;.&quot;,&quot;testcycleway&quot;) # Import the path of the cycleways to test

## OGR data source with driver: ESRI Shapefile 
## Source: &quot;.&quot;, layer: &quot;testcycleway&quot;
## with 2 features
## It has 2 fields
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;We can then use our population data and the path of the cycleways to
estimate the population catchment for a given distance. If our
population layer contains fields with multiple subsets of data for which
we want to calculate the catchment area (e.g., men, women and children),
we can calculate the individual catchments. For this example, we will
simply use the ‘Total’ field containing the total population:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cycle_catchment &amp;lt;- calc_catchment(
  polygonlayer = sa1income, # The SpatialPolygonsDataFrame containing the population data
  targetlayer = testcycleway, # The Spatial* object containing the transport infrastructure of interest
  calccols = c('Total'), # The columns to summarise
  distance = 500, # The desired distance,
  projection = 'austalbers', # The projection to use for calculating the area
  dissolve = TRUE # Collapse all the population zones into a single polygon for the catchment
)
cycle_catchment$Total # Print the total catchment population

## [1] 23944.32
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;We can also plot the catchment area and the cycle paths. You will notice
that in this example, there are gaps in the buffers. These gaps are
because of the gaps in the population layer where Sydney harbour passes
through the area. To take into account the road network and not simply
straight-line distance, we can use the &lt;code class=&quot;highlighter-rouge&quot;&gt;calc_network_catchment&lt;/code&gt;
function.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;plot(cycle_catchment)
plot(testcycleway, col=&quot;red&quot;, add=TRUE, lwd=2)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-14-1.png&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
 The toptail functionality is useful for removing the beginning and ends
of SpatialLines, both for improving aestetchics of plots and for
ensuring that lines do not overlap. This functionality is illustrated
below using the &lt;code class=&quot;highlighter-rouge&quot;&gt;routes_fast&lt;/code&gt; data.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;proj4string(routes_fast) &amp;lt;- CRS(&quot;+init=epsg:4326&quot;)
rf_toptailed &amp;lt;- toptail(routes_fast, toptail_dist = 300)
plot(routes_fast, col = &quot;red&quot;, lwd = 5)
plot(rf_toptailed, add = T)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/2016-01-18-stplanr-0.1.1_files/figure-markdown_strict/unnamed-chunk-15-1.png&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
 The package
&lt;a href=&quot;https://cran.r-project.org/web/packages/stplanr/vignettes/introducing-stplanr.html&quot;&gt;vignette&lt;/a&gt;
contains some further illustrations of &lt;code class=&quot;highlighter-rouge&quot;&gt;stplanr&lt;/code&gt;’s functions which we
plan to improve on over time. While become almost ‘industry standard’ in
fields such as diverse as &lt;a href=&quot;http://www.nature.com/news/programming-tools-adventures-with-r-1.16609&quot;&gt;genetics, astronomy and
epidemiology&lt;/a&gt;,
R has received limited attention in transport planning. We believe that
there is great potential for R, via new packages such as stplanr, to
help solve real world transport problems such as &lt;a href=&quot;http://arxiv.org/abs/1509.04425&quot;&gt;estimating the
geographical distribution of cycling
potential&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The ‘sustainable’ in the package name relates to the emphasis on
low-carbon modes in the package such as cycling and public transport.
There is a huge amount of work to be done to plan for a transition away
from fossil fuels in the sector, for
&lt;a href=&quot;http://www.bma.org.uk/transport&quot;&gt;health&lt;/a&gt; and
&lt;a href=&quot;http://www.sciencedirect.com/science/article/pii/S0966692314001586&quot;&gt;environmental&lt;/a&gt;
reasons. In this context we hope that software such as &lt;code class=&quot;highlighter-rouge&quot;&gt;stplanr&lt;/code&gt;
contributes to the evidence base needed to design better transport
systems.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>R and other open source tools for Civil Engineering</title>
   <link href="http://robinlovelace.github.com//2015/10/22/R-for-civil-engineering.html"/>
   <updated>2015-10-22T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2015/10/22/R-for-civil-engineering</id>
   <content type="html">&lt;p&gt;Open source software has caused a quiet revolution in computing since
the creation of the GPL license by Richard Stallman back in
&lt;a href=&quot;https://en.wikipedia.org/wiki/GNU_General_Public_License&quot;&gt;1989&lt;/a&gt;. Yet it has been slow
to gain ascendency in many areas, including Civil Engineering. This short post discusses this
issue in the context of the uptake of QGIS and R for spatial analysis work, with reference
to a lecture delivered to undergraduate Civil Engineering students at the University of Leeds
(see slides below and as a &lt;a href=&quot;http://robinlovelace.net/presentations/pct-pres.html&quot;&gt;stand-alone html page here&lt;/a&gt;):&lt;/p&gt;

&lt;!--more--&gt;

&lt;iframe src=&quot;http://robinlovelace.net/presentations/pct-pres.html&quot; width=&quot;900&quot; height=&quot;700&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;What began as a fringe movement within ‘hacker’ circles has taken over parts of computing the world.
Linux, which provides the backbone of the popular Android smartphone operating system,
is probably the most successful software project ever and owes at least part of its success to its
open source licence. In the world of statistics, there is a clear trend towards open source.
R is outpacing closed source alternatives such as Stata, SPSS and SAS 
&lt;a href=&quot;http://r4stats.com/2015/03/30/fastest-growing-analytics-2015/&quot;&gt;in academic work&lt;/a&gt; and this
trend looks set to continue in the world of commercial data analysis and ‘data science’.&lt;/p&gt;

&lt;p&gt;Illustrating this shift in attitude, Hadley Wickham
&lt;a href=&quot;https://www.reddit.com/r/dataisbeautiful/comments/3mp9r7/im_hadley_wickham_chief_scientist_at_rstudio_and/&quot;&gt;recently said&lt;/a&gt; in response to a question on
whether there was any reason to use SAS or SPSS in the modern world with:
“You have a whole bunch of money you want to get rid of? :)”&lt;/p&gt;

&lt;p&gt;Other branches of applied computing have been slower to adopt. Civil Engineering is
one of these areas, in which established products such as
&lt;a href=&quot;http://www.bentley.com/en-gb/Products/GEOPAK+Civil+Engineering+Suite/&quot;&gt;Bentley’s GEOPAK&lt;/a&gt;
&lt;a href=&quot;http://www.autodesk.co.uk/products/autocad-civil-3d/overview&quot;&gt;AutoCAD&lt;/a&gt; dominating the market.
It is interesting to note that in the Wikipedia page on
&lt;a href=&quot;https://en.wikipedia.org/wiki/Civil_engineering_software&quot;&gt;Civil engineering software&lt;/a&gt;
there is no mention of open source products, rasing the question: where are they?&lt;/p&gt;

&lt;p&gt;In the related field of GIS, the dominance of proprietary software has been challenged by
open source products such as &lt;a href=&quot;http://www.qgis.org/en/site/&quot;&gt;QGIS&lt;/a&gt;, raising the question:
why has this not happened in Civil Engineering. This was one of the questions
that came up in a lecture I delivered at the University of Leeds to 3rd year
Civil Engineering students. I found that although a majority of students had heard of
and used open source software for their everyday life, its update in an academic context was limited.&lt;/p&gt;

&lt;p&gt;From a Transport Engineering perspective, there are already options out there in the areas of
general spatial analysis and modelling transport flows. A recently created add-on to
QGIS, &lt;a href=&quot;http://www.aequilibrae.com/&quot;&gt;Aequilibrea&lt;/a&gt; provides much of the functionality
expected of professional transport planning projects. In addition, an R package I am developing
for transport planning work could be of use to some high-level Transport Engineering applications:
&lt;a href=&quot;https://github.com/Robinlovelace/stplanr&quot;&gt;stplanr&lt;/a&gt; facilitates the visualisation, analysis and
(via online APIs) network allocation of movement patterns represented by origin-destination
(OD) matrices.&lt;/p&gt;

&lt;p&gt;The lack of mainstream software for Civil Engineering creates a huge opportunity for
developers, practitioners and educators in the discipline to be an ‘early adopter’
and guide the way forward for making research more accessible and transparent for all.
The list of &lt;a href=&quot;http://sourceforge.net/directory/science-engineering/mechcivileng/os:linux/freshness:recently-updated/&quot;&gt;Mechanical and Civil Engineering Software&lt;/a&gt;
on the code hosting site SourceForge is an indication of the way things could go.&lt;/p&gt;

&lt;p&gt;Furthermore, there are indications that the dynamic and fast-growing users communities
in R and Python could help ‘fill the gap’ in free software for Engineering.
The &lt;a href=&quot;https://cran.fhcrc.org/web/packages/reservoir/index.html&quot;&gt;&lt;strong&gt;reservoir&lt;/strong&gt;&lt;/a&gt; R package
provides “tools for analysis, design, and operation of water supply storages” while
&lt;a href=&quot;https://pypi.python.org/pypi/strupy/&quot;&gt;strupy&lt;/a&gt; is a
“structural engineering design python package”.&lt;/p&gt;

&lt;p&gt;The advantages of these script-based software solutions is their flexibility: learning
a command-line interface such as R provides the potential for taking existing code and
modifying it to your own needs, a common requirement in enginneering applications
of all types. Batch-processing and reproducibility are additional advantages that
allow one’s solutions to scale.&lt;/p&gt;

&lt;p&gt;In summary, open source software such as R are little-used in Civil Engineering
but have huge potential for growth. Insights from the related realm of GIS
suggest that this may change and that the current crop of products could be
the beginning of a ‘phase shift’ in software for Civil Engineering.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>GEOSTAT 2015: a write-up</title>
   <link href="http://robinlovelace.github.com//2015/08/31/geostat-writeup.html"/>
   <updated>2015-08-31T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2015/08/31/geostat-writeup</id>
   <content type="html">&lt;p&gt;The week before last I attended the &lt;a href=&quot;http://geostat-course.org&quot;&gt;GEOSTAT&lt;/a&gt; summer school in Lancaster. GEOSTAT is an annual week-long meeting devoted to ‘geostatistics’ (or ‘spatial statistics’ - we’ll come on to the difference subsequently).&lt;/p&gt;

&lt;p&gt;Having seen the impressive range of materials from previous ‘GEOSTATs’, I was greatly looking forward to the event as a hub of learning, research and community-building, organised by people at the cutting edge of the field. I was not disappointed. The purpose of this post is to say ‘heads up’ to people who are interested, not only in the field of geostatistics but also in free and open source software for geospatial applications (‘&lt;a href=&quot;http://foss4g.org/&quot;&gt;FOSS4G&lt;/a&gt;’) and research-focussed communities using and developing R more widely. For educators, this post also serves to highlight a cache of frankly amazing teaching materials that lie, largely undiscovered, online free for all to use.&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;geostatistics-vs-spatial-statistics&quot;&gt;Geostatistics vs Spatial Statistics&lt;/h2&gt;

&lt;p&gt;The introductory talk was by Professor Pete Diggle from the host institution of the University of Lancaster. He delivered a sweeping overview of the field, tracing the development of spatial statistics from its historical antecedents such as &lt;a href=&quot;https://en.wikipedia.org/wiki/Buffon's_needle&quot;&gt;Buffon’s needle&lt;/a&gt; through agricultural field trials at the famous &lt;a href=&quot;https://en.wikipedia.org/wiki/Rothamsted_Research&quot;&gt;Rothamsted&lt;/a&gt; site to its eventual merging with geostatistical methods developed by the mining industry. The final stage of this fascinating story was the incorporation of spatial statistics into wider statistical theory. The entire roller-coaster ride can be heard in an audio recording that I made of the lecture and read in chapter 1 of &lt;em&gt;The Handbook of Spatial Statists&lt;/em&gt; which can be &lt;a href=&quot;https://books.google.co.uk/books?id=Xf4leslPDzsC&amp;amp;printsec=frontcover#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;read online&lt;/a&gt; (although nothing beats the physical book) (Gelfand et al. 2010).&lt;/p&gt;

&lt;h2 id=&quot;the-evolving-landscape-of-rs-spatial-ecosystem&quot;&gt;The evolving landscape of R’s spatial ecosystem&lt;/h2&gt;

&lt;p&gt;The next wide-ranging and agenda-setting introductory lecture was by Roger Bivand, a veteran R developer and author of the seminal Applied Spatial Data Analysis with R (Bivand, Pebesma, and Gómez-Rubio 2013). His &lt;a href=&quot;http://geostat-course.org/system/files/geostat_talk_150817.pdf&quot;&gt;slides&lt;/a&gt; provide the best up-to-date overview of the state of R’s spatial capabilities available, to the best of my knowledge. Roger has a deep understanding not only of R’s spatial technology but also of its politics. This was illustrated by his commentary on the shifting attitude of ESRI towards R’s spatial capabilities, with reference to &lt;a href=&quot;https://github.com/R-ArcGIS/r-bridge&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;r-bridge&lt;/code&gt;&lt;/a&gt;, a mostly open source project allowing ArcMap users to call R scripts from within this popular proprietary GIS. Dangers for the future are fragmentation within R’s spatial community and the heavy reliance on a few veteran programmers while much of R’s core code-base is older than the latest generation R users!&lt;/p&gt;

&lt;h2 id=&quot;geostatistical-models-in-r&quot;&gt;Geostatistical models in R&lt;/h2&gt;

&lt;p&gt;Despite not attending this side of the parallel stream during day 2 I can recommend the &lt;a href=&quot;http://geostat-course.org/node/1284&quot;&gt;resources that were provided&lt;/a&gt;. Patrick Brown is an expert in spatial statistics and his tutorials and &lt;a href=&quot;http://pbrown.ca/teaching/geostat2015/&quot;&gt;worked examples&lt;/a&gt; could be gold dust for anyone who wants to use Bayesian inference to understand spatial processes.&lt;/p&gt;

&lt;p&gt;Brown (2015) provides a well-written academic companion to these excellent teaching materials, from the academic literature.&lt;/p&gt;

&lt;h2 id=&quot;the-spacetime-package&quot;&gt;The spacetime package&lt;/h2&gt;

&lt;p&gt;This session described methods for representing, processing and visualising spatio-temporal data, i.e. that has space and time dimensions. In addition to the ‘core’ &lt;strong&gt;spacetime package&lt;/strong&gt; developed by the lecturer Edzer Pebesma, the online tutorial described a number of packages that interact with spacetime to provide an impressive range of functionality. The following command, for example, subsets all the data in the spacetime object that from 2005 to 2011:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rural[sel,&quot;2005::2011&quot;]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This and many other examples of spacetime’s functionality are provided for free on &lt;a href=&quot;https://github.com/edzer/geostat/blob/master/Lancaster.Rmd&quot;&gt;Edzer’s GitHub repository&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;area-data-with-r&quot;&gt;Area data with R&lt;/h2&gt;

&lt;p&gt;Theresa Smith provided a fantastic introduction to areal data, whereby each unit - typically administrative zones - represents a contiguous tract of land. The discussion moved swiftly from the theory into practical application using &lt;strong&gt;spdep&lt;/strong&gt; and &lt;strong&gt;INLA&lt;/strong&gt; packages. The materials associated with this session are &lt;a href=&quot;http://geostat-course.org/node/1287&quot;&gt;online&lt;/a&gt;, providing a valuable resource to people struggling to make sense of areal data.&lt;/p&gt;

&lt;h2 id=&quot;reproducible-geography&quot;&gt;Reproducible geography&lt;/h2&gt;

&lt;p&gt;Chris Brunsdon provided an off-the-cuff tutorial on &lt;strong&gt;knitr&lt;/strong&gt; for making geographical research more accessible and easy to replicate. This reproducible ethic can be seen in his &lt;a href=&quot;http://geostat-course.org/node/1288&quot;&gt;teaching materials on Geographically Weighted Regression (GWR)&lt;/a&gt; and a recently published &lt;a href=&quot;http://phg.sagepub.com/cgi/doi/10.1177/0309132515599625&quot;&gt;academic paper (Brunsdon 2015)&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;the-summer-school-vibe&quot;&gt;The summer school vibe&lt;/h2&gt;

&lt;p&gt;There were many other highlights to the conference, many of which were not related to R. The conference had an excellent vibe and everyone to my knowledge had a great time. There were several social events (including an orienteering challenge around Lancaster!) which were fantastic, not to mention the provision of sufficient food, drink and caffeine to keep us all working hard. Instead of trying to do justice to all these things I’ll focus on two: the GEOSTAT &lt;em&gt;challenges&lt;/em&gt; and the ride home.&lt;/p&gt;

&lt;h3 id=&quot;challenges&quot;&gt;Challenges&lt;/h3&gt;

&lt;p&gt;To test our newly acquired skills the lecturers set a couple of challenges for the students: the &lt;em&gt;spatial prediction&lt;/em&gt; and &lt;em&gt;visualisation&lt;/em&gt; challenges. The spatial prediction challenge was to estimate the rainfall at specific points at specific times, based on a training dataset. The visualisation challenge was to visualise the data in a way that showed patterns in the data in space, time and altitude.&lt;/p&gt;

&lt;p&gt;A highlight for me was winning the visualisation challenge this this entry (thanks to assistance from Chris Brunsdon):&lt;/p&gt;

&lt;iframe src=&quot;http://geo8.webarch.net/robin/vizcomp/&quot; height=&quot;800&quot; width=&quot;800&quot;&gt;
&lt;/iframe&gt;
&lt;p&gt;More information on this entry can be seen in &lt;a href=&quot;http://rpubs.com/RobinLovelace/102391&quot;&gt;this mini article&lt;/a&gt;, which describes the use of the excellent &lt;strong&gt;RcppRoll&lt;/strong&gt; package with reference to the following image.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://rpubs.com/RobinLovelace/102391&quot;&gt;&lt;img src=&quot;https://dl.dropboxusercontent.com/u/15008199/img/rollmean.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;the-ride-home&quot;&gt;The ride home&lt;/h2&gt;

&lt;p&gt;Another highlight was the bicycle ride home back to Leeds, which passed through the glorious &lt;a href=&quot;http://forestofbowland.com/&quot;&gt;Bowland Forest AONB&lt;/a&gt;. It even passed through &lt;a href=&quot;https://en.wikipedia.org/wiki/Dunsop_Bridge&quot;&gt;Dunsop Bridge&lt;/a&gt;, which (according to BT at least!) is the centroid of Great Britain. Here’s an R challenge: test BT’s assertion (&lt;a href=&quot;https://plus.google.com/+RobinLovelace/posts/U9zz8F14ACH&quot;&gt;illustrated here&lt;/a&gt;)that this really is the geographic centroid of Great Britain, using only R code.&lt;/p&gt;

&lt;p&gt;Following the R fervour, I even planned this route in R, using the following code and which uses the &lt;a href=&quot;https://github.com/Robinlovelace/stplanr&quot;&gt;&lt;strong&gt;stplanr&lt;/strong&gt;&lt;/a&gt; I’m developing, leading to the map illustrated below:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;devtools::install_github(&quot;robinlovelace/stplanr&quot;)
library(stplanr)
r &amp;lt;- route_graphhopper(from = &quot;Lancaster University&quot;, to = &quot;Leeds&quot;)
library(leaflet)
leaflet() %&amp;gt;% addTiles() %&amp;gt;% addPolylines(data = r)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;iframe src=&quot;http://rpubs.com/RobinLovelace/106222&quot; width=&quot;600&quot; height=&quot;400&quot;&gt;
&lt;/iframe&gt;
&lt;p&gt;Resources
———&lt;/p&gt;

&lt;p&gt;Other than the links provided above, there are a number of additional excellent resources for teaching R as a free and open source command-line Geographical Information System (GIS). In addition to the highly recommended &lt;a href=&quot;http://www.geostat-course.org/2015&quot;&gt;GEOSTAT website&lt;/a&gt;, &lt;a href=&quot;http://gis.stackexchange.com/&quot;&gt;gis.stackexchange&lt;/a&gt; and the &lt;a href=&quot;https://stat.ethz.ch/mailman/listinfo/r-sig-geo&quot;&gt;r-sig-geo&lt;/a&gt; mailing group, these are, in roughly increasing order of difficulty:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;&lt;em&gt;Introduction to visualising spatial data&lt;/em&gt;&lt;/a&gt; is an introductory tutorial by myself, James Cheshire and others (Lovelace and Cheshire 2014) which aims to help people who are just getting started with R and spatial data. It has numerous challenges for all abilities and covers a range of approaches for creating maps in R, including R’s base graphics, &lt;a href=&quot;https://github.com/dkahle/ggmap&quot;&gt;ggmap&lt;/a&gt;, &lt;a href=&quot;https://github.com/mtennekes/tmap&quot;&gt;tmap&lt;/a&gt; and &lt;a href=&quot;https://github.com/rstudio/leaflet&quot;&gt;leaflet&lt;/a&gt; for creating online interactive maps, such &lt;a href=&quot;http://geo8.webarch.net/robin/vizcomp/&quot;&gt;this&lt;/a&gt; (described subsequently).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.lulu.com/shop/tomislav-hengl/a-practical-guide-to-geostatistical-mapping/ebook/product-17389015.html&quot;&gt;A Practical Guide to Geostatistical Mapping&lt;/a&gt; by GEOSTAT lecturer Tom Hengl is free E-Book outlining powerful geostatistical methods and visualisation techniques (focussed Google Earth), primarily in R.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;ftp://ftp.bgc-jena.mpg.de/pub/outgoing/mforkel/Rcourse/&quot;&gt;Analysis of spatial data in R&lt;/a&gt; provides an up-to-date overview of spatial data analysis in R from a Biogeochemistry perspective. It contains worked examples, challenges and solutions.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The &lt;a href=&quot;https://cran.r-project.org/web/packages/HSAUR2/&quot;&gt;Handbook of Spatial Analysis Using R, 2nd Edition&lt;/a&gt; is a comprehensive yet seemingly little-known textbook and R package dedicated to using R for a wide range of spatial applications. It contains a number of example datasets that may be of interest.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://cran.r-project.org/web/views/Spatial.html&quot;&gt;CRAN’s Spatial Task View&lt;/a&gt;, maintained by Roger Bivand, provides a wealth of links and information about R’s incredible and growing range of spatial packages.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;acknowledgements&quot;&gt;Acknowledgements&lt;/h2&gt;

&lt;p&gt;I would like to thank everyone involved for making GEOSTAT 2015 happen and really look forward to GEOSTAT 2016. Barry Rowlingson was central to making it happen so I salute him and Tom Hengl for herding all us cats towards Geo R Spatial Enlightenment. Until next year!&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;p&gt;Bivand, Roger S, Edzer J Pebesma, and Virgilio Gómez-Rubio. 2013. &lt;em&gt;Applied spatial data analysis with R&lt;/em&gt;. Vol. 747248717. Springer.&lt;/p&gt;

&lt;p&gt;Brown, Patrick E. 2015. “Model-Based Geostatistics the Easy Way.” &lt;em&gt;Journal of Statistical Software&lt;/em&gt; 63 (12): ??—–?? &lt;a href=&quot;http://www.jstatsoft.org/v63/i12&quot;&gt;http://www.jstatsoft.org/v63/i12&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Brunsdon, C. 2015. “Quantitative methods I: Reproducible research and quantitative geography.” &lt;em&gt;Progress in Human Geography&lt;/em&gt;. doi:&lt;a href=&quot;http://dx.doi.org/10.1177/0309132515599625&quot;&gt;10.1177/0309132515599625&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Gelfand, Alan E, Peter Diggle, Peter Guttorp, and Montserrat Fuentes. 2010. &lt;em&gt;Handbook of spatial statistics&lt;/em&gt;. CRC press.&lt;/p&gt;

&lt;p&gt;Lovelace, Robin, and James Cheshire. 2014. “Introduction to visualising spatial data in R.” &lt;em&gt;National Centre for Research Methods Working Papers&lt;/em&gt; 14 (03). London: National Centre for Research Methods; Comprehensive R Archive Network. &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R http://eprints.ncrm.ac.uk/3295/&quot;&gt;https://github.com/Robinlovelace/Creating-maps-in-R http://eprints.ncrm.ac.uk/3295/&lt;/a&gt;.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>R vs QGIS for sustainable transport planning</title>
   <link href="http://robinlovelace.github.com//2015/04/20/r-vs-qgis-for-transport.html"/>
   <updated>2015-04-20T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2015/04/20/r-vs-qgis-for-transport</id>
   <content type="html">&lt;p&gt;The 23rd iteration of the GIS Research UK conference
(&lt;a href=&quot;https://github.com/Robinlovelace/stplanr&quot;&gt;#GISRUK&lt;/a&gt;)
conference was the largest ever. 250 researchers,
industry representatives and academics attended from the
vibrant geospatial research communities in the
UK, Europe and beyond. GISRUK has become a centrepoint for discussion
of new methods, software and applications in the field. I
was on the &lt;a href=&quot;http://leeds.gisruk.org/contact.html&quot;&gt;organising committee&lt;/a&gt;,
reviewed some excellent papers for the event
(a full list of these is
&lt;a href=&quot;http://leeds.gisruk.org/programme.html&quot;&gt;available for download here&lt;/a&gt;) and 
attended some truly ground-breaking talks.
This experience has shown that the geospatial community
in the UK is strong,
especially with regards to growth in open access
data and open source software in the field.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.flickr.com/photos/97888609@N02/17025120518&quot; title=&quot;img_2814 by Robin Lovelace, on Flickr&quot;&gt;&lt;img src=&quot;https://farm6.staticflickr.com/5450/17025120518_ebfba47bff_s.jpg&quot; width=&quot;75&quot; height=&quot;75&quot; alt=&quot;img_2814&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;This article is about one part of GISRUK and insights gleaned from it
about R, QGIS and other tools for sustainable transport planning.
&lt;a href=&quot;https://github.com/Robinlovelace/GIS4TA&quot;&gt;GIS for Transport Applications&lt;/a&gt;
(&lt;a href=&quot;https://twitter.com/hashtag/gis4ta?src=hash&quot;&gt;#GIS4TA for short&lt;/a&gt;) was a practical day-long workshop
that preceded the main event.
I organised the workshop and (with help from
&lt;a href=&quot;http://www.geog.leeds.ac.uk/people/e.odiari&quot;&gt;Eusebio Odiari&lt;/a&gt;,
&lt;a href=&quot;https://tgrg.wordpress.com/&quot;&gt;The Transport Geography Research Group&lt;/a&gt;
and the
&lt;a href=&quot;http://www.rgs.org/HomePage.htm&quot;&gt;Royal Geographical Society&lt;/a&gt;)
it seems to have been a great success. More than 30
people attended, including a decent portion
from transport consultancies such as
&lt;a href=&quot;http://www.itpworld.net/index.html&quot;&gt;Integrated Transport Planning Ltd&lt;/a&gt;
&lt;a href=&quot;http://www.trpconsult.com/&quot;&gt;TRP Consulting&lt;/a&gt; and the
&lt;a href=&quot;http://www.era.europa.eu/Pages/Home.aspx&quot;&gt;European Railway Association (ERA)&lt;/a&gt;.
Specifically, it is about the use of R
and QGIS tools for transport planning and the potential for their
adoption in academic, public and private-sector transport planning.
The focus of the workshop was deliberately on open source software
and sustainable transport because these are growth
areas in the field that are essential for
democratic
and healthy
transport systems compatible with the
science of climate change (&lt;a href=&quot;http://www.opentraffic.net/en/&quot;&gt;&lt;span class=&quot;citation&quot;&gt;Tamminga, 2012&lt;/span&gt;&lt;/a&gt;).
A recent report, for example, suggests we need to almost completely
transition away from fossil fuels by 2050
(&lt;a href=&quot;http://dx.doi.org/10.1038/nature14016&quot;&gt;McGlade et al., 2015&lt;/a&gt;).
New datasets and methods for analysing and modelling them can
help get us there in the recalcitrant transport sector
(&lt;a href=&quot;http://dx.doi.org/10.1016/j.jtrangeo.2014.07.010&quot;&gt;Gossling, 2014&lt;/a&gt;).&lt;/p&gt;

&lt;h1 id=&quot;r-for-transport-applications&quot;&gt;R for transport applications&lt;/h1&gt;

&lt;p&gt;The workshop kicked-off with a short
talk on ‘R and QGIS for transport applications’,
which laid out some of the motivations for running the
workshop outlined above. Other than a few
‘early adopters’, the transport modelling community
is generally conservative, based largely on mature
proprietary products such as
&lt;a href=&quot;http://www.saturnsoftware.co.uk/7.html&quot;&gt;SATURN&lt;/a&gt;
and 
&lt;a href=&quot;http://vision-traffic.ptvgroup.com/en-us/products/ptv-vissim/&quot;&gt;Vissim&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The slides from this talk are available here:&lt;/p&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;91fce9cf5c36405b8969c6b6954c4fe6&quot; data-ratio=&quot;1.41436464088398&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;&lt;strong&gt;Tutorial: &lt;a href=&quot;https://github.com/Robinlovelace/GIS4TA/releases/download/0.1/intro-r-qgis-4ta.pdf&quot;&gt;Introduction to R and QGIS for transport applications&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h1 id=&quot;routing-with-r&quot;&gt;Routing with R&lt;/h1&gt;

&lt;p&gt;The second talk was by Nick Bearman, who provided an overview of
routing in R, as well as an excellent
&lt;a href=&quot;https://github.com/nickbearman/transport-workshop/blob/master/transport-workshop.pdf&quot;&gt;practical tutorial&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The practical demonstrated 2 ways of routing in R:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Using &lt;strong&gt;ggmap&lt;/strong&gt;. The following code was used to navigate to the event!&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;from &amp;lt;- 'Leeds station, New Station Street, Leeds LS1 5DL, United Kingdom'
to &amp;lt;- 'LS2 9JT'
route_df &amp;lt;- route(from, to, structure = 'route', mode = 'walking')
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;qmap('Merrion Centre', zoom = 15) +
  geom_path(
    aes(x = lon, y = lat),  colour = 'red', size = 1.5,
    data = route_df, lineend = 'round')
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/Robinlovelace/robinlovelace.github.io/raw/master/_posts/writeup_files/figure-html/unnamed-chunk-2-1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The &lt;a href=&quot;https://github.com/Robinlovelace/stplanr&quot;&gt;package I created, &lt;strong&gt;stplanr&lt;/strong&gt;&lt;/a&gt;,
to get routes optimised for cyclists (see &lt;a href=&quot;https://github.com/nickbearman/transport-workshop/blob/master/transport-workshop.Rmd&quot;&gt;transport-workshop.Rmd&lt;/a&gt; for a working version):&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rquiet &amp;lt;- gLines2CyclePath(l = rlines, plan = &quot;quietest&quot;)
plot(rquiet[1,]) # route from Leeds station to Leeds University (North - South)
plot(rquiet[2,]) # route from Leeds to Manchester!
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/Robinlovelace/robinlovelace.github.io/raw/master/_posts/writeup_files/figure-html/unnamed-chunk-4-1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Tutorial: &lt;a href=&quot;https://github.com/nickbearman/transport-workshop/blob/master/transport-workshop.pdf&quot;&gt;Route analysis using R&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h1 id=&quot;large-gps-datasets-with-postgis&quot;&gt;Large gps datasets with PostGIS&lt;/h1&gt;

&lt;p&gt;The most technical session involved using R to query huge datasets storing
GPS data containing 100,000+ rows. Amazingly, Richard and Adrian Ellison
set up a remotely accessible database instance &lt;strong&gt;from their laptop&lt;/strong&gt; which
participants queried via
&lt;a href=&quot;http://cran.r-project.org/web/packages/RPostgreSQL/index.html&quot;&gt;&lt;strong&gt;RPostgreSQL&lt;/strong&gt;&lt;/a&gt;.
Their session information can be seen here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/richardellison/GIS4TA_GPS&quot;&gt;&lt;strong&gt;github.com/richardellison/GIS4TA_GPS&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;a-hackathon&quot;&gt;A hackathon&lt;/h1&gt;

&lt;p&gt;Finally there was a miniature hackathon organised by Godwin Yeboah.
Participants made progress in better understanding the travel
patterns of cyclists using real data. The hackathon notes can be found here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/spatialscientist/GIS4TA2015&quot;&gt;github.com/spatialscientist/GIS4TA2015&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;/h1&gt;

&lt;p&gt;GIS is a field of knowledge that has a huge amount to offer transport 
planners and researchers, especially regarding new and open source
software tools that can effectively generate, process and analyse 
transport-related data. R is well-suited to fill this research gap and
has a wide range of tools to help. Packages such as &lt;strong&gt;ggmap&lt;/strong&gt;
(Kahle and Wickham 2013),
&lt;strong&gt;RPostgreSQL&lt;/strong&gt;
and the new &lt;a href=&quot;https://github.com/Robinlovelace/stplanr&quot;&gt;&lt;strong&gt;stplanr&lt;/strong&gt;&lt;/a&gt;
have great potential to help plan the transport systems of the future.
QGIS is also increasingly attractive for transport applications, with
it inbuilt support for
&lt;a href=&quot;http://planet.qgis.org/planet/tag/pgrouting/&quot;&gt;PGRouting&lt;/a&gt;, 
&lt;a href=&quot;http://plugins.qgis.org/plugins/FlowMapper/&quot;&gt;flow analysis&lt;/a&gt;
and a friendly user interface that many will be used to.&lt;/p&gt;

&lt;p&gt;Photos taken during the hackathon are testament to its role as a forum
for not only learning but also debate about the future of GIS in transport.
These can be seen here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.flickr.com/photos/97888609@N02/sets/72157652012715766&quot;&gt;flickr.com/photos/97888609@N02/sets/72157652012715766&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hearing feedback from users new to R using it to solve transport problems
provided an insight into how it compares to traditional tools. The removal
of ‘glass ceilings’ imposed by restrictive licenses or the need to buy
‘add-on’ features was one comment, but that applies equally to QGIS and
other &lt;a href=&quot;http://foss4g.org/&quot;&gt;FOSS4G&lt;/a&gt;
offerings. The steep learning curve of R seems to still
be an issue compared with QGIS, although this is becoming less of an issue
with the evolution of RStudio as an GUI for R. In conclusion, both R and
QGIS are coming of age as tools in the transport planner’s ‘war cabinet’.
The latest evidence unequivocally shows the impact of transport decisions
on obesity, environmental degradation and quality of life. So it is time,
surely, to harness this new open source software to ‘save the world’!&lt;/p&gt;

&lt;h1 id=&quot;acknowledgements&quot;&gt;Acknowledgements&lt;/h1&gt;

&lt;p&gt;Thanks to the Consumer Data Research Centre and the Royal Geographical
society for subsidising the event. Thanks to all the participants and
especially the demonstrators Godwin, Nick, Adrian and Richard for making it
happen.&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;p&gt;Gössling, Stefan, and Scott Cohen. 2014. “Why sustainable transport policies will fail: EU climate policy in the light of transport taboos.” Journal of Transport Geography 39 (July). Elsevier Ltd: 197–207. doi:10.1016/j.jtrangeo.2014.07.010.&lt;/p&gt;

&lt;p&gt;Kahle, D, and Hadley Wickham. 2013. “ggmap: Spatial Visualization with ggplot2.” The R Journal 5: 144–61. &lt;a href=&quot;http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.375.8693&amp;amp;rep=rep1&amp;amp;type=pdf&quot;&gt;citeseerx.ist.psu.edu&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;McGlade, Christophe, and Paul Ekins. 2015. “The geographical distribution of fossil fuels unused when limiting global warming to 2 °C.” Nature 517 (7533). Nature Publishing Group: 187–90. doi:10.1038/nature14016.&lt;/p&gt;

&lt;p&gt;Tamminga, Guus, Marc Miska, Edgar Santos, Hans van Lint, Arturo Nakasone, Helmut Prendinger, and Serge Hoogendoorn. 2012. “Design of Open Source Framework for Traffic and Travel Simulation.” Transportation Research Record: Journal of the Transportation Research Board 2291 (-1): 44–52. doi:10.3141/2291-06.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>R for spatial data slides</title>
   <link href="http://robinlovelace.github.com//2015/03/16/R-spatial-presentation.html"/>
   <updated>2015-03-16T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2015/03/16/R-spatial-presentation</id>
   <content type="html">&lt;p&gt;These are the updated slides from my popular tutorial, &lt;em&gt;Introduction to
visualising spatial data in R&lt;/em&gt;. These slides, and the entire tutorial, are open
source and available to anyone free of charge online. See
https://github.com/Robinlovelace/Creating-maps-in-R for more information.&lt;/p&gt;

&lt;iframe style=&quot;width: 100%; height: 600px&quot; src=&quot;http://rpubs.com/RobinLovelace/65399&quot;&gt;&lt;/iframe&gt;
</content>
 </entry>
 
 <entry>
   <title>The leaflet package for online mapping in R</title>
   <link href="http://robinlovelace.github.com//2015/02/01/leaflet-r-package.html"/>
   <updated>2015-02-01T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2015/02/01/leaflet-r-package</id>
   <content type="html">&lt;p&gt;It has been possible for some years to launch a web map from within R.
A number of packages for doing this are available, including:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://cran.r-project.org/web/packages/RgoogleMaps/index.html&quot;&gt;&lt;strong&gt;RgoogleMaps&lt;/strong&gt;&lt;/a&gt;, an interface to the Google Maps api&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://cran.r-project.org/web/packages/leafletR/index.html&quot;&gt;&lt;strong&gt;leafletR&lt;/strong&gt;&lt;/a&gt;, an early package for creating Leaflet maps with R&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://rcharts.io/viewer/?6735051#.VM1vpWOS8QE&quot;&gt;&lt;strong&gt;rCharts&lt;/strong&gt;&lt;/a&gt;,
which can be used as a basis for webmaps&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In this tutorial we use the new RStudio-supported
&lt;a href=&quot;https://github.com/rstudio/leaflet&quot;&gt;&lt;strong&gt;leaflet&lt;/strong&gt;&lt;/a&gt; R package.
We use this package, an R interface to the
&lt;a href=&quot;http://leafletjs.com/&quot;&gt;JavaScript mapping library of the same name&lt;/a&gt; because:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;leaflet&lt;/strong&gt; is supported by RStudio, who have a track strong track record of creating amazing
R packages&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;leaflet&lt;/strong&gt; appears to provide the simplest, fastest way to host interactive maps
online in R, requiring only 2 lines of code for one web map! (as you’ll see below)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;leaflet&lt;/strong&gt; is &lt;strong&gt;shiny&lt;/strong&gt;. Shiny in the literal sense of the word
(a new and fresh approach to web mapping in R)
but also in the sense that it works well with the R package &lt;strong&gt;shiny&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;!--more--&gt;

&lt;p&gt;The best tutorial resource I have found on &lt;strong&gt;leaflet&lt;/strong&gt; is this
&lt;a href=&quot;https://github.com/rstudio/leaflet/blob/master/vignettes/leaflet.Rmd&quot;&gt;vignette&lt;/a&gt;
by Joe Cheng and Yihui Xie. Building on their excellent description, this
article explains some of the fundamentals of the package.&lt;/p&gt;

&lt;h1 id=&quot;installing-leaflet&quot;&gt;Installing leaflet&lt;/h1&gt;

&lt;p&gt;Because &lt;strong&gt;leaflet&lt;/strong&gt; is new, it’s not yet on CRAN. Even when it does appear,
installing from github may be a good idea, to ensure you have access to the
latest features and bug fixes. Here’s how:&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/Robinlovelace/e6683569cef916bb377b.js&quot;&gt;&lt;/script&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Install leaflet package
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;install_github&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rstudio/leaflet&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;a-first-web-map-with-leaflet&quot;&gt;A first web map with leaflet&lt;/h1&gt;

&lt;p&gt;To create an interactive web map with &lt;strong&gt;leaflet&lt;/strong&gt; is incredibly easy.
Having installed the package try this single line of code:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Plot a default web map (brackets display the result)
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addTiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;img&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readPNG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;~/repos/Creating-maps-in-R/figure//shiny_world.png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;grid.raster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;img&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/img/shiny_world.png&quot; alt=&quot;Basic leaflet map in R&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;adding-basic-features-with-&quot;&gt;Adding basic features with %&amp;gt;%&lt;/h1&gt;

&lt;p&gt;Adding basic features to your webmap is easy. The &lt;code class=&quot;highlighter-rouge&quot;&gt;%&amp;gt;%&lt;/code&gt; ‘pipe’ operator
used extensively in &lt;a href=&quot;https://github.com/hadley/dplyr&quot;&gt;&lt;strong&gt;dplyr&lt;/strong&gt;&lt;/a&gt;
and developed for the
&lt;a href=&quot;http://www.r-statistics.com/2014/08/simpler-r-coding-with-pipes-the-present-and-future-of-the-magrittr-package/&quot;&gt;&lt;strong&gt;maggrittr&lt;/strong&gt; package&lt;/a&gt;
means we can finally escape from dozens of nested bracketted commands.
(If you use RStudio, I suggest trying the
&lt;a href=&quot;http://www.rstudio.com/products/rstudio/release-notes/&quot;&gt;new shortcut&lt;/a&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;Ctl+Shift+M&lt;/code&gt; to produce this wonderful operator.)
&lt;strong&gt;leaflet&lt;/strong&gt; settings and functionality can thus be added sequentially, without
requiring any additional brackets!&lt;/p&gt;

&lt;p&gt;To add a location to the map &lt;code class=&quot;highlighter-rouge&quot;&gt;m&lt;/code&gt;, for example, we can simply pipe &lt;code class=&quot;highlighter-rouge&quot;&gt;m&lt;/code&gt; into
the function &lt;code class=&quot;highlighter-rouge&quot;&gt;setView()&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lng&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;-1.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53.4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zoom&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;centre&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This way we can gradually add elements to our map, one-by-one:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;-1.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53.4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# map location
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addMarkers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;-1.4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# add a marker
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addPopups&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;-1.6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53.3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;popup&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hello Sheffield!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# popup
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# add som circles:
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addCircles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;-2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;iframe src=&quot;https://robinlovelace.shinyapps.io/leaflet-demo/&quot; style=&quot;border: none; width: 600px; height: 400px&quot;&gt;&lt;/iframe&gt;

&lt;h1 id=&quot;adding-data&quot;&gt;Adding data&lt;/h1&gt;

&lt;p&gt;In the previous example, we added some random data that we created
locally, inside the function call. How do we use real, large datasets
in leaflet? The package provides 3 options:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Data from base R: lat/long matrix or data.frame&lt;/li&gt;
  &lt;li&gt;Data from &lt;a href=&quot;http://cran.r-project.org/web/packages/sp/index.html&quot;&gt;&lt;strong&gt;sp&lt;/strong&gt;&lt;/a&gt; such as SpatialPoints and SpatialPolygons&lt;/li&gt;
  &lt;li&gt;Data from &lt;a href=&quot;http://cran.rstudio.com/web/packages/maps/index.html&quot;&gt;&lt;strong&gt;maps&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Let’s try adding a bicycle route, one that 
&lt;a href=&quot;http://robinlovelace.net/ecotech/2013/10/13/bicycle-trailer-move.html&quot;&gt;I followed with some friends
to move from Sheffield to my current home of Leeds&lt;/a&gt;. First download some data:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;https://github.com/Robinlovelace/sdvwR/raw/master/data/gps-trace.gpx&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;download.file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;shef2leeds.gpx&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;wget&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Now we can load this as a &lt;code class=&quot;highlighter-rouge&quot;&gt;SpatialLinesDataFrame&lt;/code&gt; and display in leaflet:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgdal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shef2leeds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readOGR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;shef2leeds.gpx&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tracks&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;-1.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53.4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# map location
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addPolylines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shef2leeds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;iframe src=&quot;https://robinlovelace.shinyapps.io/shef-2-leeds-demo/&quot; style=&quot;border: none; width: 600px; height: 400px&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Note in the above example that we had to use the argument &lt;code class=&quot;highlighter-rouge&quot;&gt;data =&lt;/code&gt; to
refer to our spatial object: it cannot simply be inserted without specifying
what it is. The &lt;code class=&quot;highlighter-rouge&quot;&gt;data&lt;/code&gt; argument can also be placed inside the initial
&lt;code class=&quot;highlighter-rouge&quot;&gt;leaflet()&lt;/code&gt; function call.&lt;/p&gt;

&lt;p&gt;That was quite a painless process that would many more lines of code if you
were to use JavaScript. But not as painless as the bicycle trip itself, which
involved fewer lines of code still: 0! This can be seen in the following video.&lt;/p&gt;

&lt;iframe width=&quot;420&quot; height=&quot;315&quot; src=&quot;//www.youtube.com/embed/6a8QLiC4LV8&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h1 id=&quot;shiny-integration&quot;&gt;Shiny integration&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;leaflet&lt;/strong&gt; is developed by the same team who develop &lt;strong&gt;shiny&lt;/strong&gt; so the two
are well integrated. Below is a very simple example, modified slightly
from the package’s &lt;a href=&quot;https://github.com/rstudio/leaflet/blob/master/vignettes/leaflet.Rmd&quot;&gt;vignette&lt;/a&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shiny&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shinyApp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ui&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fluidPage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leafletOutput&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'myMap'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
    &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# download and load data
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;https://github.com/Robinlovelace/sdvwR/raw/master/data/gps-trace.gpx&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;download.file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;shef2leeds.gpx&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;wget&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgdal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shef2leeds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readOGR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;shef2leeds.gpx&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tracks&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addTiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;-1.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53.4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
      &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addPolylines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shef2leeds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;myMap&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;renderLeaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;applications&quot;&gt;Applications&lt;/h1&gt;

&lt;p&gt;Clearly &lt;code class=&quot;highlighter-rouge&quot;&gt;leaflet&lt;/code&gt; is a powerful and flexible R package. If I were to offer
one critique, it would be that I could find no easy way to allow the user
to query the data objects loaded. &lt;strong&gt;plotly&lt;/strong&gt;, for example, provides a
description of any visual object the user clicks on.
The &lt;a href=&quot;http://commute.datashine.org.uk/&quot;&gt;datashine commuter visualisation&lt;/a&gt;,
for example allows users to click on any point, resulting in a burst of lines
emenating from it. This would also be possible in &lt;strong&gt;leaflet/shiny&lt;/strong&gt;, but the
best implementation is not immediately clear, to me at least!&lt;/p&gt;

&lt;p&gt;The wider context of this article is the pressing need for better transport
planning decision making, to enable a transition away from fossil fuels.
To this end, the &lt;a href=&quot;https://github.com/Robinlovelace/pct&quot;&gt;‘propensity to cycle’ project&lt;/a&gt;,
funded by the UK’s &lt;a href=&quot;https://www.gov.uk/government/organisations/department-for-transport&quot;&gt;Department for Transport&lt;/a&gt;,
seeks to create an interactive tool to identify where new bicycle paths are most
needed. There are clearly many other uses for R’s &lt;strong&gt;leaflet&lt;/strong&gt; package: what
will you use it for? Let me know at &lt;a href=&quot;https://twitter.com/robinlovelace&quot;&gt;@robinlovelace&lt;/a&gt;.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Practical introduction to Shiny - workshop write-up</title>
   <link href="http://robinlovelace.github.com//2015/01/22/practical-introduction-shiny.html"/>
   <updated>2015-01-22T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2015/01/22/practical-introduction-shiny</id>
   <content type="html">&lt;p&gt;I recently delivered a workshop on a practical introduction to
&lt;a href=&quot;http://shiny.rstudio.com/&quot;&gt;shiny&lt;/a&gt;, an R package that enables development,
testing and deployment of interactive web applications.
Delivered at the University of Sydney’s Institute for Transport and Logistics
Studies (&lt;a href=&quot;http://sydney.edu.au/business/itls&quot;&gt;ITLS&lt;/a&gt;), it was designed for people
who are a) fairly new to R (which can seem intimidating) and b) completely new to
shiny.&lt;/p&gt;

&lt;p&gt;This article provides resources for people wanting to apply shiny to
real-world applications and some context which explains the motivations
behind running the workshop. The pdf tutorial, example code
to create and modify your own apps and a place to contribute to this
free teaching resource is available at the following GitHub repository:
&lt;a href=&quot;https://github.com/Robinlovelace/learning-shiny&quot;&gt;github.com/Robinlovelace/learning-shiny&lt;/a&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;my-first-shiny-app&quot;&gt;My first shiny app&lt;/h2&gt;

&lt;p&gt;My first shiny app was &lt;a href=&quot;https://robinlovelace.shinyapps.io/rentSplit/&quot;&gt;rentSplit&lt;/a&gt;,
which overcomes the problem faced when people move in together but can’t decide
on who should pay what because some rooms are better than others. (I would
like to add ‘income’ to this app to allow for minted people to pay more!):&lt;/p&gt;

&lt;iframe src=&quot;https://robinlovelace.shinyapps.io/rentSplit/&quot; style=&quot;border: none; width: 600px; height: 800px&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;The relatively painless experience of creating this app made me wonder if shiny
could be used in transport policy applications and help us achieve the transition
away from &lt;a href=&quot;http://www.postcarbon.org/&quot;&gt;fossil fuels&lt;/a&gt; that 
&lt;a href=&quot;http://www.nature.com/nature/journal/v517/n7533/full/nature14016.html&quot;&gt;scientists say is needed to avoid dangerous climate change&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;context&quot;&gt;Context&lt;/h2&gt;

&lt;p&gt;To put shiny in the context of transport planning I began with a talk on the 
motivations behind online visualisation tools: the increased
focus on ‘&lt;a href=&quot;http://www.esrc.ac.uk/funding-and-guidance/impact-toolkit/&quot;&gt;impact&lt;/a&gt;’
in academic funding decisions, the need for public engagement and the
democratisation of decision-making processes, as illustrated by the
interactive &lt;a href=&quot;http://www.cyclecityconnect.co.uk/participate.php&quot;&gt;web map&lt;/a&gt; created by transport consultancy Steer Davies Gleave
(&lt;a href=&quot;http://www.steerdaviesgleave.com/&quot;&gt;SDG&lt;/a&gt;) to enable geolocated online discussion
of a new £20 million &lt;a href=&quot;http://www.cyclecityconnect.co.uk/&quot;&gt;cycle path&lt;/a&gt;
that will connect the English cities of &lt;a href=&quot;http://leeds.gisruk.org/&quot;&gt;Leeds&lt;/a&gt;
and &lt;a href=&quot;http://en.wikipedia.org/wiki/Bradford&quot;&gt;Bradford&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/cconnect.png&quot; alt=&quot;cityconnect&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is a fantastic example of the new levels of engagement unleashed by
online digital technologies such as &lt;a href=&quot;http://leafletjs.com/&quot;&gt;Leaflet&lt;/a&gt;
and &lt;a href=&quot;http://www.r-bloggers.com/search/shiny&quot;&gt;shiny&lt;/a&gt;: for the first time ever,
people can voice their opinions and pinpoint them to a specific place on the map
in a real-time discussion. The potential for improving transparency and
accountability in transport decision making is huge, as I described
in a short &lt;a href=&quot;http://robinlovelace.net/software/2014/03/05/webmap-test.html&quot;&gt;article on web-mapping&lt;/a&gt; and as outlined in
an academic paper on the subject
(&lt;a href=&quot;http://onlinelibrary.wiley.com/doi/10.1002/eet.1655/full&quot;&gt;Schulz and Newig, 2014&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;As stated in the &lt;a href=&quot;http://rpubs.com/RobinLovelace/54614&quot;&gt;talk&lt;/a&gt;,
the &lt;a href=&quot;https://soundcloud.com/robin-lovelace-1/r-and-shiny-for-transport-applications&quot;&gt;audio&lt;/a&gt;
of which is available online (see below),
this is a fast-moving area that is likely to grow rapidly in the coming years.
So it’s worth knowing what’s out there and what is possible at present.&lt;/p&gt;

&lt;iframe width=&quot;100%&quot; height=&quot;166&quot; scrolling=&quot;no&quot; frameborder=&quot;no&quot; src=&quot;https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/187078099&amp;amp;color=ff5500&amp;amp;auto_play=false&amp;amp;hide_related=false&amp;amp;show_comments=true&amp;amp;show_user=true&amp;amp;show_reposts=false&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;The &lt;a href=&quot;https://github.com/Robinlovelace/learning-shiny/raw/master/learning-shiny.pdf&quot;&gt;practical&lt;/a&gt; avoids &lt;a href=&quot;http://en.wikipedia.org/wiki/Reinventing_the_wheel&quot;&gt;reinventing the wheel&lt;/a&gt;
by building on and creating a narrative for &lt;a href=&quot;http://shiny.rstudio.com/tutorial/&quot;&gt;RStudio’s excellent tutorial and documentation of shiny&lt;/a&gt;. For example, the
&lt;a href=&quot;https://robinlovelace.shinyapps.io/himod/&quot;&gt;himod&lt;/a&gt; shiny app is simply a modified
version of the ‘&lt;a href=&quot;http://glimmer.rstudio.com/shiny/01_hello/&quot;&gt;01_hello&lt;/a&gt;’
demonstration app used to illustrate how new
&lt;a href=&quot;http://shiny.rstudio.com/tutorial/lesson3/&quot;&gt;widgets&lt;/a&gt; are created and how to
use their id’s as objects (via &lt;code class=&quot;highlighter-rouge&quot;&gt;input$id&lt;/code&gt;) in server.R:&lt;/p&gt;

&lt;iframe src=&quot;https://robinlovelace.shinyapps.io/himod/&quot; style=&quot;border: none; width: 600px; height: 650px&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;So please take a look at the resources generated for this practical. I’d
be interested to hear peoples’ thoughts on online interactive tools for
transport planning and the
&lt;a href=&quot;http://theconversation.com/digital-democracy-lets-you-write-your-own-laws-21483&quot;&gt;digital democracy&lt;/a&gt; agenda. More specifically, what’s the simplest way to get
an interactive map on shiny, as illustrated by the impressive
&lt;a href=&quot;http://shiny.rstudio.com/gallery/superzip-example.html&quot;&gt;map of the USA in the SuperZip shiny Gallery example&lt;/a&gt;?&lt;/p&gt;

&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;An evolving &lt;a href=&quot;https://github.com/Robinlovelace/learning-shiny/raw/master/learning-shiny.pdf&quot;&gt;tutorial&lt;/a&gt; (which is may contain some errors)&lt;/li&gt;
  &lt;li&gt;A &lt;a href=&quot;https://github.com/Robinlovelace/learning-shiny&quot;&gt;GitHub repo&lt;/a&gt; where you can access the source code for this tutorial and contribute to it for the community if you wish.&lt;/li&gt;
  &lt;li&gt;The &lt;a href=&quot;http://rpubs.com/RobinLovelace/54614&quot;&gt;slides from my talk&lt;/a&gt;, complete with an
&lt;a href=&quot;https://soundcloud.com/robin-lovelace-1/r-and-shiny-for-transport-applications&quot;&gt;audio recording&lt;/a&gt; of the introduction to it.&lt;/li&gt;
&lt;/ul&gt;
</content>
 </entry>
 
 <entry>
   <title>Talk at the University of Wollongong</title>
   <link href="http://robinlovelace.github.com//2015/01/19/wollongong-presentation.html"/>
   <updated>2015-01-19T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2015/01/19/wollongong-presentation</id>
   <content type="html">&lt;p&gt;Today I’m presenting some work I’ve been doing on &lt;em&gt;spatial microsimulation&lt;/em&gt; to
the &lt;a href=&quot;http://smartuow.com/events/UOW186227.html&quot;&gt;University of Wollongong&lt;/a&gt;,
who are hosting me for the day. A flyer for the event can be found
&lt;a href=&quot;http://smartuow.com/content/groups/public/@web/@smart/documents/doc/uow186229.pdf&quot;&gt;here&lt;/a&gt;
and my &lt;a href=&quot;http://rpubs.com/RobinLovelace/53973&quot;&gt;slides&lt;/a&gt; are up online.&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;&lt;!--&lt;iframe src=&quot;http://rpubs.com/RobinLovelace/53973&quot; height=&quot;600px&quot; width=&quot;100%&quot;&gt;&lt;/iframe&gt; --&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>R, an Integrated Statistical Programming Environment and GIS</title>
   <link href="http://robinlovelace.github.com//2014/11/28/r-as-a-gis-geoinformatics.html"/>
   <updated>2014-11-28T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/11/28/r-as-a-gis-geoinformatics</id>
   <content type="html">&lt;p&gt;This article was originally published in &lt;a href=&quot;http://www.geoinformatics.com/blog/in-the-spotlight/r-an-integrated-statistical-programming-environment&quot;&gt;Geoinformatics&lt;/a&gt; magazine.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cran.r-project.org/&quot;&gt;R&lt;/a&gt; is well known as a powerful, extensible and relatively fast statistical programming language and open software project with a command line interface (CLI). What is less well known is that R also has cutting edge spatial packages that allow it to behave as a fully featured Geographical Information System in the full sense of the word. In fact, some of cutting edge algorithms for image processing and spatial statistics are implemented in R before any other widely available software product (&lt;a href=&quot;http://robinlovelace.net/r/books/2014/09/09/asdar-review.html&quot;&gt;Bivand et al. 2013&lt;/a&gt;). Sophisticated techniques such as geographically weighted regression and spatial interaction models can be custom built around your spatial data in R. But R also works as a general purpose GIS, with mature functions for performing all established techniques of spatial analysis such as spatial selections, buffers and clipping. What is unique about R is that all these capabilities are found in a single programme: R provides a truly integrated modelling environment.&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;the-advantages-and-drawbacks-of-r-as-a-gis&quot;&gt;The advantages and drawbacks of R as a GIS&lt;/h2&gt;

&lt;p&gt;Despite being able to perform the same operations as dedicated GIS software such as ArcGIS and QGIS, R is fundamentally different in the way that the user interacts with it. Not only are most operations complete by typing (e.g. you type “plot(map1)” to plot the data contained in the map1 object), the visualisation stage is different. There is no dynamic canvas which can be used to pan and zoom: instead R only produces visual or other types of output when commanded to do so, using functions such as plot.&lt;/p&gt;

&lt;p&gt;Table 1: A summary of the relative merits of R compared with more traditional GIS software.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Attribute&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Advantages of R&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Drawbacks of R&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;User interface&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Command line interface allows rapid description of workflow and reproducibility&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Steep learning curve (eased by RStudio)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Visualising data&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sophisticated and customisable graphics&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;No dynamic zoomable canvas&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Selecting data&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Concise and consistent method using square brackets (e.g. “map1[x &amp;gt; y,]”)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Difficult to dynamically select objects from map&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Manipulating data&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Very wide range of functions through additional packages&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Only single core processing&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Analysing/modelling data&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Integrated processing, analysis, and modelling framework&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sometimes more than one solution available&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;how-to-get-started-with-spatial-data-in-r&quot;&gt;How to get started with spatial data in R&lt;/h2&gt;

&lt;p&gt;Here is not the place to go into the details of spatial data analysis in R. Instead, we provide a number of resources that will enable rapidly getting up to speed with both R and its spatial packages. Note that when we say “packages” for R, we are referring to specific add-ons, analogous to extentions in ArcGIS and QGIS. The range of add ons is truly vast, as can be seen on the R website: http://cran.r-project.org/web/views/Spatial.html. This diversity can be daunting and it is certainly frustrating when you know that a problem can be solved in several different ways: R teaches you to think about your data and analysis carefully. The most commonly used packages for spatial analysis are probably &lt;a href=&quot;http://cran.r-project.org/web/packages/sp/index.html&quot;&gt;&lt;strong&gt;sp&lt;/strong&gt;&lt;/a&gt; (the basis of spatial functionality in R), &lt;strong&gt;rgdal&lt;/strong&gt; (for loading spatial file formats such as shapefiles) and &lt;strong&gt;rgeos&lt;/strong&gt; (for spatial analysis). Each is installed and loaded in the same way: &lt;strong&gt;rgeos&lt;/strong&gt;, for example, is installed and loaded by typing:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
    install.packages(“rgeos”)
    library(rgeos)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;An introductory tutorial on R as a GIS is the working paper “Introduction to visualising spatial data in R” (&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;Lovelace and Cheshire, 2014&lt;/a&gt;). This document, along with sample code and data, is available free online. It contains links to many other spatial R resources, so is a good starting point for further explorations of R as a GIS.&lt;/p&gt;

&lt;h2 id=&quot;r-in-action-as-a-gis&quot;&gt;R in action as a GIS&lt;/h2&gt;

&lt;p&gt;To demonstrate where R’s flexibility comes into its own, imagine you have a large number of points that you would like to analyse. These are heavily clustered in a few area, and you would like to a) know where these clusters are; b) remove the points in these clusters and create single points in their place, which summarise the information contained in the clustered points; c) visualise the output.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/raw/master/vignettes/figure/Aggregated_data_for_culters.png&quot; alt=&quot;clustering&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We will not actually run through all the steps needed to do this in R. Suffice to know that it is possible in R and very difficult to do in other GIS packages such as &lt;a href=&quot;http://www.qgis.org/en/site/&quot;&gt;QGIS&lt;/a&gt;, ArcGIS or even &lt;a href=&quot;http://postgis.net/&quot;&gt;PostGIS&lt;/a&gt; (another command line GIS that is based on the database language Postgres, a type of SQL): I was asked to tackle this problem by the Spanish GIS service SIGTE after other solutions had been tried.&lt;/p&gt;

&lt;p&gt;All of the steps needed to solve the problem, including provision of example data, are provided &lt;a href=&quot;http://robinlovelace.net/r/2014/03/21/clustering-points-R.html&quot;&gt;online&lt;/a&gt;. Here I provide an overview of the processes involved and some of the key functions to provide insight into the R way of thinking about spatial data.&lt;/p&gt;

&lt;p&gt;First the data must be loaded and converted into yet another spatial data class. This is done using the &lt;code class=&quot;highlighter-rouge&quot;&gt;readOGR&lt;/code&gt; function from the &lt;strong&gt;rgdal&lt;/strong&gt; package mentioned above and then using the command &lt;code class=&quot;highlighter-rouge&quot;&gt;as(SpatialPoints(stations), &quot;ppp&quot;)&lt;/code&gt; to convert the spatial object stations into the ppp class from the spatstat package.&lt;/p&gt;

&lt;p&gt;Next the data is converted into a density raster. The value of each pixel corresponds to the interpolated density of points in that area. This is visualised using the &lt;code class=&quot;highlighter-rouge&quot;&gt;plot&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;contour&lt;/code&gt; functions to ensure that the conversion has worked properly.&lt;/p&gt;

&lt;p&gt;The raster image is converted into smooth lines using the &lt;code class=&quot;highlighter-rouge&quot;&gt;contourLines&lt;/code&gt;. The lines, one for each cluster zone, must then be converted into polygons using the command &lt;code class=&quot;highlighter-rouge&quot;&gt;gPolygonize(SLDF[5, ])&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;gPolygonize&lt;/code&gt; is a very useful function from the rgeos package which automates the conversion of lines into polygons.&lt;/p&gt;

&lt;p&gt;The results are plotted using the rather lengthy set of commands shown below. This results in the figure displayed above (notice the &lt;code class=&quot;highlighter-rouge&quot;&gt;red&lt;/code&gt; argument creates the red fill of the zones):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
    plot(Dens, main = &quot;&quot;)
    plot(lnd, border = &quot;grey&quot;, lwd = 2, add = T)
    plot(SLDF, col = terrain.colors(8), add = T)
    plot(cAg, col = &quot;red&quot;, border = &quot;white&quot;, add = T)
    graphics::text(coordinates(cAg) + 1000, labels = cAg$CODE)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally the points inside the cluster polygons are extracted using R’s very concise spatial subsetting syntax:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
    sIn &amp;lt;- stations[cAg, ]  # select the stations inside the clusters
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The code above, translated into English, means “take all the station points within the cluster polygon called cAg and save them as a new object call sIn”.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;The purpose of the article has been to introduce the idea that GIS software can take many forms, including the rather unusual command line interface of the statistical programming language R. Hopefully any preconceptions about poor performance have been dispelled by the examples of converting text into spatial objects and of clustering points. Both examples would be difficult to undertake in more traditional GIS software packages. R has a steep learning curve and should probably be seen more as a powerful tool to use in harmony with other GIS packages for dealing with particularly tricky/unconventional tasks rather than a standalone GIS package in its own right form most users. R interfaces to QGIS and ArcGIS should make this easier, although this solution is not yet mature. In addition to new functionalities, R should also provide a new way of thinking about spatial data for many GIS users (Lovelace and Cheshire, 2014). Yes it has a steep learning curve, but it’s a fun curve to be on whether you are on the beginning of the ascent or in the near vertical phase of the exponential function!&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;p&gt;Bivand, R. S., Pebesma, E. J., &amp;amp; Gómez-Rubio, V. (2013). Applied spatial data analysis with R (Vol. 747248717). Springer.&lt;/p&gt;

&lt;p&gt;Lovelace, R., &amp;amp; Cheshire, J. (2014). Introduction to visualising spatial data in R. National Centre for Research Methods, 1403. Retrieved from http://eprints.ncrm.ac.uk/3295/&lt;/p&gt;

&lt;p&gt;Wickham, H. (2014). Tidy data. The Journal of Statistical Software, 14(5). Retrieved from http://vita.had.co.nz/papers/tidy-data.html&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Presentation at the North American Regional Science association</title>
   <link href="http://robinlovelace.github.com//2014/11/14/narsc-presentation.html"/>
   <updated>2014-11-14T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/11/14/narsc-presentation</id>
   <content type="html">&lt;p&gt;I’m presenting today on “Verification of big data for estimating retail flows”.&lt;/p&gt;

&lt;p&gt;Slides from this presentation can be found &lt;a href=&quot;https://dl.dropboxusercontent.com/u/15008199/egs2stay/narsc-pres.html#1&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Welcome to Jekyll!</title>
   <link href="http://robinlovelace.github.com//2014/09/28/welcome-to-jekyll.html"/>
   <updated>2014-09-28T00:16:53+01:00</updated>
   <id>http://robinlovelace.github.com//2014/09/28/welcome-to-jekyll</id>
   <content type="html">&lt;p&gt;You’ll find this post in your &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt; directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run &lt;code class=&quot;highlighter-rouge&quot;&gt;jekyll serve --watch&lt;/code&gt;, which launches a web server and auto-regenerates your site when a file is updated.&lt;/p&gt;

&lt;p&gt;To add new posts, simply add a file in the &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt; directory that follows the convention &lt;code class=&quot;highlighter-rouge&quot;&gt;YYYY-MM-DD-name-of-post.ext&lt;/code&gt; and includes the necessary front matter. Take a look at the source for this post to get an idea about how it works.&lt;/p&gt;

&lt;p&gt;Jekyll also offers powerful support for code snippets:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;print_hi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hi, &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;print_hi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Tom'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#=&amp;gt; prints 'Hi, Tom' to STDOUT.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Check out the &lt;a href=&quot;http://jekyllrb.com&quot;&gt;Jekyll docs&lt;/a&gt; for more info on how to get the most out of Jekyll. File all bugs/feature requests at &lt;a href=&quot;https://github.com/jekyll/jekyll&quot;&gt;Jekyll’s GitHub repo&lt;/a&gt;. If you have questions, you can ask them on &lt;a href=&quot;https://github.com/jekyll/jekyll-help&quot;&gt;Jekyll’s dedicated Help repository&lt;/a&gt;.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Serve Jekyll Websites with servr and knitr</title>
   <link href="http://robinlovelace.github.com//2014/09/28/jekyll-with-knitr.html"/>
   <updated>2014-09-28T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/09/28/jekyll-with-knitr</id>
   <content type="html">&lt;p&gt;The R package &lt;a href=&quot;https://github.com/yihui/servr&quot;&gt;&lt;strong&gt;servr&lt;/strong&gt;&lt;/a&gt; can be used to set up an HTTP server to serve files under a directory. Since &lt;strong&gt;servr&lt;/strong&gt; v0.2, it has added a function &lt;code class=&quot;highlighter-rouge&quot;&gt;servr::jekyll()&lt;/code&gt; specifically designed for websites based on Jekyll and R Markdown. The main features of this function are:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;R Markdown source files are re-compiled through &lt;a href=&quot;http://yihui.name/knitr&quot;&gt;&lt;strong&gt;knitr&lt;/strong&gt;&lt;/a&gt; when their corresponding Markdown output files become older&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; than source files;&lt;/li&gt;
  &lt;li&gt;The web page will refresh itself automatically in the above case as well;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;As a result, all you need to do is write your blog posts (R Markdown documents), and you do not need to worry about re-building the website or calling &lt;strong&gt;knitr&lt;/strong&gt; commands. Whenever you save a blog post in your text editor, the web page will be updated on the fly. This is particularly handy in the &lt;a href=&quot;http://www.rstudio.com&quot;&gt;RStudio IDE&lt;/a&gt;, because after you run &lt;code class=&quot;highlighter-rouge&quot;&gt;servr::jekyll()&lt;/code&gt; in the console, you can start writing or editing your R Markdown posts, and the HTML output, displayed in the RStudio viewer pane, will be in sync with your source post in the source panel (see the screenshot below).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://i.imgur.com/gKVGhiP.png&quot;&gt;&lt;img src=&quot;http://i.imgur.com/gKVGhiP.png&quot; alt=&quot;Jekyll with servr and knitr&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;

&lt;p&gt;You must have installed the packages &lt;strong&gt;servr&lt;/strong&gt; (&amp;gt;= 0.2) and &lt;strong&gt;knitr&lt;/strong&gt; (&amp;gt;= 1.8).&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;install.packages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;servr&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;knitr&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;repos&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://cran.rstudio.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Of course, you have to install &lt;a href=&quot;http://jekyllrb.com&quot;&gt;Jekyll&lt;/a&gt; as well. For Windows users, you have to make sure &lt;code class=&quot;highlighter-rouge&quot;&gt;jekyll&lt;/code&gt; can be found from your environment variable &lt;code class=&quot;highlighter-rouge&quot;&gt;PATH&lt;/code&gt;, i.e., R can call it via &lt;code class=&quot;highlighter-rouge&quot;&gt;system('jekyll')&lt;/code&gt;. This is normally not an issue for Linux or Mac OS X users (&lt;code class=&quot;highlighter-rouge&quot;&gt;gem install jekyll&lt;/code&gt; is enough).&lt;/p&gt;

&lt;h2 id=&quot;r-code-chunks&quot;&gt;R code chunks&lt;/h2&gt;

&lt;p&gt;Now we write some R code chunks in this post. For example,&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;digits&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;hello world!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;## hello world!&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;set.seed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rnorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;##  [1]  9.44  9.77 11.56 10.07 10.13 11.72 10.46  8.73  9.31  9.55 11.22
## [12] 10.36 10.40 10.11  9.44 11.79 10.50  8.03 10.70  9.53  8.93  9.78
## [23]  8.97  9.27  9.37  8.31 10.84 10.15  8.86 11.25 10.43  9.70 10.90
## [34] 10.88 10.82 10.69 10.55  9.94  9.69  9.62&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# generate a table
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;knitr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mtcars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt; &lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;mpg&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;cyl&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;disp&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;hp&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;drat&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;wt&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;qsec&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;vs&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;am&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;gear&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;carb&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mazda RX4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;21.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;160&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;110&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.90&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.62&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;16.5&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mazda RX4 Wag&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;21.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;160&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;110&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.90&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.88&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;17.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Datsun 710&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;22.8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;108&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;93&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.85&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.32&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18.6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Hornet 4 Drive&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;21.4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;258&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;110&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.08&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.21&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;19.4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Hornet Sportabout&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18.7&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;360&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;175&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.15&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.44&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;17.0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Valiant&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;18.1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;225&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;105&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2.76&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3.46&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;20.2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
        &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# a boring comment
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;## [1] 2&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;nf&quot;&gt;names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;formals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;servr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jekyll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arguments&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;the&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jekyll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;## [1] &quot;dir&quot;     &quot;input&quot;   &quot;output&quot;  &quot;script&quot;  &quot;serve&quot;   &quot;command&quot;
## [7] &quot;...&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Just to test inline R expressions&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt; in &lt;strong&gt;knitr&lt;/strong&gt;, we know the first element in &lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt; (created in the code chunk above) is 9.44. You can certainly draw some graphs as well:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;par&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mar&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scatterplot&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;http://db.yihui.name/jekyll/2014-09-28-jekyll-with-knitr/cars-1.png&quot; alt=&quot;A scatterplot of the cars data&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;the-build-script&quot;&gt;The build script&lt;/h2&gt;

&lt;p&gt;Zero-configuration is required for &lt;code class=&quot;highlighter-rouge&quot;&gt;servr::jekyll()&lt;/code&gt; to work on your Jekyll website. However, there is always demand for more control over some options, which can be defined in a custom build script. Here are the arguments of &lt;code class=&quot;highlighter-rouge&quot;&gt;servr::jekyll()&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;n&quot;&gt;jekyll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dir&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_source&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_posts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_posts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_posts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Makefile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;build.R&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serve&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;jekyll build&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;By default, &lt;code class=&quot;highlighter-rouge&quot;&gt;jekyll()&lt;/code&gt; looks for &lt;code class=&quot;highlighter-rouge&quot;&gt;.Rmd&lt;/code&gt; files under the root directory, the &lt;code class=&quot;highlighter-rouge&quot;&gt;_source&lt;/code&gt; directory, and the &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt; directory of the Jekyll website. For example, if you put your R Markdown posts under &lt;code class=&quot;highlighter-rouge&quot;&gt;_source&lt;/code&gt;, they will be compiled to the &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt; directory&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;script&lt;/code&gt; argument specifies a Makefile or an R script to be used to compile your R Markdown files. If it is a Makefile, &lt;code class=&quot;highlighter-rouge&quot;&gt;jekyll()&lt;/code&gt; will run &lt;code class=&quot;highlighter-rouge&quot;&gt;make -q&lt;/code&gt; to see if the site needs to be recompiled, then &lt;code class=&quot;highlighter-rouge&quot;&gt;make&lt;/code&gt; if it does. If the script is an R script, say, named &lt;code class=&quot;highlighter-rouge&quot;&gt;build.R&lt;/code&gt;, it is called via command line of the form&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Rscript build.R arg1 arg2
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;See &lt;code class=&quot;highlighter-rouge&quot;&gt;?servr::jekyll&lt;/code&gt; for more details. You can define all your &lt;strong&gt;knitr&lt;/strong&gt; options and any other options in this R script. See the script &lt;a href=&quot;https://github.com/yihui/knitr-jekyll/blob/gh-pages/build.R&quot;&gt;build.R&lt;/a&gt; in the knitr-jekyll repository for an example: it will automatically set up the output renderers for &lt;strong&gt;knitr&lt;/strong&gt;, e.g., when the Jekyll Markdown engine is &lt;code class=&quot;highlighter-rouge&quot;&gt;kramdown&lt;/code&gt;, this script will call &lt;code class=&quot;highlighter-rouge&quot;&gt;knitr::render_jekyll()&lt;/code&gt; so that the code chunk output will be put inside the Liquid tag &lt;code class=&quot;highlighter-rouge&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;highlight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;lang&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;endhighlight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;; it also sets up some &lt;strong&gt;knitr&lt;/strong&gt; chunk and package options so that figures can be displayed correctly. For those who do not wish to store images in GIT (because normally they are binary files), you may check out how I host my images in Dropbox for this repository (see the code below &lt;code class=&quot;highlighter-rouge&quot;&gt;Sys.getenv('USER') == 'yihui'&lt;/code&gt;).&lt;/p&gt;

&lt;h2 id=&quot;on-the-markdown-renderers&quot;&gt;On the Markdown renderers&lt;/h2&gt;

&lt;p&gt;Jekyll supports a number of Markdown renderers, such as kramdown, redcarpet, rdiscount, and so on. At the moment, it is a little annoying that kramdown supports LaTeX math expressions via &lt;code class=&quot;highlighter-rouge&quot;&gt;$$ math $$&lt;/code&gt;&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;, but does not support syntax highlighting of code blocks using the three backticks syntax (you must write the awkward Liquid tags); on the other hand, redcarpet does not support LaTeX math but does support three backticks. In my opinion, all the different flavors and implementations of Markdown is the biggest problem of Markdown, since there is not an unambiguous spec for Markdown. &lt;a href=&quot;http://commonmark.org&quot;&gt;CommonMark&lt;/a&gt; looks like a promising project to set up a common spec for Markdown, and &lt;a href=&quot;http://johnmacfarlane.net/pandoc/&quot;&gt;Pandoc&lt;/a&gt; is a great implementation that has brought almost all the features that you may ever need in Markdown. You may find some Pandoc plugins for Jekyll by searching online. However, GitHub Pages does not support arbitrary Jekyll plugins, so you cannot just use a Pandoc plugin there, but that does not mean you cannot use Pandoc locally, nor does it mean you cannot push locally compiled HTML pages to GitHub Pages&lt;sup id=&quot;fnref:5&quot;&gt;&lt;a href=&quot;#fn:5&quot; class=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;I’d love you to &lt;a href=&quot;https://github.com/yihui/knitr-jekyll&quot;&gt;fork&lt;/a&gt; this repository, make some (hopefully minor) changes, and &lt;a href=&quot;https://github.com/yihui/knitr-jekyll/issues&quot;&gt;let me know&lt;/a&gt; your success of using Pandoc with Jekyll. Happy hacking, and good luck!&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;Determined by the modification time of files, i.e., &lt;code class=&quot;highlighter-rouge&quot;&gt;file.info(x)[, 'mtime']&lt;/code&gt;. &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;The syntax in R Markdown for inline expressions is &lt;code class=&quot;highlighter-rouge&quot;&gt;`r code`&lt;/code&gt;, where &lt;code class=&quot;highlighter-rouge&quot;&gt;code&lt;/code&gt; is the R expression that you want to evaluate, e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;x[1]&lt;/code&gt;. &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;The reason that we may need to write R Markdown posts in &lt;code class=&quot;highlighter-rouge&quot;&gt;_source&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt; is that Jekyll has &lt;a href=&quot;https://github.com/jekyll/jekyll/pull/3147&quot;&gt;a subtle bug&lt;/a&gt; (fixed in v2.5.3): its variable &lt;code class=&quot;highlighter-rouge&quot;&gt;site.posts&lt;/code&gt; will count &lt;code class=&quot;highlighter-rouge&quot;&gt;.Rmd&lt;/code&gt; files under &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts&lt;/code&gt; as well. The consequence is, if you list all the posts of your website, the post &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts/yyyy-mm-dd-foo.md&lt;/code&gt; will show up twice due to the existence of &lt;code class=&quot;highlighter-rouge&quot;&gt;_posts/yyyy-mm-dd-foo.Rmd&lt;/code&gt;, therefore I would recommend you to put your R Markdown posts in a separate directory, such as &lt;code class=&quot;highlighter-rouge&quot;&gt;_source&lt;/code&gt;. &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;Unfortunately, kramdown does not support math expressions in single dollars, e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;$ \alpha $&lt;/code&gt;. &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot;&gt;
      &lt;p&gt;If you choose to generate your Jekyll website locally, and push the HTML files to GitHub, you will need the file &lt;a href=&quot;https://help.github.com/articles/using-jekyll-with-pages&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;.nojekyll&lt;/code&gt;&lt;/a&gt; in the root directory of your website. &lt;a href=&quot;#fnref:5&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>Reproducibility in Regional Science</title>
   <link href="http://robinlovelace.github.com//2014/08/21/reproducibility-regional-science.html"/>
   <updated>2014-08-21T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/08/21/reproducibility-regional-science</id>
   <content type="html">&lt;p&gt;Today I presented my talk at the &lt;a href=&quot;http://www.rsai-bis.org/&quot;&gt;RSAI British and Irish Section&lt;/a&gt;.
The talk is about reproducibility. Why are reproducible methods and results
important? How reproducible is Regional Science? What can be done to increase
the reproducibility of your work? These are the types of questions tackled in
the talk, which also be seen on the &lt;a href=&quot;http://rpubs.com/robinlovelace/25365&quot;&gt;Rpubs website&lt;/a&gt;.&lt;/p&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;00eacaa00b53013260fc7e2d2d4e67ff&quot; data-ratio=&quot;1.41436464088398&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

&lt;!--&lt;iframe src=&quot;http://rpubs.com/robinlovelace/25365&quot; width=&quot;100%&quot; height=&quot;800&quot;--&gt;
&lt;!--allowfullscreen=&quot;allowfullscreen&quot;&gt;--&gt;
&lt;!--If you can see this, your browser doesn't --&gt;
&lt;!--understand IFRAME.  However, we'll still --&gt;
&lt;!--&lt;a href=&quot;http://rpubs.com/robinlovelace/25365&quot;&gt;link&lt;/a&gt; --&gt;
&lt;!--you to the file.--&gt;
&lt;!--&lt;/iframe&gt;--&gt;
</content>
 </entry>
 
 <entry>
   <title>Clipping spatial data in R</title>
   <link href="http://robinlovelace.github.com//2014/07/29/clipping-with-r.html"/>
   <updated>2014-07-29T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/07/29/clipping-with-r</id>
   <content type="html">&lt;p&gt;This miniature vignette shows how to clip spatial data based on different spatial objects in R and a ‘bounding box’. Spatial overlays are common in GIS applications and R users are fortunate that the clipping and spatial subsetting functions are mature and fairly fast. We’ll also write a new function called &lt;code class=&quot;highlighter-rouge&quot;&gt;gClip()&lt;/code&gt;, that will make clipping by bounding boxes easier.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/clipping-with-bounding-box_files/figure-markdown_github/Westminster.png&quot; alt=&quot;plot of chunk Westminster&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;loading-the-data&quot;&gt;Loading the data&lt;/h2&gt;

&lt;p&gt;To start with let’s load some data. I’m working in the root directory of the &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;Creating-maps-in-R&lt;/a&gt; github repository, so there are some spatial datasets available to play with:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;setwd(&quot;../&quot;)
library(rgdal)
stations &amp;lt;- readOGR(&quot;data&quot;, &quot;lnd-stns&quot;)


## OGR data source with driver: ESRI Shapefile 
## Source: &quot;data&quot;, layer: &quot;lnd-stns&quot;
## with 2532 features and 27 fields
## Feature type: wkbPoint with 2 dimensions

 
zones &amp;lt;- readOGR(&quot;data&quot;, &quot;london_sport&quot;)


## OGR data source with driver: ESRI Shapefile 
## Source: &quot;data&quot;, layer: &quot;london_sport&quot;
## with 33 features and 4 fields
## Feature type: wkbPolygon with 2 dimensions
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;the-wonder-of-spatial-subsetting-in-r&quot;&gt;The wonder of spatial subsetting in R&lt;/h2&gt;

&lt;p&gt;Now, it’s easy to &lt;strong&gt;subset&lt;/strong&gt; spatial data in R, using the same incredibly concise square bracket &lt;code class=&quot;highlighter-rouge&quot;&gt;[]&lt;/code&gt; notation as R uses for non spatial data. To re-confirm how this works on non-spatial data, here’s a mini example:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;M &amp;lt;- matrix(1:10, ncol = 5)
M[2, 3:5]


## [1]  6  8 10
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The above code creates a matrix with 5 columns and 2 rows: the &lt;code class=&quot;highlighter-rouge&quot;&gt;[2, 3:5]&lt;/code&gt; part takes the subset of &lt;code class=&quot;highlighter-rouge&quot;&gt;M&lt;/code&gt; corresponding to 3rd to 5th columns in the second row.&lt;/p&gt;

&lt;p&gt;Subsetting spatial data works in exactly the same way: note that &lt;code class=&quot;highlighter-rouge&quot;&gt;zones&lt;/code&gt; are far more extensive than the &lt;code class=&quot;highlighter-rouge&quot;&gt;stations&lt;/code&gt; points. (We have to change the projection of &lt;code class=&quot;highlighter-rouge&quot;&gt;stations&lt;/code&gt; before plotting, so the objects are on the same coordinate reference system.)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;stations &amp;lt;- spTransform(stations, CRS(proj4string(zones))) # transform CRS
plot(zones)
points(stations)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/clipping-with-bounding-box_files/figure-markdown_github/unnamed-chunk-3.png&quot; alt=&quot;plot of chunk unnamed-chunk-3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So how do we select only points that are are within the zones of London? Believe it or not, it’s as simple as subsetting the matrix &lt;code class=&quot;highlighter-rouge&quot;&gt;M&lt;/code&gt; above. This is an amazingly concise and convenient way of spatial subsetting that was added to R at some point between versions 1 and 2 of &lt;a href=&quot;http://www.asdar-book.org/&quot;&gt;Applied Spatial Data Analysis with R&lt;/a&gt;. In the earlier (2008) book, one had to use &lt;code class=&quot;highlighter-rouge&quot;&gt;overlay(x, y)&lt;/code&gt; just to get the selection, and then another line of code was required to actually make the subset. Now things are much simpler. As Bivand et al. put it in the &lt;a href=&quot;http://www.springer.com/statistics/life+sciences,+medicine+%26+health/book/978-1-4614-7617-7&quot;&gt;latest edtion&lt;/a&gt; (p. 131), “the selection syntax for features was extended such that it understands:”&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;stations_subset &amp;lt;- stations[zones, ]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;This is so amazing and intuitive, whoever invented it should be given a medal!!&lt;/strong&gt; Despite this simplicity, it seems many R users who I’ve taught spatial functions to are unaware of &lt;code class=&quot;highlighter-rouge&quot;&gt;[]&lt;/code&gt;’s spatial extension. So spread the word (and if anyone knows of the history of this innovation, please let us know). Now we have a sample of all stations zones: progress.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;plot(zones)
points(stations_subset)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/clipping-with-bounding-box_files/figure-markdown_github/unnamed-chunk-5.png&quot; alt=&quot;plot of chunk unnamed-chunk-5&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;clipping-by-a-bounding-box&quot;&gt;Clipping by a bounding box&lt;/h2&gt;

&lt;p&gt;But what if we want to &lt;em&gt;clip&lt;/em&gt; the polygons data, based on a bounding box? To start with, let’s look at and modify the existing bounding box for the zones, making it half the size:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;b &amp;lt;- bbox(zones)
b[1, ] &amp;lt;- (b[1, ] - mean(b[1, ])) * 0.5 + mean(b[1, ])
b[2, ] &amp;lt;- (b[2, ] - mean(b[2, ])) * 0.5 + mean(b[2, ])
b &amp;lt;- bbox(t(b))
plot(zones, xlim = b[1, ], ylim = b[2, ])
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/clipping-with-bounding-box_files/figure-markdown_github/unnamed-chunk-6.png&quot; alt=&quot;plot of chunk unnamed-chunk-6&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now, to clip this area, we can use a custom function, which I’ve called &lt;code class=&quot;highlighter-rouge&quot;&gt;gClip&lt;/code&gt;, following the &lt;strong&gt;rgeos&lt;/strong&gt; function naming convention (this was inspired by an online &lt;a href=&quot;http://stackoverflow.com/questions/21883683/is-it-possible-to-clip-a-polygon-to-the-bounding-box-of-a-base-map&quot;&gt;answer&lt;/a&gt; that didn’t work for me):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;library(raster)
library(rgeos)


## rgeos version: 0.3-5, (SVN revision 447)
##  GEOS runtime version: 3.4.2-CAPI-1.8.2 r3921 
##  Polygon checking: TRUE

 
gClip &amp;lt;- function(shp, bb){
  if(class(bb) == &quot;matrix&quot;) b_poly &amp;lt;- as(extent(as.vector(t(bb))), &quot;SpatialPolygons&quot;)
  else b_poly &amp;lt;- as(extent(bb), &quot;SpatialPolygons&quot;)
  gIntersection(shp, b_poly, byid = T)
}

zones_clipped &amp;lt;- gClip(zones, b)


## Warning: spgeom1 and spgeom2 have different proj4 strings

 
plot(zones_clipped)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/clipping-with-bounding-box_files/figure-markdown_github/unnamed-chunk-7.png&quot; alt=&quot;plot of chunk unnamed-chunk-7&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Note that due to the &lt;code class=&quot;highlighter-rouge&quot;&gt;if&lt;/code&gt; statements in &lt;code class=&quot;highlighter-rouge&quot;&gt;gClip&lt;/code&gt;’s body, it can handle almost any spatial data input, and still work. Let’s clip to the borough of Westminster, one of London’s better known boroughs:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;westminster &amp;lt;- zones[grep(&quot;West&quot;, zones$name),]
zones_clipped_w &amp;lt;- gClip(zones, westminster)


## Warning: spgeom1 and spgeom2 have different proj4 strings

 
plot(zones_clipped_w); plot(westminster, col = &quot;red&quot;, add = T)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/clipping-with-bounding-box_files/figure-markdown_github/Westminster.png&quot; alt=&quot;plot of chunk Westminster&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;There are many more spatial tips available from the &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/raw/master/intro-spatial-rl.pdf&quot;&gt;Introduction to visualising
spatial data in
R&lt;/a&gt;
tutorial that &lt;a href=&quot;http://spatial.ly/&quot;&gt;James Cheshire&lt;/a&gt; and I are maintaining. The source code of this post can also be viewed &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/blob/master/vignettes/clipping-with-bounding-box.Rmd&quot;&gt;online&lt;/a&gt; as just one of a series of &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/tree/master/vignettes&quot;&gt;vignettes&lt;/a&gt; to showcase some of R’s impressive spatial capabilities.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Consistent naming conventions in R</title>
   <link href="http://robinlovelace.github.com//2014/07/15/naming-conventions-r.html"/>
   <updated>2014-07-15T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/07/15/naming-conventions-r</id>
   <content type="html">&lt;p&gt;Naming conventions in R are famously anarchic, with no clear winner and multiple conventions in use &lt;em&gt;simultaneously&lt;/em&gt; in the same package. This has been written about before, in a lucid article in the &lt;a href=&quot;http://journal.r-project.org/archive/2012-2/RJournal_2012-2_Baaaath.pdf&quot;&gt;R Journal&lt;/a&gt;, a detailed exploration of names in R source code &lt;a href=&quot;http://cran.r-project.org/web/packages/rockchalk/vignettes/Rstyle.pdf&quot;&gt;hosted on CRAN&lt;/a&gt; and general discussion on &lt;a href=&quot;http://stackoverflow.com/questions/1944910/what-is-your-preferred-style-for-naming-variables-in-r&quot;&gt;stackoverflow&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Basically, there are 5 naming conventions to choose from:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;alllowercase: e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;adjustcolor&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;period.separated: e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;plot.new&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;underscore_separated: e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;numeric_version&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;lowerCamelCase: e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;addTaskCallback&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;UpperCamelCase: e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;SignatureMethod&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There are clear advantages to choosing one naming convention and sticking to it, regardless which one it is:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;“Use common sense and BE CONSISTENT”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The &lt;a href=&quot;https://google-styleguide.googlecode.com/svn/trunk/Rguide.xml&quot;&gt;Google Style Guide&lt;/a&gt; is ironically written in a rather inconsistent way (mixing capitals with lowercase in a single sentence surely breaks their own rule!)&lt;/p&gt;

&lt;p&gt;But which one to choose? Read below to find out about the thorny issue
of naming conventions in R, based on a &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/raw/master/intro-spatial-rl.pdf&quot;&gt;tutorial on geo-spatial data handling
in R&lt;/a&gt;.&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;naming-convention-chaos&quot;&gt;Naming convention chaos&lt;/h2&gt;

&lt;p&gt;I recently encountered this question when I looked at the CRAN hosted version of the tutorial I co-authored ‘Introduction to visualising spatial data in R’. To my dismay, this document was littered with inconsistencies: here are just a few of the object names used, breaking almost every naming convention:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Partic_Per&lt;/code&gt;: This variable is trying to be simultaneously UpperCamelBack and underscore_separated: a new naming convention I’d like to coin Upper_Underscore_Separated (joke). Here’s another example: &lt;code class=&quot;highlighter-rouge&quot;&gt;Spatial_DistrictName&lt;/code&gt; These styles should not be mixed according to &lt;a href=&quot;http://adv-r.had.co.nz/Style.html&quot;&gt;Hadley Wickham&lt;/a&gt; and &lt;a href=&quot;http://csgillespie.wordpress.com/2010/11/23/r-style-guide/&quot;&gt;Colin Gillespie&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sport.wgs84&lt;/code&gt;: An example of period.separation&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;crimeDat$MajorText&lt;/code&gt;: lowerCamelBack and UpperCamelBack &lt;em&gt;in the same object&lt;/em&gt;!&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ons_label&lt;/code&gt;: a rare example of a consistent use of a naming convention, although this was in a variable name, not an object.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Does any of your code look like this? If so I suggest sorting it out. Ironically, we had a section on typographic conventions &lt;em&gt;in the error strewn document&lt;/em&gt;. This states that:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;“it is a good idea to get into the habit of consistent and clear writing in any language, and R is no exception”.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It was time to follow our own advice!&lt;/p&gt;

&lt;h2 id=&quot;a-trigger-to-remedy-chaotic-code&quot;&gt;A trigger to remedy chaotic code&lt;/h2&gt;

&lt;p&gt;The tutorial was used as the basis for a &lt;a href=&quot;http://foss4g-e.org/content/using-r-command-line-gis&quot;&gt;workshop&lt;/a&gt; delivered at the Free and Open Source Software for Geo-spatial (&lt;a href=&quot;http://foss4g.org/&quot;&gt;FOSS4G&lt;/a&gt;) conference in &lt;a href=&quot;http://foss4g-e.org/&quot;&gt;Bremen&lt;/a&gt;. The event is affiliated with the The Open Source Geospatial Foundation (&lt;a href=&quot;http://www.osgeo.org/&quot;&gt;OSGeo&lt;/a&gt;), who are big advocates of consistency and &lt;a href=&quot;http://live.osgeo.org/en/standards/standards.html&quot;&gt;standards&lt;/a&gt;. With many experienced programmers at the event, it was the perfect opportunity to update the tutorial on the project’s &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;github repository&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;which-naming-convention&quot;&gt;Which naming convention?&lt;/h2&gt;

&lt;p&gt;We decided to use the &lt;strong&gt;underscore_separated&lt;/strong&gt; naming convention. Why? It wasn’t because we love typing underscores (which can cause problems in some contexts), but because of more fundamental issues with the other options:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;alllowercase names are difficult to read, especially for non-native readers.&lt;/li&gt;
  &lt;li&gt;period.separated names are confusing for users of &lt;a href=&quot;http://python4astronomers.github.io/python/objects.html&quot;&gt;Python&lt;/a&gt; and other languages in which dots are meaningful.&lt;/li&gt;
  &lt;li&gt;UpperCamelBack is &lt;em&gt;ugly&lt;/em&gt; and requires excessive use of the shift button.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There are also a couple of reasons why we positively like underscores:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Underscores are &lt;strong&gt;fast&lt;/strong&gt; to read: 10% to 20% faster than camelBack, which is especially confusing to non-native English readers, according to &lt;a href=&quot;http://whathecode.wordpress.com/2011/02/10/camelcase-vs-underscores-scientific-showdown/&quot;&gt;one article&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;Underscores are recommended by some prominent R users, including &lt;a href=&quot;http://adv-r.had.co.nz/Style.html&quot;&gt;Hadley Wickham&lt;/a&gt;, &lt;a href=&quot;http://csgillespie.wordpress.com/2010/11/23/r-style-guide/&quot;&gt;Colin Gillespie&lt;/a&gt; and &lt;a href=&quot;http://andrewgelman.com/2012/08/28/migrating-from-dot-to-underscore/&quot;&gt;Andrew Gellman&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;implementing-a-consistent-coding-convention&quot;&gt;Implementing a consistent coding convention&lt;/h2&gt;

&lt;p&gt;After overcoming the mental inertia to decide on a new naming convention, actually implementing it should be the easy part. A series of &lt;a href=&quot;http://robinlovelace.net/r/2014/04/14/regex-in-R-RStudio.html&quot;&gt;regex&lt;/a&gt; commands could help, including the following (the ‘Regex’ tickbox must be enabled if you’re searching in RStudio):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[a-z]\.[a-z] # will search for dots between lowercase chars (period.separation)
[a-z][A-Z] # find camelBack code
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Unfortunately, these commands will also find many R commands that use these naming convention, so just re-reading the code may be just as fast.&lt;/p&gt;

&lt;p&gt;The below image shows the github diff of a typical change as part of a renaming strategy. Note in this example that not only are we implementing a consistent naming convention, we also added a new comment in this commit, improving the code’s ‘understandability’. Implementing a naming convention can be part of a wider campaign to improve your R projects. This could include adding comments, &lt;a href=&quot;http://robinlovelace.net/r/2014/06/25/pruning-a-giant-gh-repo.html&quot;&gt;removing redundant information&lt;/a&gt; from large projects and reformatting code, perhaps using the &lt;a href=&quot;http://cran.r-project.org/web/packages/formatR/index.html&quot;&gt;formatR package&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/commit/b6729590a5c9bbf3f4e5332c46e57c732412345c&quot;&gt;&lt;img src=&quot;https://dl.dropboxusercontent.com/u/15008199/img/r_style.png&quot; alt=&quot;commit&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;It &lt;em&gt;is&lt;/em&gt; important to think about style in writing any languages, especially if your code will be &lt;a href=&quot;http://journal.r-project.org/archive/2012-2/RJournal_2012-2_Baaaath.pdf&quot;&gt;read by others&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;“What could help might be to raise awareness in the R community about naming conventions; writers of books and tutorials on R could make a difference here by treating naming conventions when introducing the R language.”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In conclusion, it is lazy and irresponsible to write and maintain messy code that is difficult to read. By contrast, consistent, clear and well-commented code will help you and others use your code and ensure its longevity. Adoption of a clearly defined &lt;a href=&quot;http://en.wikipedia.org/wiki/Naming_convention_%28programming%29&quot;&gt;naming convention&lt;/a&gt; such as the &lt;strong&gt;underscore_separation&lt;/strong&gt; adopted in our &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/raw/master/intro-spatial-rl.pdf&quot;&gt;tutorial&lt;/a&gt; can be an easy step one can take &lt;em&gt;now&lt;/em&gt; towards this aim.&lt;/p&gt;

&lt;p&gt;The only question that remains is which naming convention &lt;code class=&quot;highlighter-rouge&quot;&gt;WiLL.U_uSe&lt;/code&gt;!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>GISRUK 2014 presentation</title>
   <link href="http://robinlovelace.github.com//2014/07/09/RMF-presentation.html"/>
   <updated>2014-07-09T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/07/09/RMF-presentation</id>
   <content type="html">&lt;p&gt;These are my slides for a presentation at the
&lt;a href=&quot;http://www.ncrm.ac.uk/RMF2014/home.php&quot;&gt;Research Methods Festival&lt;/a&gt;&lt;/p&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;889debc0e9420131acc00e2a91d60c51&quot; data-ratio=&quot;1.29129886506936&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;To rerun the some of the code underlying the spatial interaction model
results, you can
download the &lt;a href=&quot;https://github.com/Robinlovelace/twitter-leeds/archive/master.zip&quot;&gt;.zip file&lt;/a&gt;
of the &lt;a href=&quot;https://github.com/Robinlovelace/twitter-leeds&quot;&gt;twitter-leeds GitHub repository&lt;/a&gt;:
https://github.com/Robinlovelace/twitter-leeds&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>The Sage Handbook of Transport Studies - a review</title>
   <link href="http://robinlovelace.github.com//2014/07/07/tgrg-book-review.html"/>
   <updated>2014-07-07T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/07/07/tgrg-book-review</id>
   <content type="html">&lt;p&gt;Here’s my recently published review of the &lt;a href=&quot;http://www.uk.sagepub.com/books/Book234882&quot;&gt;Sage Handbook of Transport
Studies&lt;/a&gt;. No need to go into details here: it’s a solid overview book that
provides a useful introduction to this emerging field. The title of my &lt;a href=&quot;http://www.amazon.co.uk/SAGE-Handbook-Transport-Studies-Handbooks/dp/1849207895/ref=cm_aya_orig_subj&quot;&gt;Amazon
review&lt;/a&gt; sums up
my thoughts on it: “Comprehensive overview but bland at times”.&lt;/p&gt;

&lt;p&gt;For a more detailed review, please see my write-up on the &lt;a href=&quot;http://tgrg.wordpress.com/2014/06/30/new-transport-studies-handbook-a-review/&quot;&gt;Transport Geography Research Group
website&lt;/a&gt;, which
hosts a &lt;a href=&quot;https://tgrg.files.wordpress.com/2014/06/lovelace-2014-sage-handbook-of-transport-studies-jean-paul-rodrigue-theo-notteboom-jon-shaw-eds-sage-london-2013-c2a395-ha.pdf&quot;&gt;pdf version of the full review&lt;/a&gt;, &lt;a href=&quot;http://www.sciencedirect.com/science/article/pii/S096669231400088X&quot;&gt;published in the Journal of Transport
Geography&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://tgrg.wordpress.com/2014/06/30/new-transport-studies-handbook-a-review/&quot;&gt;&lt;img src=&quot;http://dl.dropboxusercontent.com/u/15008199/img/tgrgrev1.png&quot; alt=&quot;TransportGeogReview&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Cleaning up oversized github repositories for R and beyond</title>
   <link href="http://robinlovelace.github.com//2014/06/25/pruning-a-giant-gh-repo.html"/>
   <updated>2014-06-25T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/06/25/pruning-a-giant-gh-repo</id>
   <content type="html">&lt;p&gt;The version control system &lt;a href=&quot;http://git-scm.com/&quot;&gt;Git&lt;/a&gt;
is an amazing piece of software for tracking every change that
you make to a project and saving its entire history.
It is incredibly useful, for users of R and other
programming languages, leading it shoot from 0 market share
in 2005 (&lt;a href=&quot;http://en.wikipedia.org/wiki/Git_%28software%29&quot;&gt;when it was first released&lt;/a&gt;)
to market domination in one short decade.&lt;/p&gt;

&lt;p&gt;However, Git can cause confusion. Even (or at times especially)
when used in conjunction with a nice graphical user interface
such as that provided by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;,
the main online repository of
Git projects worldwide and home to over
&lt;a href=&quot;http://en.wikipedia.org/wiki/Github&quot;&gt;10 million projects&lt;/a&gt;,
Git can cause chaos.
Like Linux (the operating system was
incidentally created by the same prolific
&lt;a href=&quot;http://en.wikipedia.org/wiki/Linus_Torvalds&quot;&gt;person&lt;/a&gt;),
Git
&lt;a href=&quot;http://www.howtogeek.com/125157/8-deadly-commands-you-should-never-run-on-linux/&quot;&gt;assumes you know what you’re doing&lt;/a&gt;.
If you do not,
&lt;a href=&quot;http://stackoverflow.com/questions/2125710/how-to-revert-a-git-rm-r&quot;&gt;watch out&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Partly knowing what I was doing (but not fully) I set up a
repository to host a tutorial on
&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/&quot;&gt;making maps in R&lt;/a&gt;.
I was pretty relaxed about what went in there and soon, the
repository grew to an unwieldy 60 Mb in size and over 20 Mb
just to download the automatically created
&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/archive/master.zip&quot;&gt;zip file&lt;/a&gt;.
(It is now a sprightly
&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/archive/master.zip&quot;&gt;2.6 Mb Zipped, wahey!&lt;/a&gt;)
Needless to say this did not help my aim of making
R accessible to everyone, a tool for empowerment
(as this
&lt;a href=&quot;http://journal.r-project.org/archive/2013-1/godfrey.pdf&quot;&gt;inspiring article about R for blind people shows it can be&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;So I decided to act to clean things up. In the hope it’ll be useful
to others, what follows is a description of the main steps I took to
sort things out.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/figure/baobab-bfg.png&quot; alt=&quot;cleaning-in-action&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;step-1-delete-files-in-the-current-project&quot;&gt;Step 1: delete files in the current project&lt;/h2&gt;

&lt;p&gt;The first stage was simply to identify and delete excessively sized files
in the current version of the project. For this there is no better program
than &lt;a href=&quot;http://www.marzocca.net/linux/baobab/&quot;&gt;Baobab&lt;/a&gt;, which shows you where
bloat exists on your system.&lt;/p&gt;

&lt;p&gt;That was only part of the problem though: as shown in the image of
disk usage from Baobab below, most (80%, almost 50 Mb)
of the space was taken up by the .Git
folder itself. This meant files I’d changed in the past were taking up
the most space and. Git is not designed to allow you change the past but to save it…&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/figure/baobab-b4-bfg.png&quot; alt=&quot;b4-clean&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-2-use-the-bgf&quot;&gt;Step 2: use the BGF&lt;/h2&gt;

&lt;p&gt;Next up is the &lt;a href=&quot;http://rtyley.github.io/bfg-repo-cleaner/&quot;&gt;BFG ‘repo cleaner’&lt;/a&gt;.
This is just a small &lt;code class=&quot;highlighter-rouge&quot;&gt;java&lt;/code&gt; program that cleans up unwieldy commits
using a command line interface.&lt;/p&gt;

&lt;p&gt;In order for it to work, you need to &lt;em&gt;mirror&lt;/em&gt; your repository,
using the &lt;code class=&quot;highlighter-rouge&quot;&gt;--mirror&lt;/code&gt; flag when you clone. The first step was thus:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    $ git clone --mirror git@github.com:Robinlovelace/Creating-maps-in-R.git
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Next, you run this (in a Linux terminal,
as illustrated by the &lt;code class=&quot;highlighter-rouge&quot;&gt;$&lt;/code&gt; sign), changing the size depending on what you want
to keep:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   $ java -jar ~/programs/bfg-1.11.7.jar  --strip-blobs-bigger-than 1M  .git
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This successful cut the size of the project in half,
making it far more accessible, as shown in the figure below.
Note, the changes
made by the BFG only translate into disk space savings
&lt;em&gt;after&lt;/em&gt; running the following commands
(&lt;a href=&quot;http://rtyley.github.io/bfg-repo-cleaner/#usage&quot;&gt;suggested in the BFG usage section&lt;/a&gt;):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    $ cd Creating-maps-in-R.git/
    $ git reflog expire --expire=now --all
    $ git gc --prune=now --aggressive
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/baobab-after-bfg.png&quot; alt=&quot;after-clean&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;one-issue&quot;&gt;One issue&lt;/h2&gt;

&lt;p&gt;The only issue I encountered was this message:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    ! [remote rejected] refs/pull/1/head -&amp;gt; refs/pull/1/head (deny updating a hidden ref)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Although this was repeated several times, it didn’t seem to influence the success
of the operation: I’ve halved the size of my GitHub repo and roughly 1/8thed the 
size of the zip file people need
&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/archive/master.zip&quot;&gt;download to run the tutorial code&lt;/a&gt;. So the issue seems to be a non-issue in the grand scheme of things.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Ideally we’d all be like Linus Torvalds and make
&lt;a href=&quot;http://www.youtube.com/watch?v=4XpnKHJAok8&quot;&gt;no mistakes&lt;/a&gt;.
But unfortunately we are human and prone to mistakes, which are
actually one of the best ways of learning. Thanks to software
like BFG and many helping hands through the open source community,
99 times out of 100 these mistakes are no big deal. I hope this
post will help others to
shrink unwieldy git repositories and
&lt;a href=&quot;https://github.com/neovim/neovim/issues/311&quot;&gt;uncrustify&lt;/a&gt; their lives.
More importantly I hope this leads to better design from the outset:
the experience has certainly made me think about project design carefully
including saving giant .RData files externally and keeping new objects
in a project to a minimum. According to &lt;a href=&quot;http://www.resilience.org/stories/2012-03-29/collapse-complex-societies-review&quot;&gt;Joseph Tainter&lt;/a&gt;,
the marginal costs of added complexity now outweigh the benefits for
industrial civilization. Lets hope R users and other
programmers, at the very least, can simplify
our lives sufficiently to avoid collapse. Hopefully then the rest of society will
follow!&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Great circles on a world map with rworldmap and ggplot2 packages</title>
   <link href="http://robinlovelace.github.com//2014/06/22/great-circles-in-rworldmap-ggplot2.html"/>
   <updated>2014-06-22T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/06/22/great-circles-in-rworldmap-ggplot2</id>
   <content type="html">&lt;p&gt;Sometimes you may want to plot maps of the whole world, that little blue &lt;a href=&quot;http://en.wikipedia.org/wiki/The_Blue_Marble&quot;&gt;spinning sphere&lt;/a&gt; the surface of which provides a home for us all.  Creating maps of smaller areas is covered in a &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/raw/master/intro-spatial-rl.pdf&quot;&gt;tutorial&lt;/a&gt; I helped create called ‘Introduction to visualising spatial data in R’, hosted with data and code on a &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/&quot;&gt;github repository&lt;/a&gt;.  There are a range of options for plotting the world, including packages called &lt;a href=&quot;http://cran.r-project.org/web/packages/maps/index.html&quot;&gt;&lt;strong&gt;maps&lt;/strong&gt;&lt;/a&gt;, a function called &lt;a href=&quot;http://docs.ggplot2.org/0.9.3/map_data.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;map_data&lt;/code&gt;&lt;/a&gt; from &lt;strong&gt;ggplot2&lt;/strong&gt; package and &lt;a href=&quot;http://cran.r-project.org/web/packages/rworldmap/index.html&quot;&gt;&lt;strong&gt;rworldmap&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In this post we will use the latter two (newer) options to show how maps of the entire world can easily be produced in R and overlaid with shortest-line paths called &lt;em&gt;great circles&lt;/em&gt;. Amazingly, in each package, the geographic data for the world and many of its subregions are included, saving the need to download and store files of unknown quality from the internet.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/ggplot2 projections2.png&quot; alt=&quot;plot of chunk ggplot2 projections&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;plotting-continents-and-great-circle-lines-in-base-graphics&quot;&gt;Plotting continents and great circle lines in base graphics&lt;/h2&gt;

&lt;p&gt;The first stage is to load the packages we’ll be using:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-r&quot; data-lang=&quot;r&quot;&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rworldmap&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;geosphere&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ggmap&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;character.only&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Let us proceed by loading an entire map of the world from the &lt;strong&gt;rworldmap&lt;/strong&gt; function &lt;code class=&quot;highlighter-rouge&quot;&gt;getMap&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# load the map data class(s) # what type of are we dealing with?  &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;c1&quot;&gt;## [1] &quot;SpatialPolygonsDataFrame&quot; ## attr(,&quot;package&quot;) ## [1] &quot;sp&quot; &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;n&quot;&gt;nrow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# n. polygons &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;c1&quot;&gt;## [1] 244 &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# the data plotted (not shown) bbox(s) # the bounding box... of the entire world &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;c1&quot;&gt;##    min    max ## x -180 180.00 ## y  -90  83.65 &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The above shows that in single line of code we have loaded &lt;code class=&quot;highlighter-rouge&quot;&gt;s&lt;/code&gt;, which represents the entire world and all its countries.  This impressive in itself, and we can easily add further details like colour based on the countries’ attributes (incidentally, you can see the attribute data by typing &lt;code class=&quot;highlighter-rouge&quot;&gt;s@data&lt;/code&gt;).&lt;/p&gt;

&lt;h2 id=&quot;adding-points-randomly-scattered-over-the-face-of-the-earth&quot;&gt;Adding points randomly scattered over the face of the Earth&lt;/h2&gt;

&lt;p&gt;But what if we want to add up points to the map of the world and join them up? This can be done in the same way as we’d add points to any R graphic.  Using our knowledge of &lt;code class=&quot;highlighter-rouge&quot;&gt;bbox&lt;/code&gt; we can define the limits of random numbers (from &lt;code class=&quot;highlighter-rouge&quot;&gt;runif&lt;/code&gt;) to scatter points randomly over the surface of the earth in terms of longitude. Note the use of &lt;code class=&quot;highlighter-rouge&quot;&gt;cos(abs(l))&lt;/code&gt; to avoid oversampling at the poles, which have a much lower surface area than the equator, per &lt;a href=&quot;http://en.wikipedia.org/wiki/Cylindrical_equal-area_projection&quot;&gt;line of longitude&lt;/a&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;seed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1984&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bbox&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bbox&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prob&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;180&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;SpatialPoints&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cbind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ncol&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proj4string&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;CRS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;+proj=longlat +datum=WGS84&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;points&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/Plotting points.png&quot; alt=&quot;plot of chunk Plotting points&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;joining-the-dots&quot;&gt;Joining the dots&lt;/h2&gt;

&lt;p&gt;So how to join these randomly scattered points on the planet?  A first approximation would be to join them with straight lines.  Let’s join point 1, for example, to all others to test this method:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;segments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,])[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,])[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/Plotting segments.png&quot; alt=&quot;plot of chunk Plotting segments&quot; /&gt; (Incidentally, isn’t the use of &lt;code class=&quot;highlighter-rouge&quot;&gt;segments&lt;/code&gt; here rather clunky - any suggestions of a more elegant way to do this welcome.) The lines certainly do join up, but something doesn’t seem right in the map, right?  Well the fact that you have perfectly straight lines in the image means bendy lines over the Earth’s surface: these are not the shortest, &lt;a href=&quot;http://en.wikipedia.org/wiki/Great_circle&quot;&gt;great circle&lt;/a&gt; lines.  To add these great circle lines, we must use the &lt;strong&gt;geosphere&lt;/strong&gt; package:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gcIntermediate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# take a look at the output of the gcIntermediate function&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;c1&quot;&gt;##        lon    lat ## [1,] 55.16 -37.47 ## [2,] 53.16 -37.25 &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gcIntermediate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,]),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;blue&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lwd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# for loop to plot all lines going to zone 5&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gcIntermediate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,]),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/Plotting great circles 1.png&quot; alt=&quot;plot of chunk Plotting great circles 1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/figure-html/ggplot%20world%201.png&lt;/p&gt;

&lt;p&gt;Fantastic. Now we have great circle lines represented on a map with a &lt;a href=&quot;http://en.wikipedia.org/wiki/Geographic_coordinate_system&quot;&gt;geographic coordinate system (CRS)&lt;/a&gt; (as opposed to a projected CRS, which approximates Euclidean distance).&lt;/p&gt;

&lt;h2 id=&quot;beautifying-the-map&quot;&gt;Beautifying the map&lt;/h2&gt;

&lt;p&gt;The maps we created so far are not exactly beautiful.  Let’s try to make the map look a little nicer:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;n&quot;&gt;names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;c1&quot;&gt;##  [1] &quot;ScaleRank&quot;    &quot;LabelRank&quot;    &quot;FeatureCla&quot;   &quot;SOVEREIGNT&quot;  ##  [5] &quot;SOV_A3&quot;       &quot;ADM0_DIF&quot;     &quot;LEVEL&quot;        &quot;TYPE&quot;        ##  [9] &quot;ADMIN&quot;        &quot;ADM0_A3&quot;      &quot;GEOU_DIF&quot;     &quot;GEOUNIT&quot;     ## ...  &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgdal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# s &amp;lt;- spTransform(s, CRSobj=CRS(&quot;+proj=robin +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs&quot;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;rcols&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;terrain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;colors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unique&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;$REGION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;$col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;numeric&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;factor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;$REGION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;par&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'lightblue'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rcols&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;$col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xlim&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;180&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;180&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;points&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gcIntermediate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,]),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/Beautifying.png&quot; alt=&quot;plot of chunk Beautifying&quot; /&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt; &lt;span class=&quot;n&quot;&gt;par&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'white'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;doing-it-in-ggplot2&quot;&gt;Doing it in ggplot2&lt;/h2&gt;

&lt;p&gt;The ‘beautified’ map above certainly is more interesting visually, with added colours. But it’s difficult to call it truly beautiful. For that, as with so many things in R plotting, we turn to ggplot2.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;world&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;geom_polygon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;colour&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/ggplot world 1.png&quot; alt=&quot;plot of chunk ggplot world 1&quot; /&gt;   When we add the lines in projected maps (i.e. with a Euclidean coordinate system) based solely on origins and destinations, this works fine, but as with the previous example, generates incorrect shortest path lines:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# adding lines # for all combinations of lines, use this code # p1 &amp;lt;- do.call(rbind, rep(list(coordinates(p)),n )) # p2 &amp;lt;- cbind(rep(coordinates(p)[,1], each=n ), rep(coordinates(p)[,2], each=n ))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# for all lines goint to point 5:&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,])[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# test plotting the lines #&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;geom_segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xend&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yend&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;geom_polygon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;colour&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;geom_segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xend&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yend&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/Adding world lines ggplot2 style.png&quot; alt=&quot;plot of chunk Adding world lines ggplot2 style&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;adding-great-circle-lines-to-ggplot2-maps&quot;&gt;Adding great circle lines to ggplot2 maps&lt;/h2&gt;

&lt;p&gt;Adding great circle lines in ggplot2 is similar, but we must save all of the coordinates of the paths in advance before plotting, because ggplot2 like to add all its layers in one function: you cannot iteratively add to the map using a &lt;code class=&quot;highlighter-rouge&quot;&gt;for&lt;/code&gt; loop as we did in the base graphics example above.&lt;/p&gt;

&lt;p&gt;To create the for loop, first create a data frame of a single line.  The iterate for all zones and use &lt;code class=&quot;highlighter-rouge&quot;&gt;rbind&lt;/code&gt; to place one data frame on top of the next:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gcIntermediate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,])&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;$group&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setdiff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gcIntermediate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,])&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;$group&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rbind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;To plot multiple paths, we can use the &lt;code class=&quot;highlighter-rouge&quot;&gt;geom_segment&lt;/code&gt; command.  Before plotting the lines on the map, it’s sometimes best to first plot them on their own to ensure that everything is working.  Note the use of the command &lt;code class=&quot;highlighter-rouge&quot;&gt;ggplot()&lt;/code&gt;, which initiates an empty ggplot2 instances, ready to be filled with layers.  This is more flexible than stating the data at the outset.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;geom_polygon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;colour&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;geom_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;theme&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;panel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;background&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;element_rect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'lightblue'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/polygon paths ggplo2.png&quot; alt=&quot;plot of chunk polygon paths ggplo2&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;changing-projection-in-ggplot&quot;&gt;Changing projection in ggplot&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;ggplot2&lt;/em&gt; has inbuilt map projection functionality with the function &lt;code class=&quot;highlighter-rouge&quot;&gt;coord_map&lt;/code&gt;. This distorts the Euclidean axis of the map and allows some truly extraodinary shapes (these transformations can also be done in base graphics, e.g. by using &lt;code class=&quot;highlighter-rouge&quot;&gt;spTransform&lt;/code&gt;). However, as shown in the examples below, the library is currently buggy for plotting polygons.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# to see the range of projections available using this method, try ?mapproject&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;last_plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coord_map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/ggplot2 projections1.png&quot; alt=&quot;plot of chunk ggplot2 projections&quot; /&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# remove fill as this clearly causes problems:&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;geom_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;colour&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;geom_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# m + coord_map(&quot;bicentric&quot;, lon = 0)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# m + coord_map(&quot;bonne&quot;, lat= 0)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coord_map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ortho&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;orientation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;41&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;74&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# for ortho maps&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Robinlovelace/Creating-maps-in-R/master/vignettes/world-great-circles_files/figure-html/ggplot2 projections2.png&quot; alt=&quot;plot of chunk ggplot2 projections&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;We’ve seen 2 ways of plotting maps of the world and overlaying ‘great circles’ lines on them. There are probably more, but these two options seem to work well, except with the bugs in &lt;strong&gt;ggplot2&lt;/strong&gt; for plotting polygons in many map projections. The two methods are not incompatible (see &lt;code class=&quot;highlighter-rouge&quot;&gt;fortify&lt;/code&gt; for plotting &lt;strong&gt;sp&lt;/strong&gt; objects in &lt;strong&gt;ggplot2&lt;/strong&gt;) and can be combined in many other ways.&lt;/p&gt;

&lt;p&gt;For more information on plotting spatial data in R, I recommend checking out R’s range of &lt;a href=&quot;http://cran.r-project.org/web/views/Spatial.html&quot;&gt;spatial packages&lt;/a&gt;.  For an introductory tutorial on visualising spatial data in R, you could do much worse than start with &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/raw/master/intro-spatial-rl.pdf&quot;&gt;Visualising Spatial Data in R&lt;/a&gt; by &lt;a href=&quot;http://spatial.ly/&quot;&gt;James Cheshire&lt;/a&gt; and &lt;a href=&quot;http://robinlovelace.net/&quot;&gt;myself&lt;/a&gt;.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Advances in datasets and models for simulating flows: opportunities and risks</title>
   <link href="http://robinlovelace.github.com//2014/06/04/advances-for-simulating-pop-flows.html"/>
   <updated>2014-06-04T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/06/04/advances-for-simulating-pop-flows</id>
   <content type="html">&lt;p&gt;These are slides of a talk I’m doing tomorrow on advances in datasets and models for simulating flows of people over space.&lt;/p&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;08190f70ce690131a8cd564ad4407ede&quot; data-ratio=&quot;1.41436464088398&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

</content>
 </entry>
 
 <entry>
   <title>Stafford to Ludlow by bike</title>
   <link href="http://robinlovelace.github.com//2014/05/17/stafford-to-ludlow-by-bike.html"/>
   <updated>2014-05-17T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/05/17/stafford-to-ludlow-by-bike</id>
   <content type="html">&lt;p&gt;The mission was to get from my current place in Leeds to my home
town of Hereford. It’s &lt;a href=&quot;https://maps.google.com/maps?saddr=Leeds,+UK&amp;amp;daddr=Hereford&amp;amp;hl=en&amp;amp;sll=37.0625,-95.677068&amp;amp;sspn=38.554089,86.572266&amp;amp;geocode=FTPvNAMd61zo_ymZvWTaSj55SDGp3BMC_bqtUQ%3BFU5RGgMduo7W_ylBU26qJdRvSDGWbDz9S5qc1Q&amp;amp;t=h&amp;amp;mra=ls&amp;amp;z=8&quot;&gt;178 miles by motorway&lt;/a&gt;
and a &lt;a href=&quot;http://ojp.nationalrail.co.uk/service/timesandfares/LDS/HFD/today/1045/dep&quot;&gt;long and
pricey&lt;/a&gt;
trip by
train. But at even at an optimistic speed of 15 mph and no stops it was even less
attractive to by bike: an impossibility in a single day. So a compromise was in order&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;to travel by train part of the journey and cycle the rest. That way I would
passed through a part of the world that was previously unexplored: the
Shropshire countryside.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Stafford seemed like the ideal place to start: it’s far enough west to get into
the countryside and far enough north to still provide a decent ride to Hereford,
80 miles in total. Although I didn’t make it all the way to Hereford by bike (I
got lazy and jumped on a train in Ludlow), it was an enjoyable ride and a
story worth telling. Inter-city cycling is more feasible than most people think,
especially when combined with rail.&lt;/p&gt;

&lt;iframe src=&quot;http://www.gpsies.com/mapOnly.do?fileId=shybcymaesmgwffg&quot; width=&quot;600&quot; height=&quot;400&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot; marginheight=&quot;0&quot; marginwidth=&quot;0&quot;&gt;&lt;/iframe&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;getting-to-stafford&quot;&gt;Getting to Stafford&lt;/h2&gt;

&lt;p&gt;The first stage was getting there. I was close to not even being able
to get my bike on the train and just caught the tail end of the rush hour
on the 08:55 from Leeds to Manchester. In hindsight I’d have booked through
East Coast, the &lt;a href=&quot;http://www.cyclescheme.co.uk/community/how-to/bike-rail-commuting&quot;&gt;only train ticket vendor to send bike reservations in the
pos&lt;/a&gt;,
to ensure bike places, but fortunately I was in luck. The train out to Stafford
was more spacious and I was on the road by 11am.&lt;/p&gt;

&lt;h2 id=&quot;cycle-routing-options&quot;&gt;Cycle routing options&lt;/h2&gt;

&lt;p&gt;The great thing about smartphones is that they enable flexibility in route
planning. Although I had glanced at the route previously on Google Maps, on the
day I decided to try the cyclis-specific planning application
&lt;a href=&quot;http://www.cyclestreets.net/&quot;&gt;CycleStreets.net&lt;/a&gt;. I was really impressed with
the “fastest” route that it chose for me and, with headphones in one ear, I
could simply follow the audio instructions about the best way to get out into
Stafford. Before long I was in the countryside, flying over the fast and
comparatively empty A and B roads that
&lt;a href=&quot;http://www.cyclestreets.net/journey/40931228/&quot;&gt;CycleStreets.net directed me to&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://dl.dropboxusercontent.com/u/15008199/img/staff2lud-cc.png&quot; alt=&quot;staffimage&quot; /&gt;.&lt;/p&gt;

&lt;p&gt;It is interesting to compare the distances of routes recommended by
cyclestreets.net and Google’s bicycle routes: the former suggests routes of 45,
50 and 55 miles for the fastest, balanced and quietest &lt;a href=&quot;http://www.cyclestreets.net/help/overview/&quot;&gt;route options,
respectively&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://maps.google.com/maps?saddr=Stafford,+UK&amp;amp;daddr=ludlow&amp;amp;hl=en&amp;amp;ll=52.588032,-2.426605&amp;amp;spn=0.463051,1.352692&amp;amp;sll=52.587297,-2.411246&amp;amp;sspn=0.463059,1.352692&amp;amp;geocode=FSXEJQMdLKTf_ylffQttf4JwSDEIWNgR1bNHGw%3BFYURHwMdx5bW_ylLK1nDtxRwSDEOGXwYP9AZfA&amp;amp;t=h&amp;amp;dirflg=b&amp;amp;mra=ltm&amp;amp;z=10&amp;amp;lci=bike&quot;&gt;Google’s only offers one bicycle option for the same
trip&lt;/a&gt;:
53 miles taking you way out West in quite a cirquitous route. The car route is
also unacceptable, because it favours fast roads rather than directness, with a
distance of 47 miles:&lt;/p&gt;

&lt;iframe width=&quot;425&quot; height=&quot;350&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot; marginheight=&quot;0&quot; marginwidth=&quot;0&quot; src=&quot;https://maps.google.com/maps?f=d&amp;amp;source=s_d&amp;amp;saddr=Stafford,+UK&amp;amp;daddr=ludlow&amp;amp;hl=en&amp;amp;geocode=FSXEJQMdLKTf_ylffQttf4JwSDEIWNgR1bNHGw%3BFYURHwMdx5bW_ylLK1nDtxRwSDEOGXwYP9AZfA&amp;amp;aq=t&amp;amp;sll=52.588032,-2.426605&amp;amp;sspn=0.463051,1.352692&amp;amp;t=h&amp;amp;mra=ltm&amp;amp;ie=UTF8&amp;amp;ll=52.588032,-2.426605&amp;amp;spn=0.439152,0.609723&amp;amp;output=embed&quot;&gt;&lt;/iframe&gt;
&lt;p&gt;&lt;br /&gt;&lt;small&gt;&lt;a href=&quot;https://maps.google.com/maps?f=d&amp;amp;source=embed&amp;amp;saddr=Stafford,+UK&amp;amp;daddr=ludlow&amp;amp;hl=en&amp;amp;geocode=FSXEJQMdLKTf_ylffQttf4JwSDEIWNgR1bNHGw%3BFYURHwMdx5bW_ylLK1nDtxRwSDEOGXwYP9AZfA&amp;amp;aq=t&amp;amp;sll=52.588032,-2.426605&amp;amp;sspn=0.463051,1.352692&amp;amp;t=h&amp;amp;mra=ltm&amp;amp;ie=UTF8&amp;amp;ll=52.588032,-2.426605&amp;amp;spn=0.439152,0.609723&quot; style=&quot;color:#0000FF;text-align:left&quot;&gt;View Larger Map&lt;/a&gt;&lt;/small&gt;&lt;/p&gt;

&lt;!--compare google with cyclestreets--&gt;

&lt;h2 id=&quot;the-low-point-of-the-journey-iron-bridge&quot;&gt;The low-point of the journey: Iron Bridge&lt;/h2&gt;

&lt;p&gt;The low-point of the journey in literal terms was the bidge at Coalport,
a quaint single lane bridge with steep roads either side:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://s0.geograph.org.uk/geophotos/02/05/08/2050843_dd4d555e.jpg&quot; alt=&quot;bridge&quot; /&gt;.&lt;/p&gt;

&lt;p&gt;This is not the famous &lt;a href=&quot;http://en.wikipedia.org/wiki/Ironbridge&quot;&gt;bridge&lt;/a&gt; in
the aptly named neighbouring settlement of Ironbridge, but is equally
impressive. The whole thing was made from cast iron back in 1818!&lt;/p&gt;

&lt;h2 id=&quot;ludlow-laziness&quot;&gt;Ludlow laziness&lt;/h2&gt;

&lt;p&gt;As mentioned in the introduction, the original plan was to cycle all the way
from Stafford to Hereford, ~80 miles. However, with the sun beaming and my
energy levels flaking the temptation to get on the train at Ludlow started
appealing to me. A phone call with a friend from Hereford sealed it: if I could
be back by 5:30 he’d meet me in the pub. Therefore I jumped at the opportunity,
passing through Ludlow’s historic market before getting on the train.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;This was a really fun ride and for me highlights the benefits of mixing bicycles
with trains as a flexible, fast and fun form of transport.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Audio from George Monbiot's Speri lecture: The Pricing of Everything</title>
   <link href="http://robinlovelace.github.com//2014/05/07/Monbiot-speri-talk.html"/>
   <updated>2014-05-07T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/05/07/Monbiot-speri-talk</id>
   <content type="html">&lt;p&gt;Last Tuesday I attended George Monbiot’s delivery of the &lt;a href=&quot;http://speri.dept.shef.ac.uk/2014/03/21/registration-open-george-monbiot-annual-lecture/&quot;&gt;Speri annual lecture&lt;/a&gt;,
an event hosted by the University of Sheffield. Monbiot was on form, and proceeded
to deliver a damning polemic against the tendency of well-meaning environmentalists
to &lt;a href=&quot;http://en.wikipedia.org/wiki/Ecosystem_valuation&quot;&gt;commodify&lt;/a&gt; the natural world
in an attempt to preserve it. It was an entertaining speech, containing jokes about
‘Crystal Methodist’ Paul Flowers, whose sins are no greater that your average
banking chieftain: at least Paul bought his own drugs. In any case, the talk
can be listened-to below: judge for yourself.&lt;/p&gt;

&lt;iframe width=&quot;100%&quot; height=&quot;166&quot; scrolling=&quot;no&quot; frameborder=&quot;no&quot; src=&quot;https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/148310169&amp;amp;color=ff5500&amp;amp;auto_play=false&amp;amp;hide_related=false&amp;amp;show_artwork=true&quot;&gt;&lt;/iframe&gt;

&lt;!--more--&gt;

&lt;p&gt;The talk was a serious critique of the impact of free market &lt;em&gt;values&lt;/em&gt; on the
our perception and treatment of the natural world. What I’d not thought of
before that Monbiot described in great detail was how putting a value on nature
we are reinforcing the neoliberal worldview which is largely responsible for
the degradation of the environment in the first place. It’s like asking a wolf
to take care of your sheep.&lt;/p&gt;

&lt;p&gt;There are so many arguments in there that it’s hard to summarise in a short
article. Suffice to say the audience seemed enthralled by it and my friends
and I left the building feeling inspired. Well worth attending.&lt;/p&gt;

&lt;p&gt;To find out more about Monbiot’s work, there is no better place to start
that his own &lt;a href=&quot;http://www.monbiot.com/&quot;&gt;website&lt;/a&gt; which contains full transcripts
of his articles for the Guardian and other outlets, as well as detailed reference
lists.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Modelling a 'Get Britain Cycling' scenario of modal shift</title>
   <link href="http://robinlovelace.github.com//2014/04/20/modelling-cycling-scenario.html"/>
   <updated>2014-04-20T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/04/20/modelling-cycling-scenario</id>
   <content type="html">&lt;p&gt;These are the slides of a presentation I am doing
today for the &lt;a href=&quot;http://e-futures.group.shef.ac.uk/page/home/&quot;&gt;E-Futures Doctoral Training
Centre&lt;/a&gt;
in Sheffield. This is where I developed my interest in transport and energy and
where I learned many of my research skills so it’s a return-home talk for me.
The links in the presentation are almost as interesting as the presentation
itself (for me at least) so please feel free to download and share the slides.&lt;/p&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;f7eb6130b1b6013166606626245ad2b7&quot; data-ratio=&quot;1.33333333333333&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

</content>
 </entry>
 
 <entry>
   <title>Installing neovim on Ubuntu</title>
   <link href="http://robinlovelace.github.com//2014/04/19/installing-neovim-on-ubuntu.html"/>
   <updated>2014-04-19T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/04/19/installing-neovim-on-ubuntu</id>
   <content type="html">&lt;p&gt;&lt;a href=&quot;https://github.com/neovim/neovim&quot;&gt;Neovim&lt;/a&gt; is a new version of
the ancient (in computing terms at least!) text editing program Vim,
“for the 21st century”. The new edition &lt;a href=&quot;https://www.bountysource.com/teams/neovim/fundraiser&quot;&gt;promises&lt;/a&gt;
to be lighter weight, faster and have better support for 3rd party programs. This latter point is exciting
because it means that fully featured ‘vim mode’ could be
added to other programs such as &lt;a href=&quot;http://www.rstudio.com/&quot;&gt;RStudio&lt;/a&gt;,
which currently lacks &lt;a href=&quot;https://support.rstudio.com/hc/communities/public/questions/200879313-Better-vim-mode?locale=en-us&quot;&gt;key functionalities&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://dl.dropboxusercontent.com/u/15008199/Images-2-share/nvim.png&quot; alt=&quot;neovimshot&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;Neovim is of great interest to computer programmers and digital technology
enthusiasts. The excitement seems justified based on neovim’s rapid evolution
and &lt;a href=&quot;http://www.reddit.com/r/vim/comments/22kemc/cool_progress_on_neovim/&quot;&gt;new
features&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The development of neovim should also be of interest to
advocates of &lt;a href=&quot;http://en.wikibooks.org/wiki/Information_and_Communication_Technologies_for_Poverty_Alleviation&quot;&gt;technology for poverty alleviation&lt;/a&gt;: it will provide
a world class toolkit for free, where alternatives such as
&lt;a href=&quot;http://www.sublimetext.com/&quot;&gt;Sublime&lt;/a&gt;
and &lt;a href=&quot;http://license.macromates.com/&quot;&gt;TextMate&lt;/a&gt; cost
in the region of £50.&lt;/p&gt;

&lt;p&gt;Happy to say that neovim is up and running on my computer
and can be called from the terminal with &lt;code class=&quot;highlighter-rouge&quot;&gt;nvim&lt;/code&gt;.
The installation is
&lt;a href=&quot;https://github.com/neovim/neovim/wiki/Installing&quot;&gt;described on the website&lt;/a&gt;, but can seem a little daunting to
people new to the world of Linux. So here’s my brief ‘how to’:&lt;/p&gt;

&lt;h2 id=&quot;1-unpack-the-neovim-folder-onto-your-computer&quot;&gt;1: Unpack the neovim folder onto your computer&lt;/h2&gt;

&lt;p&gt;This can be done either by downloading the &lt;a href=&quot;https://github.com/neovim/neovim/archive/master.zip&quot;&gt;.zip
file&lt;/a&gt; and unzipping it
wherever you like or, if you have git installed, by typing&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;git clone https://github.com/neovim/neovim.git&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;inside a terminal.&lt;/p&gt;

&lt;h2 id=&quot;2-build-it&quot;&gt;2: Build it&lt;/h2&gt;

&lt;p&gt;At this stage you need to be in a terminal. Navigate into
neovim, e.g. by typing &lt;code class=&quot;highlighter-rouge&quot;&gt;cd neovim&lt;/code&gt; after the previous command.
Then its a case of issuing the build commands:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;make cmake&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cmake&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo make install&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;These three commands got neovim up and running without issue.
I’m not 100% sure if you need all 3, but it worked for me.&lt;/p&gt;

&lt;h2 id=&quot;3-using-neovim&quot;&gt;3. Using neovim&lt;/h2&gt;

&lt;p&gt;Neovim only runs in the terminal at present - a graphical user interface
called gnvim can be expected at some point. Just type &lt;code class=&quot;highlighter-rouge&quot;&gt;nvim&lt;/code&gt; to see it up
and running.&lt;/p&gt;

&lt;p&gt;Initially, nvim will perform a bit strange - the backspace won’t work, for
example and you will be unable to use the mouse - that’s because it’s in
&lt;a href=&quot;http://superuser.com/questions/543317/what-is-compatible-mode-in-vim&quot;&gt;vi compatible
mode&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To make neovim load in a more ‘normal’ mode, just create a file
called .nvimrc and place it in your home directory. You don’t need to add
anything to this file: it’s mere existence will prevent nvim booting into the
antiquated mode. From there on, nvim simply works.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>GISRUK 2014 presentation</title>
   <link href="http://robinlovelace.github.com//2014/04/17/GISRUK-2014-presentation.html"/>
   <updated>2014-04-17T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/04/17/GISRUK-2014-presentation</id>
   <content type="html">&lt;p&gt;These are my presentation slides for the Geographic Information System
Research UK conference (aka GISRUK) held this year in
&lt;a href=&quot;http://www.gla.ac.uk/conferences/gisruk/&quot;&gt;Glasgow&lt;/a&gt;.
The talk discusses the potential and pitfalls of the growth
in ‘Big Data’ in geographic research and seeks to open up
the debate on the situations when such information is more,
or less, useful for improving our understanding of the world.
Check the final slides for follow-ups on this.&lt;/p&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;6db3cca0a7d90131f453524187cb86b1&quot; data-ratio=&quot;1.29129886506936&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;To rerun the code underlying the results presented in the presentation is simple:
download the &lt;a href=&quot;https://github.com/Robinlovelace/twitter-leeds/archive/master.zip&quot;&gt;.zip file&lt;/a&gt;
of the &lt;a href=&quot;https://github.com/Robinlovelace/twitter-leeds&quot;&gt;twitter-leeds GitHub repository&lt;/a&gt;:
https://github.com/Robinlovelace/twitter-leeds&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Regular expressions in R vs RStudio</title>
   <link href="http://robinlovelace.github.com//2014/04/14/regex-in-R-RStudio.html"/>
   <updated>2014-04-14T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/04/14/regex-in-R-RStudio</id>
   <content type="html">&lt;p&gt;The ‘regex’ family of languages and
commands is used for manipulating text strings. More specifically, 
regular expressions are typically used for finding specific patterns of characters and
replacing them with others. These technique have a range of applications
and R’s base installation has powerful regex tools (not to mention
add-on packages for string manipulation such as
&lt;a href=&quot;http://cran.r-project.org/web/packages/stringr/index.html&quot;&gt;stringr&lt;/a&gt;).
Yet regex in R is cause of much confusion, as indicated by the multitude of
&lt;a href=&quot;http://stackoverflow.com/search?q=[r]+regex&quot;&gt;stackoverflow questions on the subject&lt;/a&gt;
and the documentation is difficult for novices to the world of regex.&lt;/p&gt;

&lt;p&gt;In this post we are going to see a few reproducible examples of R’s
implementation of regular expressions and how it can make your life easier.
There is already much useful information on the topic such as a simple
how-to on using
&lt;a href=&quot;http://www.r-bloggers.com/making-regex-examples-work-for-you/&quot;&gt;regex to load files with specific names&lt;/a&gt;,
an excellent introduction from &lt;a href=&quot;http://www.regular-expressions.info/rlanguage.html&quot;&gt;Regular-Expressions.info&lt;/a&gt;
and R’s terse documentation on the matter triggered with &lt;code class=&quot;highlighter-rouge&quot;&gt;?regex&lt;/code&gt;.
In an attempt to adhere to the DRY principle, this article will focus on
just three topics: R’s basic regex commands, search and replace in R and
R Studio’s implementation of regex. The final topic has rarely been discussed
yet understanding the differences between regex in R Studio’s search panel
and in standard R can save much time.
R Studio’s implementation of regex is &lt;a href=&quot;https://support.rstudio.com/hc/communities/public/questions/200641328-regex-replace?locale=en-us&quot;&gt;confusingly different&lt;/a&gt;
from R’s default regex behavior.&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;rs-basic-regex-commands&quot;&gt;R’s basic regex commands&lt;/h2&gt;

&lt;p&gt;Let us start with an example: illegal column names that describe
age categories, attributes and which we want to eventually
prefix with ‘m’. Here are the original column names imported from Excel:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-{r}&quot;&gt;x &amp;lt;- c(&quot;16_24cat&quot;, &quot;25_34cat&quot;, &quot;35_44catch&quot;, &quot;45_54Cat&quot;, &quot;55_104fat&quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Imagine we first want to select all items in this string containing
‘cat’. The basic regex command in R is &lt;code class=&quot;highlighter-rouge&quot;&gt;grep&lt;/code&gt;, which simply
returns the index of the matching elements:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;grep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;cat&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] 1 2 3
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Note that ‘catch’ was included whereas ‘Cat’ was not: the matching
pattern can appear anywhere in the text string but is case specific.
To make the search ignore cases, simply add the &lt;code class=&quot;highlighter-rouge&quot;&gt;ignore.case = T&lt;/code&gt; argument.
To exclude ‘catch’, the dollar sign can be used. These arguments can be used
to extract the names we are really interested in:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;grep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;cat$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ignore.case&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] 1 2 4
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;grepl&lt;/code&gt; is the same as &lt;code class=&quot;highlighter-rouge&quot;&gt;grep&lt;/code&gt;, only it outputs a yes/no output for each element:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;grepl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;cat$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ignore.case&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1]  TRUE  TRUE FALSE  TRUE FALSE
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Another regex-related command worth knowing &lt;code class=&quot;highlighter-rouge&quot;&gt;strsplit&lt;/code&gt;. Imagine
we want all characters on the right-hand side of the underscore.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;strsplit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [[1]]
## [1] &quot;16&quot;    &quot;24cat&quot;
## 
## [[2]]
## [1] &quot;25&quot;    &quot;34cat&quot;
## 
## [[3]]
## [1] &quot;35&quot;      &quot;44catch&quot;
## 
## [[4]]
## [1] &quot;45&quot;    &quot;54Cat&quot;
## 
## [[5]]
## [1] &quot;55&quot;     &quot;104fat&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Strangely, the hardest part of the &lt;code class=&quot;highlighter-rouge&quot;&gt;strsplit&lt;/code&gt; function
is to re-combine the list output into a useful form.
For this, in base R, we need the power of &lt;code class=&quot;highlighter-rouge&quot;&gt;sapply&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strsplit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;[&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] &quot;24cat&quot;   &quot;34cat&quot;   &quot;44catch&quot; &quot;54Cat&quot;   &quot;104fat&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;A simpler way to achieve this same result would be to use the
&lt;code class=&quot;highlighter-rouge&quot;&gt;str_split_fixed&lt;/code&gt; function of the &lt;code class=&quot;highlighter-rouge&quot;&gt;stringr&lt;/code&gt; package:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stringr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;str_split_fixed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] &quot;24cat&quot;   &quot;34cat&quot;   &quot;44catch&quot; &quot;54Cat&quot;   &quot;104fat&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;finding-and-replacing-in-r&quot;&gt;Finding and replacing in R&lt;/h2&gt;

&lt;p&gt;To search and replace the first instance of a pattern, use &lt;code class=&quot;highlighter-rouge&quot;&gt;sub&lt;/code&gt;.
Much more useful is &lt;code class=&quot;highlighter-rouge&quot;&gt;gsub&lt;/code&gt;, which replaces all instances.
To replace all instances of ‘cat’ with ‘fat’, use the following:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;cat$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replacement&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;fat&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ignore.case&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] &quot;16_24fat&quot;   &quot;25_34fat&quot;   &quot;35_44catch&quot; &quot;45_54fat&quot;   &quot;55_104fat&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Let’s try something more complicated. We want all instances of
two numbers followed by an alphabet letter to have an additional character
inserted, but only if the first of those numbers is 3 or less:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;([1-3][1-9][a-z])&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;m\\1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;perl&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] &quot;16_m24cat&quot;  &quot;25_m34cat&quot;  &quot;35_44catch&quot; &quot;45_54Cat&quot;   &quot;55_104fat&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The above syntax is bizarre, so let’s run 
through it.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;We have specified that we want &lt;a href=&quot;http://www.regular-expressions.info/perl.html&quot;&gt;Perl-esque&lt;/a&gt;
regex, “as you should”, according to &lt;a href=&quot;http://www.regular-expressions.info/rlanguage.html&quot;&gt;a source of authority on the
matter&lt;/a&gt;, as this allows
‘&lt;a href=&quot;http://www.regular-expressions.info/modifiers.html&quot;&gt;mode modifiers&lt;/a&gt;’ to change the
behaviour of specific chunks of regex within curved brackets. (Although the same result
would be acheived without Perl in this case.)&lt;/li&gt;
  &lt;li&gt;The curved brackets
have no impact on the search result, but are used to store the contents
of the group, to be referred to subsequently.&lt;/li&gt;
  &lt;li&gt;The square brackets refer to any character matching the range of values indicated.&lt;/li&gt;
  &lt;li&gt;the &lt;code class=&quot;highlighter-rouge&quot;&gt;\\1&lt;/code&gt; symbol means “replace this with the value captured in group 1”,
meaning that the same numbers are retained, even though the numbers were used in the match.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;regular-expressions-in-rstudio&quot;&gt;Regular expressions in RStudio&lt;/h2&gt;

&lt;p&gt;The above bullet points may seem like a daunting amount of explanation 
for only one line of code, and the regex is still 
relatively simple! More complex commands can be done, especially when
the &lt;code class=&quot;highlighter-rouge&quot;&gt;perl = T&lt;/code&gt; argument is enabled or using the more coherent &lt;code class=&quot;highlighter-rouge&quot;&gt;stringr&lt;/code&gt;
package. However, one of the main uses that R users may have for regular
expressions is not their data per se - R is most useful for &lt;em&gt;quantitative&lt;/em&gt; not
character information after all. Regular expressions can be hugely useful for
editing long R scripts to do different jobs.&lt;/p&gt;

&lt;p&gt;R Studio’s search and replace functionality is well known but the little “Regex”
tick mark is less so.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/rbloggers/regex-button.png&quot; alt=&quot;button&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hitting that tick mark brings the whole power of Perl regex to bear on your
code editing: time spent learning the functionality of
regular expressions can pay dividends in fast code modification and
automation of repetitive tasks.&lt;/p&gt;

&lt;p&gt;In fact, the example used throughout this article was originally implemented
in RStudio to change the name of text strings so they would be valid
column names. The text in the previous image means, in English, “search
for any instance of &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;&lt;/code&gt; followed by a number and then insert the letter &lt;code class=&quot;highlighter-rouge&quot;&gt;m&lt;/code&gt;
directly after the quote mark and the number”. This altered all the column names 
in an instant.&lt;/p&gt;

&lt;p&gt;Unfortunately, R Studio’s website has little in the way of documentation
for this little feature (hint hint to any on the RStudio team reading this),
other than a
&lt;a href=&quot;https://support.rstudio.com/hc/communities/public/questions/200641328-regex-replace?locale=en-us&quot;&gt;thread about how it differs from R’s implementation&lt;/a&gt;, as covered
in this article.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Clearly, there is large potential for confusion in R’s implementation of
regular expressions. To pick one example, the group
register &lt;code class=&quot;highlighter-rouge&quot;&gt;$1&lt;/code&gt; in RStudio and pure Perl is different from the &lt;code class=&quot;highlighter-rouge&quot;&gt;\\1&lt;/code&gt; register used in R.
Yet it is well worth the effort of learning regex in R, as it opens up
huge possibility for the manipulation and analysis of text data as well
as automation of your own code re-writing.&lt;/p&gt;

&lt;p&gt;This article and the reproducible examples should be of use
to others. Understanding regular expressions in R and RStudio can make the
R programming process more powerful, less prone to human error and
faster. It is hoped that this will allow R users more time away from their computers,
to enjoy nature and hopefully to return to their computers with a refreshed desire
to learn and use their specialist skills for the greater good.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Publising your research, a talk for PhD students</title>
   <link href="http://robinlovelace.github.com//2014/04/02/publising-phd.html"/>
   <updated>2014-04-02T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2014/04/02/publising-phd</id>
   <content type="html">&lt;p&gt;This talk was part of the University of Leed’s
&lt;a href=&quot;https://speakerdeck.com/robinlovelace/publishing-during-your-phd&quot;&gt;LEAP HUB&lt;/a&gt;
conference. The content is aimed towards
current PhD students interested in getting published.
However, it should also be of use to anyone, regardless of your
job, who wants to communicate research they have undertaken.
The origin Powerpoint of the slides can be found &lt;a href=&quot;https://www.dropbox.com/s/pglch3kau588eq4/Publishing%20during%20your%20PhD.ppt&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;bcc9e2909c7a0131526e6a6e3dccec79&quot; data-ratio=&quot;1.41436464088398&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

</content>
 </entry>
 
 <entry>
   <title>Aggregating spatial points by clusters</title>
   <link href="http://robinlovelace.github.com//2014/03/21/clustering-points-R.html"/>
   <updated>2014-03-21T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/03/21/clustering-points-R</id>
   <content type="html">&lt;p&gt;With ubiquitous collection devices (e.g. smartphones), having &lt;em&gt;too much&lt;/em&gt;
data may become an increasingly common problem for spatial analysts, 
even with increasingly powerful computers. This is ironic, 
because a few short decades ago, &lt;em&gt;too little&lt;/em&gt; data was a primary constraint.&lt;/p&gt;

&lt;p&gt;This tutorial builds on the ‘Attribute joins’ section of the 
&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/raw/master/intro-spatial-rl.pdf&quot;&gt;Creating maps in R tutorial&lt;/a&gt;
to demonstrate how clusters can be identified 
in a field of spatial points and then used as the basis of aggregation 
to reduce the total number of points. It is also available 
on &lt;a href=&quot;http://rpubs.com/RobinLovelace/14465&quot;&gt;rpubs&lt;/a&gt;.
As well as providing a useful way of manipulating data, 
the tutorial also demonstrates the creation of a multi-layered map
with R’s base graphics.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/figure/Aggregated_data_for_culters.png&quot; alt=&quot;plot of chunk Aggregated data for culters&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;
&lt;h2 id=&quot;load-the-data&quot;&gt;Load the data&lt;/h2&gt;

&lt;p&gt;So, starting from within the project’s folder (which can be downloaded 
from &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/archive/master.zip&quot;&gt;here&lt;/a&gt;),
lets start by reaffirming our starting point: 
transport points in London:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# add spatial package to load the S4 spatial objects
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data/stations.RData&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# load 731 station points
&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# double-check what type of data we have
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] &quot;SpatialPointsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data/lnd.RData&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# load London zones for context
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/Plot_of_the_point_data.png&quot; alt=&quot;plot of chunk Plot of the point data&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;plotting-density&quot;&gt;Plotting density&lt;/h2&gt;

&lt;p&gt;From the above plot it seems that these points are quite evenly distributed, with 
some minor clusters. How can we identify these? A common option is to 
convert the point data into a 2d continuous field of &lt;em&gt;point density&lt;/em&gt;.
In order to do this,
and then create density contours, we will first convert them into the &lt;code class=&quot;highlighter-rouge&quot;&gt;ppp&lt;/code&gt;
class. This allows us to use the powerful functions of the &lt;code class=&quot;highlighter-rouge&quot;&gt;spatstat&lt;/code&gt;
package to be used on the points.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spatstat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# to calculate field of point density
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## Loading required package: mgcv
## Loading required package: nlme
## This is mgcv 1.7-28. For overview type 'help(&quot;mgcv-package&quot;)'.
## Loading required package: deldir
## deldir 0.0-22
## 
## spatstat 1.32-0     (nickname: 'Logistical Nightmare') 
## For an introduction to spatstat, type 'beginner'
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maptools&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# to convert to point pattern
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## Checking rgeos availability: TRUE
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sSp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SpatialPoints&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ppp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# convert points to pp class
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dens&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;density&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sSp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adjust&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# create density object
&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# just for interest: it's got it's of pixel image class
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] &quot;im&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# default plot for density
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/Density_plot.png&quot; alt=&quot;plot of chunk Density plot&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The density plot illustrates that there are some areas of relatively 
high density close to the centre of London. This is as we’d expect. 
Another way to represent this density information is with contours of 
equal value, similar to those used in topographic maps to simultaneously 
represent slope (the closeness of the lines) and altitude.
&lt;code class=&quot;highlighter-rouge&quot;&gt;spatstat&lt;/code&gt; enables simple plotting of countours with the sensibly named
&lt;code class=&quot;highlighter-rouge&quot;&gt;contour&lt;/code&gt; function.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;contour&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;density&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sSp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adjust&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nlevels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# plot as contours - this is where we're heading
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/Contour_plot.png&quot; alt=&quot;plot of chunk Contour plot&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the above image, it is the “islands” of high dot density that we are most 
interested in. Having successfully visualised these, the next stage is to
save them into R’s native spatial data format, before extracting the polygons.
These polygons will be used to aggregate the points.&lt;/p&gt;

&lt;h2 id=&quot;save-the-contour-lines&quot;&gt;Save the contour lines&lt;/h2&gt;

&lt;p&gt;To extract the contours, first as lines and then finally as polygons, 
we need to convert the data into two more formats: a spatial grid and 
then as a raster image. Both of these file formats are supported by the 
basic &lt;code class=&quot;highlighter-rouge&quot;&gt;sp&lt;/code&gt; package.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Dsg&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SpatialGridDataFrame&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# convert to spatial grid class
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dim&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;as.image.SpatialGridDataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dsg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# convert again to an image
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dcl&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contourLines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nlevels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# create contour object - change 8 for more/fewer levels
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SLDF&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ContourLines2SLDF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dcl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CRS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;proj4string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# convert to SpatialLinesDataFrame
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SLDF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;terrain.colors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/unnamed-chunk-1.png&quot; alt=&quot;plot of chunk unnamed-chunk-1&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;extract-the-density-polygons&quot;&gt;Extract the density polygons&lt;/h2&gt;

&lt;p&gt;Now the lines have been saved as the &lt;code class=&quot;highlighter-rouge&quot;&gt;SLDF&lt;/code&gt; object, it is 
time to convert the level we are are interested in into polygons. 
This is quite a tricky task and can involve many steps using the basic 
&lt;code class=&quot;highlighter-rouge&quot;&gt;sp&lt;/code&gt; package (see from code chunk 60 onwards &lt;a href=&quot;http://www.asdar-book.org/book2ed/cm_mod.R&quot;&gt;here&lt;/a&gt;).
Fortunately, the wonderful &lt;code class=&quot;highlighter-rouge&quot;&gt;rgeos&lt;/code&gt; provides a single line solution, with the 
intuitively named &lt;code class=&quot;highlighter-rouge&quot;&gt;gPolygonize&lt;/code&gt; function.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgeos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## rgeos version: 0.2-19, (SVN revision 394)
##  GEOS runtime version: 3.3.8-CAPI-1.7.8 
##  Polygon checking: TRUE
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Polyclust&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gPolygonize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SLDF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gas&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gArea&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Polyclust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byid&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Polyclust&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SpatialPolygonsDataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Polyclust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data.frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gas&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match.ID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Polyclust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/Polygons_representing_areas_of_high_dot_density.png&quot; alt=&quot;plot of chunk Polygons representing areas of high dot density&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;aggregate-the-points-within-high-density-zones&quot;&gt;Aggregate the points within high density zones&lt;/h2&gt;

&lt;p&gt;The next task is to aggregate the points within each high density zone.
This is done automatically with base R’s &lt;code class=&quot;highlighter-rouge&quot;&gt;aggregate&lt;/code&gt; function. Note that 
when the &lt;code class=&quot;highlighter-rouge&quot;&gt;sp&lt;/code&gt; package is installed, &lt;code class=&quot;highlighter-rouge&quot;&gt;aggregate&lt;/code&gt; behaves differently if it is provided 
with spatial data as its input, outputting spatial data with aggregate statistics for the 
specified variable (or indeed all variables). 
Now summarise the data for each of the polygons.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;cAg&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aggregate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Polyclust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FUN&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# lb &amp;lt;- gBoundary(lnd)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lwd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SLDF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;terrain.colors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cAg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;white&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;graphics&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cAg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cAg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CODE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/Aggregated_data_for_culters.png&quot; alt=&quot;plot of chunk Aggregated data for culters&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;save-points-inside-and-outside-polygons&quot;&gt;Save points inside and outside polygons&lt;/h2&gt;

&lt;p&gt;In terms of visualisation, our work here is done. 
But that is not enough for most projects: we need to export the 
results. Remember from the beginning that the aim was to reduce the 
number of points we had to deal with? Well it is in this stage
that we find out how many points we’ve removed by aggregation
and save only the points lying outside the aggregation zones.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sIn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cAg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# select the stations inside the clusters
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sOut&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;row.names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%in%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;row.names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sIn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# stations outside the clusters
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sOut&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# the more sparsely distributed points - notice the 'holes' of low density
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cAg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lwd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/Points_outside_the_clusters.png&quot; alt=&quot;plot of chunk Points outside the clusters&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The plot shows that we’ve reduced the number of points, by removing those in 
areas of high density. But how much space have saved by removing closely clustered points?&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;nrow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sIn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nrow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# proportion of points in cluster
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] 0.3406
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;gArea&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cAg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gArea&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1] 0.1178
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The results of the final commands show that we have squeezed out 1/3
of the points from only only of the area. This is not a huge saving
because the points are quite evenly distributed. For more highly clustered 
datasets, however, the savings could be vast.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;We have seen how to create polygons of high point density in R and then, 
in relatively few lines of code, we have identified and aggregated the 
points that fit into these high density zones. This has applications for 
reducing data redundancy in highly clustered datasets. But the methods 
shown here have many other applications, including:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Objective identification of zones to “target” based on point data&lt;/li&gt;
  &lt;li&gt;Visualisation of zones of interest from the point data&lt;/li&gt;
  &lt;li&gt;Provision of spatial data on which to base a stratified spatial sampling strategy&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This final application could be of interest if one is trying to identify if the 
density of certain points of pollutants (e.g. petrol stations) related to 
other variables (e.g. species diversity). By creating zones of low density
and high density, and then taking measurements from each zone type, one could 
test the hypothesis that the former has an impact on the latter.&lt;/p&gt;

&lt;p&gt;Other applications could be found for the method. The take home message is 
that R has powerful spatial capabilities that would be difficult to implement
in conventional GIS software. By usin scripts, we can ensure that the code to create the results of 
such an analysis are reproducible and can be used by others. 
To this end, all the example code and data used in this example are reproducible - 
see the vignettes folder of the “Creating-maps-in-R”
&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;GitHub repository&lt;/a&gt;.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Aggregation of point data to polygons MKII - US states</title>
   <link href="http://robinlovelace.github.com//2014/03/14/spatial-aggregation-point-data.html"/>
   <updated>2014-03-14T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/03/14/spatial-aggregation-point-data</id>
   <content type="html">&lt;p&gt;After a colleague of mine requested an illustration of the aggregation technique
that was part of an 
&lt;a href=&quot;http://robinlovelace.net/r/2014/01/30/spatial-data-with-R-tutorial.html&quot;&gt;introduction to spatial data in R&lt;/a&gt;, I decided to revisit aggregation. The first article I posted
&lt;a href=&quot;http://robinlovelace.net/r/2014/01/10/spatial-clipping-and-aggregation-in-R.html&quot;&gt;here&lt;/a&gt;
on the subject used data from London; this one is slightly different, using Twitter 
data aggregated to the state level in the USA. All example code and data can be 
downloaded from &lt;a href=&quot;https://github.com/Robinlovelace/twitter-sandy&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In short, this vignette demonstrates the geographical aggregation of 
point data to create choropleth maps made using ggplot2.&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;load-the-state-data&quot;&gt;Load the state data&lt;/h2&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgdal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## Loading required package: sp
## rgdal: version: 0.8-10, (SVN revision 478)
## Geospatial Data Abstraction Library extensions to R successfully loaded
## Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
## Path to GDAL shared files: /usr/share/gdal/1.10
## Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
## Path to PROJ.4 shared files: (autodetected)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readOGR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;states&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## OGR data source with driver: ESRI Shapefile 
## Source: &quot;.&quot;, layer: &quot;states&quot;
## with 51 features and 5 fields
## Feature type: wkbPolygon with 2 dimensions
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;summary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## Object of class SpatialPolygonsDataFrame
## Coordinates:
##       min    max
## x -178.22 -66.97
## y   18.92  71.41
## Is projected: FALSE 
## proj4string :
## [+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0]
## Data attributes:
##       STATE_NAME    DRAWSEQ       STATE_FIPS              SUB_REGION
##  Alabama   : 1   Min.   : 1.0   01     : 1   South Atlantic    : 9  
##  Alaska    : 1   1st Qu.:13.5   02     : 1   Mountain          : 8  
##  Arizona   : 1   Median :26.0   04     : 1   West North Central: 7  
##  Arkansas  : 1   Mean   :26.0   05     : 1   New England       : 6  
##  California: 1   3rd Qu.:38.5   06     : 1   East North Central: 5  
##  Colorado  : 1   Max.   :51.0   08     : 1   Pacific           : 5  
##  (Other)   :45                  (Other):45   (Other)           :11  
##    STATE_ABBR
##  AK     : 1  
##  AL     : 1  
##  AR     : 1  
##  AZ     : 1  
##  CA     : 1  
##  CO     : 1  
##  (Other):45
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spTransform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CRS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;+init=epsg:4326&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;which&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;grepl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Alask|Haw&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as.character&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;STATE_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tweets&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read.csv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1pSample.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;points&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tweets&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tweets&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;blue&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/agplot1.png&quot; alt=&quot;plot of chunk agplot1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Convert the tweets into a spatial (S4) class&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;tweets&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SpatialPointsDataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coords&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tweets&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tweets&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ncol&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tweets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;proj4string&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CRS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;+init=epsg:4326&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now lets aggregate by number of tweets.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;statesAg1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aggregate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tweets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;X&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Aggregating by average n. friends in territory:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;statesAg2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aggregate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tweets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;actor.friendsCount&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;statesAg1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;friends&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;statesAg2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;actor.friendsCount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;statesAg1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as.character&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;states&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;STATE_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;visualisation&quot;&gt;Visualisation&lt;/h2&gt;

&lt;p&gt;Preparing the data to plot with ggplot2.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dplyr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## 
## Attaching package: 'dplyr'
## 
## The following objects are masked from 'package:stats':
## 
##     filter, lag
## 
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fortify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;statesAg1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## Loading required package: rgeos
## rgeos version: 0.2-19, (SVN revision 394)
##  GEOS runtime version: 3.3.8-CAPI-1.7.8 
##  Polygon checking: TRUE
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;##     long   lat order  hole piece     group      id
## 1 -85.07 31.98     1 FALSE     1 Alabama.1 Alabama
## 2 -85.12 31.91     2 FALSE     1 Alabama.1 Alabama
## 3 -85.14 31.85     3 FALSE     1 Alabama.1 Alabama
## 4 -85.13 31.78     4 FALSE     1 Alabama.1 Alabama
## 5 -85.13 31.78     5 FALSE     1 Alabama.1 Alabama
## 6 -85.12 31.73     6 FALSE     1 Alabama.1 Alabama
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;statesAg1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;##    X friends           id
## 1  5   573.6   Washington
## 2  1     0.0      Montana
## 3  3   250.0        Maine
## 4 NA      NA North Dakota
## 5  2  1194.5 South Dakota
## 6 NA      NA      Wyoming
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inner_join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;statesAg1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;##     long   lat order  hole piece        group         id X friends
## 1 -122.4 48.23 10493 FALSE     1 Washington.1 Washington 5   573.6
## 2 -122.5 48.23 10494 FALSE     1 Washington.1 Washington 5   573.6
## 3 -122.5 48.13 10495 FALSE     1 Washington.1 Washington 5   573.6
## 4 -122.4 48.06 10496 FALSE     1 Washington.1 Washington 5   573.6
## 5 -122.5 48.13 10497 FALSE     1 Washington.1 Washington 5   573.6
## 6 -122.5 48.21 10498 FALSE     1 Washington.1 Washington 5   573.6
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Plot.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_polygon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale_fill_gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;low&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;high&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/agplot21.png&quot; alt=&quot;plot of chunk agplot2&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;friends&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_polygon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale_fill_gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;low&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;blue&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;high&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;orange&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/agplot22.png&quot; alt=&quot;plot of chunk agplot2&quot; /&gt;&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Presentation to the Geography department at the University of Girona</title>
   <link href="http://robinlovelace.github.com//2014/03/13/energy-geo-girona-presentation.html"/>
   <updated>2014-03-13T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/03/13/energy-geo-girona-presentation</id>
   <content type="html">&lt;p&gt;This is a presentation I gave to the &lt;a href=&quot;http://www.udg.edu/depgeo/Inici/tabid/13631/language/ca-ES/Default.aspx&quot;&gt;Geography Department&lt;/a&gt; 
at the University of Girona. It includes some insights into my academic research and my take on geography that I’ve never 
had the chance to put on paper. So please check it out if you are, like me, interested in Geography, energy and the future of 
humans on Earth. The slides are can be downloaded from the speaker deck website so click on the link if you want to 
download the pdf and access the links contained within. Just hitting the soundcloud button below should make the audio 
work.&lt;/p&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;a2b95a108c050131a1e6669157168c6d&quot; data-ratio=&quot;1.33333333333333&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

&lt;iframe width=&quot;30%&quot; height=&quot;50&quot; scrolling=&quot;no&quot; frameborder=&quot;no&quot; src=&quot;https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/139532776&amp;amp;auto_play=false&amp;amp;hide_related=false&amp;amp;visual=false&quot;&gt;&lt;/iframe&gt;
</content>
 </entry>
 
 <entry>
   <title>Testing web map APIs - Google vs OpenLayers vs Leaflet</title>
   <link href="http://robinlovelace.github.com//2014/03/05/webmap-test.html"/>
   <updated>2014-03-05T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/03/05/webmap-test</id>
   <content type="html">&lt;p&gt;The use of web maps has rocketed over the last decade. Back in 2005, 
Google Maps &lt;a href=&quot;http://en.wikipedia.org/wiki/Web_mapping#History_of_web_mapping&quot;&gt;was released&lt;/a&gt;, 
facilitating the use of online maps by the masses for everyday life. 
Initially, web mapping was the domain of a few large companies like 
Google, ESRI and NASA. However, with the explosion of open source 
mapping projects under the banner of &lt;a href=&quot;http://foss4g.org/&quot;&gt;FOSS4G&lt;/a&gt; (short for free open 
source software for geo-applications) and affiliated with the umbrella 
body of the Open Source Geospatial Foundation (&lt;a href=&quot;http://www.osgeo.org/&quot;&gt;OSGeo&lt;/a&gt;), 
web mapping can now be undertaken by anyone with a computer and an internet connection.&lt;/p&gt;

&lt;p&gt;Inspired by a &lt;a href=&quot;http://www.sigte.udg.edu/summerschool2014/&quot;&gt;web mapping course&lt;/a&gt; at the 
University of Girona’s &lt;a href=&quot;http://www.sigte.udg.edu/&quot;&gt;SIGTE&lt;/a&gt; service - much of which can now be done online via 
&lt;a href=&quot;http://www.unigis.es/Oferta-Formativa/Cursos-Especializacion/Programacion-Aplicaciones-Web-Map-ce&quot;&gt;UNIGIS&lt;/a&gt; -
I decided to test out three of the major options, Google Maps, 
OpenLayers and Leaflet.
Thanks to such software, it has never been easier to make and communicate a map. 
To illustrate the empowering potential of this, take a look at the 
recently implemented &lt;a href=&quot;http://www.cyclecityconnect.co.uk/participate.php&quot;&gt;City Connect&lt;/a&gt;
consultation map:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.cyclecityconnect.co.uk/participate.php&quot;&gt;&lt;img src=&quot;/figure/cconnect.png&quot; alt=&quot;City Connect consultation map&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This map is frankly amazing: it is democratic, lowering the barrier to entrance 
to spatial planning by making it accessible to anyone who has a computer and (I’ve not 
tested it) perhaps even just a smartphone. The rating of comments by other people
mitigates against abuse, and the option to show exactly where your issue lies 
enables planners to make better use of local knowledge. The map, interestingly, 
was custom built using Leaflet, the ‘new kid on the block’ in web mapping.&lt;/p&gt;

&lt;p&gt;For me this in many ways represents the ideal web map towards which 
we should strive. It is:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;user friendly&lt;/li&gt;
  &lt;li&gt;open source&lt;/li&gt;
  &lt;li&gt;useful&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With the myriad of free options available to to public, it can seem 
very hard to get involved in web mapping. That’s why the rest of this 
post provides a brief overview of three of the main options for building 
and online web map. In order of completion date, these are:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Google Maps (version 1, with basic API deployed in 2005)&lt;/li&gt;
  &lt;li&gt;OpenLayers (large JavaScript library initiated in 2005)&lt;/li&gt;
  &lt;li&gt;Leaflet (small JavaScript library initiated in 
&lt;a href=&quot;https://github.com/Leaflet/Leaflet/commit/eb5b7d706b9f439863172c522add77a0193dbda8&quot;&gt;September 2009&lt;/a&gt; 
by &lt;a href=&quot;https://github.com/mourner&quot;&gt;Vladamir Agafonkin&lt;/a&gt;)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;These are the three main &lt;a href=&quot;http://en.wikipedia.org/wiki/Client-side&quot;&gt;client side&lt;/a&gt;
web mapping tools, but there are many more. More that 44 according to 
&lt;a href=&quot;http://geotux.tuxfamily.org/index.php/es/geo-blogs/item/291-comparacion-clientes-web-v6&quot;&gt;one article dating from 2012&lt;/a&gt;!
You may also want to consider map servers such as GeoServer if you
are dealing with large applications but, for small application, an updated 
&lt;a href=&quot;http://geojson.org/&quot;&gt;.geojson file&lt;/a&gt; hosted for free can work work just fine. 
This is amazing. It means that you, me or anyone can take control of our 
geographic information and communicate it to the world how we want.&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;google-maps&quot;&gt;Google maps&lt;/h2&gt;

&lt;p&gt;Google maps is the oldest and easiest to use web mapping tool of the three. 
After you have set up a unique &lt;a href=&quot;https://developers.google.com/maps/documentation/javascript/tutorial#api_key&quot;&gt;API key&lt;/a&gt;, 
putting the below map on your site is as simple as placing the following code into the
header of you web page (see this page’s source to see what I mean):&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-{js}&quot;&gt;&amp;lt;script type=&quot;text/javascript&quot; src=&quot;http://maps.google.com/maps/api/js?key=AIzaSyAjf6ex59KmJHfkHMpevYAKjKWoSXj-FP8&amp;amp;sensor=true&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script type=&quot;text/javascript&quot;&amp;gt;
  function initialize() {
    var latlng = new google.maps.LatLng(54, -2);
    var myOptions = {
      zoom: 8,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById(&quot;map_canvas&quot;), 
myOptions);
  }
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After that, you just add a single line of html in the page’s body:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-{html}&quot;&gt;&amp;lt;div id=&quot;map_canvas&quot; style=&quot;width: 600px; height: 200px&quot;&amp;gt;&amp;lt;/div&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;

&lt;div id=&quot;map_canvas&quot; style=&quot;width: 600px; height: 200px&quot;&gt;&lt;/div&gt;

&lt;p&gt;All the variables are quite intuitive and quick to implement. Also, 
with the brute force of 
&lt;a href=&quot;http://www.wired.com/wiredenterprise/2012/10/ff-inside-google-data-center/all/&quot;&gt;Google’s vast server infrastructure&lt;/a&gt;, 
Google maps are guaranteed to load quickly. The same applies to the code base:
with some of the 
&lt;a href=&quot;http://www.forbes.com/sites/robinferracone/2013/12/19/larry-vs-larry-oracle-ceo-pay-vs-google-ceo-pay/&quot;&gt;best payed junior programmers in the world&lt;/a&gt;, 
it is unlikely that bugs in Google maps survive more than a couple of days. See below an image of Google’s relatively 
flat pay structure compared with the quite unequal one of Oracle.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://b-i.forbesimg.com/robinferracone/files/2013/12/oracle-google_updated.png&quot;&gt;&lt;img class=&quot;alignnone size-large wp-image-593&quot; alt=&quot;oracle-google_updated&quot; src=&quot;http://b-i.forbesimg.com/robinferracone/files/2014/01/oracle-google_updated-1024x716.png&quot; width=&quot;800&quot; height=&quot;500&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Google maps also has a surprising range of functionalities, although you
are pretty much restricted to Google’s way of doing things (you cannot, 
for example change the background map to be based on Open Street Map). 
This includes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Slick routing (as highlighted in 
&lt;a href=&quot;https://embed-dot-more-than-a-map.appspot.com/demos/routing/cycling&quot;&gt;this example&lt;/a&gt;): 
this is something that the other APIs struggle with.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://embed-dot-more-than-a-map.appspot.com/demos/streetview/underwater&quot;&gt;Street view&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;A wide range of &lt;a href=&quot;https://embed-dot-more-than-a-map.appspot.com/demos/visualization/flights&quot;&gt;static and dynamic visualisations&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;Integration with Google Earth.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These are useful, but for Google’s way of doing things may not be the 
way you want to do it: it lacks the flexibility of open source options, 
where literally anything can be modified (not that this is for the faint hearted).
If you want complete control over your data and like the idea 
of supporting open source mapping then one of the open source options 
may be better for you.&lt;/p&gt;

&lt;h2 id=&quot;openlayers&quot;&gt;OpenLayers&lt;/h2&gt;
&lt;p&gt;OpenLayers is the most mature open source client side web mapping 
tool on the internet and probably the most 
widely used. It is a JavaScript library, meaning it will come naturally
to anyone used to building general purpose application in that language, 
which is ubiquitous on the internet. OpenLayers has 
a very wide range of functions, and it pays the price in terms of 
size, occupying &lt;a href=&quot;http://gis.stackexchange.com/questions/33918/should-i-use-openlayers-or-leaflet&quot;&gt;almost 1 Mb&lt;/a&gt;
of digital space: not ideal for mobile applications.&lt;/p&gt;

&lt;p&gt;Partly because of this ‘bulkiness’ (less of a problem as devices become faster)
the OpenLayers developers are gearing up to release a major new version:
&lt;a href=&quot;http://ol3js.org/&quot;&gt;OpenLayers3&lt;/a&gt; which offers major improvements 
in performance with less code than OpenLayers2
(&lt;a href=&quot;http://ol3js.org/&quot;&gt;113 vs 126 thousand lines&lt;/a&gt;). For this reason 
the example below uses OpenLayers3. It is not the pretiest of maps, 
but this is not the code’s fault it is the user’s (that’s me!).
Take a look at the &lt;a href=&quot;http://ol3js.org/en/master/examples/&quot;&gt;list of examples&lt;/a&gt;
for more beautiful and advanced maps written in OpenLayers3.&lt;/p&gt;

&lt;p&gt;For the record, the below map was created with even fewer lines than the 
Google Maps example. The following code, taken from the 
&lt;a href=&quot;http://ol3js.org/en/master/doc/quickstart.html&quot;&gt;OpenLayers3 Quickstart&lt;/a&gt; goes in the html head:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-{js}&quot;&gt;&amp;lt;link rel=&quot;stylesheet&quot; href=&quot;http://ol3js.org/en/master/css/ol.css&quot; type=&quot;text/css&quot;&amp;gt;
&amp;lt;script src=&quot;http://ol3js.org/en/master/build/ol.js&quot; type=&quot;text/javascript&quot;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And then the following goes in the body:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div id=&quot;mapOL3&quot; style=&quot;width: 100%, height: 400px&quot;&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;script&amp;gt;
  new ol.Map({
    layers: [
      new ol.layer.Tile({source: new ol.source.OSM()})
    ],
    view: new ol.View2D({
      center: [0, 0],
      zoom: 2
    }),
    target: 'mapOL3'
  });
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div id=&quot;mapOL3&quot; style=&quot;width: 100%, height: 400px&quot;&gt;&lt;/div&gt;

&lt;script&gt;
  new ol.Map({
    layers: [
      new ol.layer.Tile({source: new ol.source.OSM()})
    ],
    view: new ol.View2D({
      center: [0, 0],
      zoom: 2
    }),
    target: 'mapOL3'
  });
&lt;/script&gt;

&lt;script src=&quot;ol3.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;One improvement over OpenLayers2 is that when adding an OpenLayers map, you
no longer need to initialise it in the 
&lt;code class=&quot;highlighter-rouge&quot;&gt;body&lt;/code&gt; tag, as is for the Google Maps version. 
Hence, to load the Google Map, one needs to add this to the page’s 
body: &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;body onload=&quot;initialize()&quot;&amp;gt;&lt;/code&gt;.
This is not needed for Leaflet maps either.&lt;/p&gt;

&lt;h2 id=&quot;leaflet&quot;&gt;Leaflet&lt;/h2&gt;
&lt;p&gt;Leaflet is in fashion at the moment as a fast moving, lightweight and 
relatively intuitive JavaScript library that aims to be light on 
computer and programmer resouces. It allows you to get maps up quickly.&lt;/p&gt;

&lt;p&gt;Don’t let that make you suppose that the library lacks functionality, however.
The cycle path consultation map mentioned in the introduction was built in 
Leaflet, and its functionality is ever growing, not least via a growing number 
of &lt;a href=&quot;http://mapbbcode.org/leaflet.html&quot;&gt;plugins&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This modular way of doing things intuitively makes sense to me, 
meaning that the core Leaflet developers can focus on getting the basics
as good as possible, keeping the Leaflet.js library small enough to 
load rapidly on a mobile device. This is why Leaflet is probably the 
API of choice for open source mobile application developers and why 
it is used by GitHub, a central hub in the open source software movement.&lt;/p&gt;

&lt;p&gt;Interestingly, Leaflet does not require initialisation in the body.
It still requires a couple of scripts, shown below, in the head.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;link rel=&quot;stylesheet&quot; href=&quot;http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css&quot; /&amp;gt;
&amp;lt;script src=&quot;http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;For the main map description, instead asking for the script to be added in the html,
Leaflet asks for it to be called &lt;em&gt;after&lt;/em&gt; the 
map object is called, like so:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-{js}&quot;&gt;&amp;lt;div id=&quot;map&quot; style=&quot;width: 600px; height: 400px&quot;&amp;gt;&amp;lt;/div&amp;gt;
 
&amp;lt;script&amp;gt;
		var map = L.map('map').setView([51.505, -0.09], 13);

		L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data &amp;amp;copy; &amp;lt;a href=&quot;http://openstreetmap.org&quot;&amp;gt;OpenStreetMap&amp;lt;/a&amp;gt; contributors, &amp;lt;a href=&quot;http://creativecommons.org/licenses/by-sa/2.0/&quot;&amp;gt;CC-BY-SA&amp;lt;/a&amp;gt;, Imagery Â© &amp;lt;a href=&quot;http://cloudmade.com&quot;&amp;gt;CloudMade&amp;lt;/a&amp;gt;'
		}).addTo(map);
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;div id=&quot;map&quot; style=&quot;width: 600px; height: 400px&quot;&gt;&lt;/div&gt;

&lt;script&gt;

		var map = L.map('map').setView([51.505, -0.09], 13);

		L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data &amp;copy; &lt;a href=&quot;http://openstreetmap.org&quot;&gt;OpenStreetMap&lt;/a&gt; contributors, &lt;a href=&quot;http://creativecommons.org/licenses/by-sa/2.0/&quot;&gt;CC-BY-SA&lt;/a&gt;, Imagery Â© &lt;a href=&quot;http://cloudmade.com&quot;&gt;CloudMade&lt;/a&gt;'
		}).addTo(map);
		
				L.marker([51.5, -0.09]).addTo(map)
			.bindPopup(&quot;&lt;b&gt;Hello world!&lt;/b&gt;&lt;br /&gt;I am a popup.&quot;).openPopup();

		L.circle([51.508, -0.11], 500, {
			color: 'red',
			fillColor: '#f03',
			fillOpacity: 0.5
		}).addTo(map).bindPopup(&quot;I am a circle.&quot;);

		L.polygon([
			[51.509, -0.08],
			[51.503, -0.06],
			[51.51, -0.047]
		]).addTo(map).bindPopup(&quot;I am a polygon.&quot;);


		var popup = L.popup();

		function onMapClick(e) {
			popup
				.setLatLng(e.latlng)
				.setContent(&quot;You clicked the map at &quot; + e.latlng.toString())
				.openOn(map);
		}

		map.on('click', onMapClick);

&lt;/script&gt;

&lt;p&gt;In fact the actual code used for the above map has a few more lines 
of code, to add the point, the blog and the triangle. 
But the snippet shown still works as a stand-alone map. 
The example can be found &lt;a href=&quot;http://leafletjs.com/examples/quick-start.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;We have seen three common ways to build maps into html pages and 
these offer amazing opportunities for displaying our geographical data
in new ways. The example of cycle path planning shows the potential for 
democratic empowerment that such technologies offer. However, 
for such potential to be realised, and not just gobbled by massive 
corporations like Google, we need diversity.
The importance of this for our online future is well described in an 
&lt;a href=&quot;http://www.theguardian.com/technology/2014/jan/14/why-the-world-needs-openstreetmap&quot;&gt;article by Serge Wroclawski&lt;/a&gt;.
Google, for example, 
can easily insert adverts into its maps without us knowing. 
Leaflet and OpenLayers, being open source, cannot. 
That said, if your aim is just to get attractive ‘off the shelf’ maps
up quickly, Google Maps is a good option.&lt;/p&gt;

&lt;p&gt;OpenLayers is mature and big and works well with servers.
Leaflet, as the new kid on the block is the most exciting for me and 
encapsulates many of the benefits of open source software in general:
speed of development, flexibility, efficiency. All three can probably 
do 80% of the web mapping applications that are commonly required so the 
choice should, in many cases, depend more on what you enjoy than on what it can 
and can’t do. Lightness considered, for me that would mean Leaflet for 
many applications, but watch this space for the final version of 
OpenLayers3 (due very soon) and perhaps even better web mapping options.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Joining the Bumblebee Conservation Trust</title>
   <link href="http://robinlovelace.github.com//2014/02/25/the-bumblebee-conservation-trust.html"/>
   <updated>2014-02-25T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/02/25/the-bumblebee-conservation-trust</id>
   <content type="html">&lt;p&gt;Bumblebees are not something that grab the attention. 
Unless you are unlucky enough to be stung by one, they
are pretty unimposing creatures. They always just seem to
be getting on with their own business buzzing briefly around 
and then buzzing off again. Perhaps that’s where the phrases 
“busy as a bee” and “buzz off” come from. I was interested in bumblebees
as a child but only during fleeting moments when they flew into view and 
then enigmatically flew off into the distance again, always impossible to follow.&lt;/p&gt;

&lt;p&gt;My interest in bumblebees has been reawakened by a 
book I was given for Christmas. &lt;a href=&quot;http://www.sussex.ac.uk/lifesci/goulsonlab/astinginthetale&quot;&gt;A Sting in the Tail&lt;/a&gt;
 by Dave Goulson is
is a non-fiction “public engagement in science” type book, that one would naturally assume to be 
quite boring. But after the first few pages, I was hooked. The narrative progresses steadily not just
through the life and plight of these creatures, but also the story of their author, probably
the foremost bumblebee expert worldwide. Deliberately avoiding the stuffy and rigid language of 
scientific articles, Goulson describes his work in crystal clear language that is accessible to all.
Perhaps because of this straightforward style his book is &lt;a href=&quot;http://www.amazon.co.uk/A-Sting-Tale-Dave-Goulson/dp/0224096893&quot;&gt;wildly popular&lt;/a&gt; (for a natural history 
book at least!), with over 60 enthusiastic 5 star review on Amazon. It seems there is a demand
for unpretentious writing about the natural world.&lt;/p&gt;

&lt;p&gt;This post is not about the book per se, which for the record is excellent and highly recommended
to anyone interested in nature. Instead it’s about how it persuaded me to sign up to the 
charity that Professor Goulson set up shortly before writing the book: the Bumblebee Conservation
Trust (&lt;a href=&quot;http://bumblebeeconservation.org/&quot;&gt;BBCT&lt;/a&gt;).&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;Towards the end of the book Goulson has this to say:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Conservation is not something that should be left to others. 
It is easy to get depressed and despondent at the impending extinctions
of the polar bear or the tiger, or at the horrific progress of 
deforestation in the tropics. Perhaps governments or scientists or 
organisations such as &lt;a href=&quot;http://wwwf.org&quot;&gt;WWF&lt;/a&gt; can do something to help address 
these situations, but as an individual it is very hard to know where to start -
it is all so remote and dauntingly complex.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Yes! I thought. So much of the environmental movement simply feels dis-empowering.
Great forces completely beyond your control wreak havoc on biodiversity, the soil and 
the climate. Other than talking about it, bemoaning the dire situation of the world,
paying a monthly subscription to some giant environmental charity and perhaps voting once 
every four years for politicians who promise perennially to be ‘green’, there is essentially 
jack shit than anyone can do about it. Environmentalism, at times, is a depressing subject.&lt;/p&gt;

&lt;p&gt;Perhaps having subconsciously arrived at this conclusion myself, I developed the philosophy that
“sustainability begins at home”. By this I meant that to have a tangible impact on the world, 
you must start with your immediate sphere of influence: your own life, your family, your friends, your job. 
When you see changes in these people, or in the conditions of your garden or local park, it can be empowering.
This is precisely the point that Goulson seems to be making in the above quote, but he does so
far more neatly and clearly than I’ve seen before. What’s great about it is that it’s written by 
someone who has gone out of their way to empower people to protect the natural, as described in 
the subsequent sentences:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;In contrast [to the top down view of conservation], conserving bumblebees is something anyone can do. 
A single lavender bush on a patio will attract and feed bumblebees even in the heart of a city. Anyone
with a garden can help enormously - plant some comfrey, viper’s bugloss, foxgloves, chives, aquilegia and so on, and you 
will see the results almost immediately. If you are lucky enough to be a farmer, or a planner in the local council, 
you can make a world of difference. This is not just about bumblebees, but about creating a future environment for our children
to enjoy, where there are still flowers, bees, butterflies and birds, and healthy crops to eat.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;With that I was convinced. Goulson’s work on bumblebees goes far beyond concern for a few species. 
It’s a new approach to environmentalism, one that is exciting, fun and hands-on. This is something
I aspire to so clearly had to sign-up to the charity. I wait eagerly for the pack of bumblebee friendly seeds
and identification guide to pop through the door.&lt;/p&gt;

&lt;p&gt;The book ends on a positive note by pondering: perhaps if we can save a single bee, as is
clearly demonstrated in the book, we can save the world.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>STATS19 data on cyclist accidents</title>
   <link href="http://robinlovelace.github.com//2014/02/24/stats-19-data.html"/>
   <updated>2014-02-24T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/02/24/stats-19-data</id>
   <content type="html">&lt;p&gt;This is just a short post about the “STATS19” open dataset on where road accidents logged by the police happen. There are many great things about this dataset (apart from it being about injury and death), my favorite being&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;it’s been made open to the public, enabling some interesting DIY analyses and visualisations such as &lt;a href=&quot;http://www.cyclestreets.net/collisions/&quot;&gt;this one&lt;/a&gt; by CycleStreet.net and&lt;/li&gt;
  &lt;li&gt;every accident is geo-referenced quite accurately, allowing geographers like me to make maps of it and try to understand the causes and effects of this risk.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The reason I’m getting excited about this project right now is that I’ve just started work on a new project with Dr Ian Kellar that seeks to harness it. 
So I’ve imported it into my favourite stats program R and made some preliminary visualisations including this little map of accident locations in a small area between Leeds and Bradford:&lt;/p&gt;

&lt;iframe frameborder=&quot;0&quot; width=&quot;100%&quot; height=&quot;300&quot; src=&quot;http://bl.ocks.org/d/c48515e298a99fd178c5&quot;&gt;&lt;/iframe&gt;

&lt;!--more--&gt;

&lt;p&gt;There’s also this, which provides an indication that accidents involving cyclists are most likely to happen at slightly different times than other types of accidents.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/Robinlovelace/bikeR/blob/master/figures/cyclist-timings.png?raw=true%20=400x400&quot; alt=&quot;Accident times&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Both these mini visualisations have made me keen to investigate this data resource further, so &lt;a href=&quot;https://github.com/Robinlovelace/bikeR&quot;&gt;watch this space&lt;/a&gt; on the project’s page on GitHub. If you are really keen, feel free to fork it and do your own research: I’m intending to do it all with open source tools so the results should be accessible to anyone. Enjoy!&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Finding and replacing character strings in multiple files with the Linux command line</title>
   <link href="http://robinlovelace.github.com//2014/02/18/find-replace-linux.html"/>
   <updated>2014-02-18T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/02/18/find-replace-linux</id>
   <content type="html">&lt;p&gt;According to William Shotts (&lt;a href=&quot;http://linuxcommand.org/tlcl.php&quot;&gt;2013&lt;/a&gt;), “the only way to really get anything done on a computer
is by typing on a keyboard!” This is quite a controversial statement now that much of human-computer
interaction is done by pointing and clicking around a screen with a mouse or thumbs on increasingly
ubiquitous touchscreen devices. What the author of this statement is getting at is that if you want to 
harness the full &lt;em&gt;power&lt;/em&gt; of computers, meaning automating tasks in an intelligent way to process
information in a way that you want, nothing beats a keyboard input.&lt;/p&gt;

&lt;p&gt;The reasoning behind this is simple: on a keyboard dozens of different characters are only ever a 
few millimetres away from one of your 10 fingers and thumbs, meaning a huge amount of information 
can be sent to the computer in a very short amount of time. Pointing and clicking your way around 
the screen, by contrast, takes longer.&lt;/p&gt;

&lt;p&gt;A good example of this is when you want to find all files containing certain words in a certain place 
and replace the matching words with something else. This may sound abstract and that’s because it is.
The awesome thing about the Linux command line is that you can do all of these things, making hundreds 
of changes to a project, with just a single line of compact code, as we will see below.&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;To be more specific, the problem I was facing was needing to replace most instances 
of &lt;code class=&quot;highlighter-rouge&quot;&gt;x = y&lt;/code&gt;, where x and y can be any text, with &lt;code class=&quot;highlighter-rouge&quot;&gt;x &amp;lt;- y&lt;/code&gt; across many files in my project. 
The reason was that I’d been making a consistent mistake, and wanted to correct it in a 
consistent way, in a minimum of time. Now, how would you go about doing this in Windows?
You would probably search on the internet and download some fairly clunky piece of software 
like &lt;a href=&quot;http://www.powergrep.com/&quot;&gt;powergrep&lt;/a&gt;, a search and replace tool for “Windows 2000, XP, Vista, 7, 8, and 8.1”
users for &lt;strong&gt;“Only 119 euro”&lt;/strong&gt; (emphasis mine).&lt;/p&gt;

&lt;p&gt;To most Linux users this product is simply hilarious, as all of the tools needed to do this 
“powergrepping” are available from the most basic of Linux terminals, accessible by pressing 
&lt;code class=&quot;highlighter-rouge&quot;&gt;ctl-t&lt;/code&gt; or just searching for the terminal. How? Well let me show you how I performed the 
task and explain it after. The single line to solve the problem described above was as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-{bash}&quot;&gt;find . -name &quot;*.R&quot; -exec sed -i &quot;s/ = / &amp;lt;- /g&quot; '{}' \;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Most likely the above line of letters and symbols looks like a foreign language
unless you are used to typing at the command line. That’s because it is!
Learning a programming language is probably best seen in the same way as learning 
French, Spanish, or (more appropriately due to its limited similarity to English)
Chinese. So lets go through it line by line to see what has just happened.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;First we use the command line tool &lt;code class=&quot;highlighter-rouge&quot;&gt;find&lt;/code&gt; to only process the files we are 
interested in. The little &lt;code class=&quot;highlighter-rouge&quot;&gt;.&lt;/code&gt; symbol means “anything within working directory” 
and could have been set to any folder on your computer (e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;~/Desktop/&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;The second part of the &lt;code class=&quot;highlighter-rouge&quot;&gt;find&lt;/code&gt; command is &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;*.R&quot;&lt;/code&gt;, which specifies the rest of 
the line to only deal with files ending in &lt;code class=&quot;highlighter-rouge&quot;&gt;.R&lt;/code&gt;: in other words R scripts.&lt;/li&gt;
  &lt;li&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;-exec&lt;/code&gt; tag is where the magic happens. Used &lt;a href=&quot;http://www.softpanorama.org/Tools/Find/using_exec_option_and_xargs_in_find.shtml&quot;&gt;in combination with &lt;code class=&quot;highlighter-rouge&quot;&gt;find&lt;/code&gt;&lt;/a&gt;,
&lt;code class=&quot;highlighter-rouge&quot;&gt;-exec&lt;/code&gt; sends executes the subsequent command for each file that is found.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sed&lt;/code&gt; is a powerhouse of regular expressions, and stands for “stream editor”, processing 
the flow of text as it is passed through the &lt;a href=&quot;http://www.grymoire.com/Unix/Sed.html&quot;&gt;computer&lt;/a&gt;. All the remaining text specifies how &lt;code class=&quot;highlighter-rouge&quot;&gt;sed&lt;/code&gt; acts on the files.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-i&lt;/code&gt; is short for “in place” and means simply that for each file found, make the changes to the file and overwrite the existing one.&lt;/li&gt;
  &lt;li&gt;`”s/ = / &amp;lt;- /g” is the actual search and replace bit. It means, in English, “take all instances of “ = “ and replace it with “ &amp;lt;- “”.&lt;/li&gt;
  &lt;li&gt;Finally we wrap up the code, telling the Linux terminal “we’ve finished now” or something similar with the ‘words’ &lt;code class=&quot;highlighter-rouge&quot;&gt;'{}' \;&lt;/code&gt;. It is 
probably best not to dwell too much on the precise meanings of the syntax. As with French, simply chatting the language informally can 
be a much better way to learn the lingo than fretting over grammar.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Most people will never bother to learn the intricacies of commands such as that presented above. 
This is a pity, as there is a huge amount of power, fun and useful application waiting behind the 
intimidating cursor of the command line. But I’d urge you to give such tasks a go as it can be 
extrememly rewarding to get such a huge amount of work done with such little code.
If nothing else, the process of learning should be fun and rewarding in itself, in a way that 
the developers of Angry Birds can only dream of.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Sheffield to Manchester cycle</title>
   <link href="http://robinlovelace.github.com//2014/02/14/manchester-sheffield-ride.html"/>
   <updated>2014-02-14T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/02/14/manchester-sheffield-ride</id>
   <content type="html">&lt;p&gt;I arrived in Manchester around 2pm, having set-off from Sheffield at 9am and 
cycled all the way. 
This may sound like a &lt;a href=&quot;http://en.wikipedia.org/wiki/Sadomasochism&quot;&gt;masochistic&lt;/a&gt; 
mid-February activity. But I can only report good vibes: a subtle rush of 
&lt;a href=&quot;http://en.wikipedia.org/wiki/Endorphins&quot;&gt;endorphins&lt;/a&gt; released from pushing the 
body and the satisfaction of knowing I got here with my own energies alone, 
rather than depending on &lt;a href=&quot;http://techalive.mtu.edu/meec/module19/Page4.htm&quot;&gt;ancient sunlight&lt;/a&gt;
stored in fossil fuels and imported from afar.&lt;/p&gt;

&lt;p&gt;The route I took was fast, fun and felt safe yet exciting. 
Having done the trip a few times before,
and feeling sure that this was the best route 
I’ve taken so far, I’m going to share
it with the world. The actual route I took was recorded by the 
GPS on my smartphone (which I uploaded to &lt;a href=&quot;http://gpsies.com/&quot;&gt;GPSies&lt;/a&gt;), 
enabling it to be stored for posterity and downloaded by others for 
future reference. I wouldn’t say this is the &lt;em&gt;best&lt;/em&gt; possible 
route from Sheffield to Manchester, but I would certainly recommend it to most 
cyclists, for reasons outlined below.&lt;/p&gt;

&lt;iframe src=&quot;http://www.gpsies.com/mapOnly.do?fileId=xaczqjszydrvitus&quot; width=&quot;600&quot; height=&quot;400&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot; marginheight=&quot;0&quot; marginwidth=&quot;0&quot;&gt;&lt;/iframe&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;deciding-the-route-in-advance&quot;&gt;Deciding the route in advance&lt;/h2&gt;

&lt;p&gt;To be honest, I didn’t put a lot of thought into planning the route 
in advance. Simply typing “Sheffield” and “Manchester” into the 
from and to fields in the open source bicycle route planner
&lt;a href=&quot;http://www.cyclestreets.net/&quot;&gt;CycleStreets.net&lt;/a&gt; yields 3 options, 
the fastest of which looked reasonable to me. Each of these can 
be seen on the &lt;a href=&quot;http://www.cyclestreets.net/journey/39363548/&quot;&gt;route’s own web page&lt;/a&gt;, automatically generated and 
stored for posterity.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://dl.dropboxusercontent.com/u/15008199/Images-2-share/shef2manc.png&quot; alt=&quot;Route options from CycleStreets.net&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As you’ll see from the &lt;a href=&quot;http://www.cyclestreets.net/journey/39363548/&quot;&gt;route’s page&lt;/a&gt;, 
CycleStreets.net very handily provides turn-by-turn breakdown of the trip, including 
&lt;a href=&quot;http://www.cyclestreets.net/location/33925/&quot;&gt;links to photos uploaded to the internet by enthusiasts&lt;/a&gt; and sub-maps of key parts of the route, such as the one 
displayed below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://www.cyclestreets.net/journey/39363548/maplet39363548fastest44075for4398.png&quot; alt=&quot;key route part&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I did also try planning the route using 
&lt;a href=&quot;https://maps.google.com/maps?saddr=Sheffield,+United+Kingdom&amp;amp;daddr=Manchester,+United+Kingdom&amp;amp;hl=en&amp;amp;ll=53.466796,-1.841583&amp;amp;spn=0.409566,0.883026&amp;amp;sll=53.426314,-1.86006&amp;amp;sspn=0.409953,0.883026&amp;amp;geocode=FQmILgMde5Hp_ykVvuj6qQp5SDF4sAav9ScoPg%3BFZwHMAMd27Dd_ynb9SZSTE16SDGqa_4EOBS-2Q&amp;amp;oq=man&amp;amp;dirflg=b&amp;amp;mra=ltm&amp;amp;t=m&amp;amp;z=10&amp;amp;lci=bike&quot;&gt;Google’s bicycle route planning option&lt;/a&gt;
and was heartened to see that, after forcing the route onto the exciting 
&lt;a href=&quot;http://en.wikipedia.org/wiki/Snake_Pass&quot;&gt;Snake Pass&lt;/a&gt; the 
&lt;a href=&quot;http://goo.gl/maps/2uwXz&quot;&gt;result&lt;/a&gt; was similar to the CycleStreets option:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/shef2mancg.png&quot; alt=&quot;google fast route&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Basically, I was happy with the distance (~40 miles), time estimated by CycleStreets (4 1/2 hours) and Google (4 1/4 hours) and was confident that I could get onto the Snake Pass without 
need for navigation. Owning a smartphone, I decided to play it by ear and wait for instructions
from CycleStreets.net or Google on how to navigate myself to Manchester city centre once in Glossop. 
As explained below, I was pleasantly surprised.&lt;/p&gt;

&lt;h2 id=&quot;the-ride-itself&quot;&gt;The ride itself&lt;/h2&gt;

&lt;p&gt;The ride itself was fun, fast and felt safe. My friend Woody
accompanied me to &lt;a href=&quot;http://en.wikipedia.org/wiki/Ladybower_Reservoir&quot;&gt;Ladybower resevoir&lt;/a&gt;, after which point I was on my own. 
Riding up to the summit of the Pennine Pass (1600 ft, a climb of 1300 ft from the 
starting height of 300 ft in Sheffield) was a mission, but not arduous on my
road bike, lightly loaded with a single pannier and a rucksack.&lt;/p&gt;

&lt;p&gt;Before I knew it I was on the fast descent into Glossop. This made the trip worth it on 
its own, as the Snake Pass is ultra smooth and has pleasant curves around beautiful 
scenery. Having never been into Glossop centre, I stopped for a cup of tea and relax there.&lt;/p&gt;

&lt;p&gt;It was raining when I left, recharged after a brew. The route planning was also more 
complicated from this point onwards, unless you are &lt;em&gt;really&lt;/em&gt; in a rush in which 
case you would just continue on the A57. At this point I got my smartphone out.&lt;/p&gt;

&lt;p&gt;Initially CycleStreets “live ride” journey planner was my first choice, but it crashed a 
couple of times at which point I switched to Google Maps’ navigation app. 
I wore earphones, allowing the soothing lady’s voice to tell me “turn left onto Mottram Road in 1000 ft” and other clear instructions. Obediently I followed.&lt;/p&gt;

&lt;p&gt;The great thing about following route planners like 
this is that you can appear on completely unexpected paths. This happened spectacularly for me, as I was guided onto 
a canal path which is hidden from the road. This took me 5 miles all the way to my destination.&lt;/p&gt;

&lt;p&gt;To re-trace this track - which I wholy recommend - you can download the GPS trace from 
&lt;a href=&quot;http://www.openstreetmap.org/user/RobinLovelace/traces/1655684&quot;&gt;here, on Open Street Map&lt;/a&gt;. Of course there are other route options, but I’d say that this one combines the a great combination of speed, fun and canal towpaths!&lt;/p&gt;

&lt;h2 id=&quot;alternative-routes-and-final-reflections&quot;&gt;Alternative routes and final reflections&lt;/h2&gt;

&lt;p&gt;I am 
by no means the first to attempt the journey, and many alternative routes are available online.
&lt;a href=&quot;http://www.cyclesheffield.org.uk/&quot;&gt;Cycle Sheffield&lt;/a&gt;, for example, offers a 
&lt;a href=&quot;http://www.cyclesheffield.org.uk/route-planning/long-distance-routes/sheffield-to-manchester/&quot;&gt;detailed description&lt;/a&gt;
of a 
largely rural route (see map below).&lt;/p&gt;

&lt;iframe src=&quot;http://maps.google.com/maps/ms?msa=0&amp;amp;msid=204112132629730101627.0004a38bf89ff2c48e1cb&amp;amp;ie=UTF8&amp;amp;t=h&amp;amp;ll=53.390534,-1.793089&amp;amp;spn=0.112659,0.661068&amp;amp;output=embed&quot; height=&quot;350&quot; width=&quot;425&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;This route avoids the busier Snake and Woodhead passes. The former 
because it is described as “narrow and has fast traffic”, the latter being “a highly undesirable place to be for a cyclist”. 
Having ridden both routes, I would say that both descriptions are a little exagerated: yes cars tend to 
whizz over the snake pass and yes there is a high proportion of trucks in the traffic in the flow over Woodhead. 
But neither felt inherently dangerous at any time: in some ways the long expanses of road space felt safer
per kilometre than urban traffic, which is far less predictable (due to cars pulling out, traffic lights, left
and right turns and other urban phonomena). Wynnat’s pass is probably the least busy option, but still requires
busy roads to get there quickly and is slightly longer than the swooping Snake Pass.&lt;/p&gt;

&lt;p&gt;An even more rural route is the &lt;a href=&quot;http://www.gps-routes.co.uk/routes/home.nsf/RoutesLinksCycle/trans-pennine-trail-walking-and-cycle-route&quot;&gt;trans pennine trail&lt;/a&gt;, a completely off-road trail of which Sheffield-Manchester is 
only a part: it runs from coast to coast. Again, this route is ideal for leisure purposes, but 
will be much slower than the road option I took.&lt;/p&gt;

&lt;p&gt;All in all it was a great ride, even given the rain. I would fully recommend inter-city cycling to anyone - just take a day out and go for it - and with smartphones and
the recent emergence fantastic
bicycle-specific online route planners, planning and executing the journey is easier than ever before.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>R for spatial analysis tutorial + video</title>
   <link href="http://robinlovelace.github.com//2014/01/30/spatial-data-with-R-tutorial.html"/>
   <updated>2014-01-30T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/01/30/spatial-data-with-R-tutorial</id>
   <content type="html">&lt;p&gt;On 24th January 2014 I ran a one day practical course on an “Introduction to Spatial Data Visualisation in R”
at the University of Leeds, 
with the help of demonstrators &lt;a href=&quot;http://www.geog.leeds.ac.uk/people/r.oldroyd&quot;&gt;Rachel Oldroyd&lt;/a&gt; and 
&lt;a href=&quot;http://www.ucl.ac.uk/secret/current_students/2012_cohort/2012-cohort-profiles/alistair-leak&quot;&gt;Alistair Leak&lt;/a&gt;, who
came up from London for the event. The course is designed for people completely new to R, who
are especially interested in its spatial functionalities, and is based on a tutorial
developed by  &lt;a href=&quot;http://spatial.ly/&quot;&gt;James Cheshire&lt;/a&gt; and myself. We decided to make a
pdf version of the tutorial available 
for free online, and the latest version (which should continue to evolve) can be downloaded 
&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/raw/master/intro-spatial-rl.pdf&quot;&gt;here&lt;/a&gt;, 
from the projects &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;GitHub repository&lt;/a&gt;.
 For the benefit of people who could not attend in person, 
the introductory talk by myself was filmed - as shown in the video below.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;//www.youtube.com/embed/aiGWBjIUWjw?list=PLyWcOvaDtih3hTukFkGUpaagNVQO_eDDd&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;!--more--&gt;

&lt;p&gt;All in all the course went very well. Most people seemed to think the level 
and pace of the tutorial was about right, and there was much flexibility to 
work at one’s own pace. Attendees were encouraged to ask questions focussing on how
R could best be used in their own research, and lots of face-to-face learning went on.
This is something that simply cannot be replaced by distance learning, no matter how good 
the teaching materials are.&lt;/p&gt;

&lt;p&gt;The great thing about this project is that it lives on. Rather than being a ‘finished’ document, 
the tutorial is designed to be continually updated, based on comments from the users.
Also, it is possible for anyone with a GitHub account to edit the document directly, 
by simply hitting the ‘Edit’ button when looking at the &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/blob/master/intro-spatial.Rmd&quot;&gt;master .Rmd document&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Updates that we will include for next time, based on feedback from the 24th are clearer explanation of tricky
concepts such as subsetting with square brackets and an explanation of the input data. If you like the sound 
of this course, the good news is that there will be more of the same, with an Introduction to Spatial Microsimulation
course &lt;a href=&quot;http://store.leeds.ac.uk/browse/extra_info.asp?compid=1&amp;amp;modid=2&amp;amp;catid=47&amp;amp;prodid=388&quot;&gt;available to sign-up to&lt;/a&gt; on 8th - 9th May.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>A summary of the current UK government</title>
   <link href="http://robinlovelace.github.com//2014/01/28/tory-government.html"/>
   <updated>2014-01-28T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/01/28/tory-government</id>
   <content type="html">&lt;p&gt;Amidst the clamour of onrunning news stories and various 
‘crises’ affecting different parts of the economy and society,
it’s 
hard to step back and take stock of the kind of people who are in power. 
“What kind of government is this?” is a difficult question to answer: 
“Not sure what you call this strange mutant of a Government, words fail”
I was recently told. Well, in response to this failure I am happy to say 
that I have found a neat summary of the current government in the form 
of a cartoon and a comment on it. Both can be found &lt;a href=&quot;http://www.theguardian.com/commentisfree/cartoon/2014/jan/27/flooding-defence-cuts-steve-bell&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2014/1/27/1390860385428/Steve-Bell-28.1.2014-001.jpg&quot; alt=&quot;bell-gov&quot; /&gt;.&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;From the party that brings you abject lies dressed as obvious and self-evident truths - “We’re all in this together”, “the NHS is safe in our hands”, and “labour-caused deficit (no mention of global banking collapse and Thatcher-loving idiot-Brown/Darling’s foolish attempt to re-capitalise and re-finance every single failed bank with “our money” that hadn’t been earned and paid as tax yet) - comes the most obvious proof of living in Cloud-Cuckoo Land that any government can provide: Denying the laws of physics and meteorology for ideological reasons.&lt;/p&gt;

&lt;p&gt;You need no flood defences; global warning is a lefty-lie - “Look - a Rumanian benefit-tourist squirrel - Vote Conservative!&lt;/p&gt;

&lt;p&gt;The only ‘reality’ they admit is that which sits comfortably with their bigotries, their economic ineptitude and their intellectually-limited world view.&lt;/p&gt;

&lt;p&gt;Can you imagine the relief at Conservative HQ when they realised that Dean Burnett, the UKIP councillor who proposes that storms and flooding are caused by the UK allowing same-gender marriages, had actually left the Tory party and joined UKIP? Phew, nearly lost a few million votes there…..&lt;/p&gt;

&lt;p&gt;This is the same government, remember, that plunged the fragile post-banking-crisis economy into three years of economic flatlining (do ed balls’s hand gesture now), reduced the size of the economy by over 3%, forced the nation’s (“hard”) working people into 46 months (so far) of decreasing buying-power, reduced the size of the state by £20billion, privatised over a third of the NHS, introduced the bedroom tax and caused the need for that fine charity (founded by a heroic Labour Party member and supported by many righteous Churchmen) to establish over 500 Food Banks (Thank you Trussell Trust).&lt;/p&gt;

&lt;blockquote&gt;
  &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;No attempt at ethical or social seduction can eradicate from my heart a deep burning hatred for the Tory Party. So far as I am concerned they are lower than vermin.&quot; - Aneurin Bevan on the inauguration of his great legacy, the NHS - 7 July, 1948.
&lt;/code&gt;&lt;/pre&gt;
  &lt;/div&gt;
&lt;/blockquote&gt;

</content>
 </entry>
 
 <entry>
   <title>The Future Is Not What It Used To Be - Book review</title>
   <link href="http://robinlovelace.github.com//2014/01/28/future-not-book-review.html"/>
   <updated>2014-01-28T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/01/28/future-not-book-review</id>
   <content type="html">&lt;p&gt;This is a review I was invited to write for &lt;a href=&quot;http://www.erica.demon.co.uk/EV.html&quot;&gt;Environmental Values&lt;/a&gt;,
a journal for academics to publish their musings on the state of the
environment and what is to be done about it. I found the book good, but was
perhaps overly gushing in &lt;a href=&quot;http://www.erica.demon.co.uk/EV/reviews/76_Friedrichs.pdf&quot;&gt;my review&lt;/a&gt;
on their website in hindsight. Why? Well since my review there have been
another couple of assessments from respected sources that are mixed to
say the least. Sarah Lester, writing for the
&lt;a href=&quot;http://blogs.lse.ac.uk/lsereviewofbooks/2013/12/20/book-review-the-future-is-not-what-it-used-to-be/&quot;&gt;LSE’s blog&lt;/a&gt;
points out that when things get bad,
the logical reaction is not to ponder things and have an existential crisis
but to ACT. The second review, in the
&lt;a href=&quot;http://www.timeshighereducation.co.uk/books/the-future-is-not-what-it-used-to-be-climate-change-and-energy-scarcity-by-jrg-friedrichs/2007555.article&quot;&gt;Times Higher Education&lt;/a&gt;
acknowledges the reasoning behind Friedrichs’ pessimism but statest that
it’s simply not too late to give up. I take both points but would only add
that the book also has something important to offer optimists: a sober
reality check about the severity of the situation we’re in and a motivation
to make our actions more intelligently. All in all, I still stand by
everything I said in the original review, found below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://www.ox.ac.uk/images/maincolumn/17660_Joerg_Friedrichs_book.jpg&quot; alt=&quot;fnot-book&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;my-take-on-it&quot;&gt;My take on it&lt;/h2&gt;

&lt;p&gt;The scope of the book is not only to explore the intertwined problems of climate change and peak oil, but also to assess the chances of an effective response. It becomes clear in the first few pages that The Future is a unique contribution. Many authors have written about the scale of the problem and bemoaned the lack of action; fewer have adequately explained inaction, or honestly appraised the likely impacts of collective failure. In a refreshingly stark and honest beginning to the book, Friedrichs sets out his aim, to “explain our inability to adequately grasp and confront our predicament” (p. viii). This review assesses the work on two levels: firstly it is assessed in its own terms - how well does it meet its aim? Secondly, I offer a more general assessment of the book’s worth, from the perspective of an optimistic environmental geographer eager for a ‘post-carbon’ future.&lt;/p&gt;

&lt;p&gt;Few would question the importance of the former criterion: tackling the root causes of the ‘Long Emergency’ of global industrial society is a challenge to which we must rise to create a liveable future (Kunstler 2006). The long-running debate will undoubtedly benefit from new perspectives and fresh assessments of the evidence. A more challenging question to ask of any book facing up to such grim realities yet targeted squarely at the ‘lay’ public is whether it can actually be fun and accessible, whilst maintaining its rigour and commitment to the evidence. Impatient readers will be pleased to learn that the blunt answer is a decisive ‘yes’. The more subtle answer, of course, depends largely on the reader. It is therefore worth taking a quick detour to consider the type of person who might be interested such an ominous title.&lt;/p&gt;

&lt;p&gt;A small but committed group of people find books about the ‘big picture’ to be addictive. One could be forgiven for thinking that such people are are narcissistic pessimists, flicking through each page alone at night, delighting in the Earth’s sorry state and egging-on its gradual demise. Humans are by nature optimistic beasts, so taking the world’s broad burdens onto our slender shoulders can seem to go against the grain. This is arguably especially so now that there is so much information about future threats: past apocalyptics had it comparatively easy, relying on magical interpretations of ancient texts and gut feeling. Now confronted with a vast and complex body of peer-reviewed literature from many fields suggesting that things are not going so well at the system level, the continued popularity of more leisurely exploits, such as golf or consumerism is understandable.&lt;/p&gt;

&lt;p&gt;On the other hand, others enjoy the challenge of confronting reality head-on, whatever it might throw up. Satisfaction and even life guidance can emerge from a broad perspective. Falling firmly into the latter category, I reacted with relish, not trepidation, when this hardback arrived on my desk. Having sought-out, read and even reviewed (see Lovelace 2011) equally charming titles such as The Long Descent (Greer 2008), Blackout (Heinberg 2009) and Escaping Vesuvius (Douthwaite 2011), I imagined Friedrich’s first book would be light hearted by comparison. It quickly dawned it would not. The author is unwilling to mince words or sugar-coat the message at any stage: “why is there so little being done about climate change and energy scarcity”, when each “has the potential of jeopardizing not only industrial society as we know it but … our core civilisational values” (p. viii)? Friedrichs proclaims that “Facing the future is not for wimps” (p. xi) and proceeds to tackle the world’s problems with a clipped, direct style. The tone is upbeat despite the subject matter.
After the bravado of this opening, the first chapter, in which the historical background of Limits to Growth and Malthusianism are described, could seem a little underwhelming to the experienced apocalyptic. Things quickly pick up in chapter two which presents, in impressive brevity, the scale of the energy security and climate change threats. Friedrich’s writing contains meticulous attention to detail, made more impressive by the scale and breadth of the topics he tackles. The topic of carbon lock-in exemplifies this detail: “If present trends continue, carbon lock-in is on track to rise to 100 percent by 2017” (p. 26), meaning that built infrastructure completed by 2017 alone will have the potential to exceed the ‘safe’ 450 ppm CO2 targets, even if no additional roads, mines or power stations are built beyond that point. In comparison with authors who prefer to use abstract terms and metaphor to describe the same issues (e.g. Eisenstein 2012; Kunstler 2006), Friedrich’s insistence on evidence and precision is, again, refreshing.
The brilliance of the book lies in its ability to glean insight about the future from past precedent. Friedrich’s does not take this approach lightly and is fully aware of the method’s limitations: “careful inference from historical cases is the worst research strategy except for all others” (p. 83). Specifically, the author rebuts more narrowly ‘scientific’ approaches as as pathway to envision the future: “An insistent critic might further object that formal modeling is a better strategy to study the social and political effects of disruptive energy scarcity. I respectfully disagree … it is an illusion to assume that modeling leads to more directly applicable and unequivocal results” (p. 82).&lt;/p&gt;

&lt;p&gt;What Friedrichs means by this is not that science is a weak foundation on which to construct visions of the future; simply that it has little to say on the political and economic changes resulting from more quantifiable features such as average temperatures and oil well depletion rates, that will likely have the largest impacts on peoples’ lives.&lt;/p&gt;

&lt;p&gt;Chapters 3 and 4, which use past instances of climate change and energy scarcity as analogues for the future, respectively, are thus the core of the book. The former harnesses the archaeological record in Iceland and Greenland to illustrate how changes in temperature can wreak havoc on food supplies with knock-on consequences for socio-economic systems and culture. Friedrichs rejects environmental determinism, however: it was the society-level coping strategies of Icelandic culture that allowed it to survive the Little Ice Age.&lt;/p&gt;

&lt;p&gt;The most impressive use of the historical analogy is presented in the subsequent chapter. This builds on an academic paper (Friedrichs, 2011) to discuss the implications of previous societal reactions to fuel shocks to our own situation. Interwar Japan and post-Soviet North Korea and Cuba are used to exemplify three contrasting responses to rapid declines in oil availability: militarism, autarky and adaptation, respectfully. Again, Friedrich’s meticulous yet concise use of evidence is his saving grace here. Rather than wallow in whether or not we are ‘doomed’, a brisk description of what actually happened in these dramatic situations is harnessed to provide dense nuggets of insight about how different parts of the world might adapt to energy shortages or rationing. Although Cuba’s is clearly the most preferable, there is no attempt to gloss-over the hardships of community-driven coping strategies or the cynical merits of more totalitarian responses.&lt;/p&gt;

&lt;p&gt;These are informative analogies indeed. So why are we not acting on them? Why do we not take pre-emptive action to mitigate the inevitable future declines in energy consumption now rather than being forced to in the future? The answers are provided in chapter 6 which is, in my opinion the book’s finest and most important contribution. “The moral economy of inaction” is a sweeping synthesis of social and psychological explanations for lack of action to mitigation civilisation level crisis, despite mounting evidence of trouble ahead. Based on a paper published in Philosophical Psychology (Friedrichs, 2012), the chapter explains with clarity and force how human nature tends to focus on the ‘here and now’, pushing systemic problems into the future. Friedrichs masterfully employs metaphor to explain complex psychological processes in lay terms, concluding that denial has set-in and is extremely difficult to deal with.&lt;/p&gt;

&lt;p&gt;This chapter is disquieting because it contains the admission that climate and energy crises are seen by the author as intractable and that “we have already passed the point of no return” (p. 160). The interesting thing about this admission is that it can act, as Friedrich’s himself acknowledges, as a self-fulfilling prophecy - if the issues are seen as intractable, denial becomes a logical solution to minimise pain.&lt;/p&gt;

&lt;p&gt;Despite being a self-confessed pessimist, Friedrichs wrote the final chapter for optimists. “Where to go from here” rejects wishful Utopian thinking and sketches out what a solution would look like in the abstract terms: it must be global, involving “radical transformations of our political, legal and economic subsystems” (p. 172). There is a potential for terrible atrocities to occur as a result of future ‘eco-scarcity’ yet these depressing outcomes are far from inevitable. Hope can even be found in the case of collapse, as underlined by reference to Greer’s magnificent vision, The Ecotechnic Future (Greer 2009) in the book’s closing section.&lt;/p&gt;

&lt;p&gt;In summary, The Future is not what it used to be provides a potent antidote to wishful thinking about the scale of global problems and a brutally honest high-level assessment of humanity’s failure to act. For pessimists there is much to confirm one’s world-view and insight into how to avoid the traps of despair or denial. For optimists the book is a gruelling but ultimately enlightening experience. Falling into the latter camp, I found the book a dark masterpiece. A sober check against reckless hope, it contains a message that anyone interested in civilisation’s long-term future needs to hear.&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;p&gt;Douthwaite, R. J., Heinberg, R., &amp;amp; Fallon, G. 2011. Fleeing Vesuvius: Overcoming the 	Risks of Economic and Environmental Collapse. New Society Publishers.&lt;/p&gt;

&lt;p&gt;Eisenstein, C. 2011. Sacred Economics: Money, Gift, and Society in the Age of 	Transition. Evolver Editions.&lt;/p&gt;

&lt;p&gt;Friedrichs, J. 2010. ‘Global energy crunch: How different parts of the world would react to a peak oil scenario’. Energy Policy, 38(8): 4562–4569.&lt;/p&gt;

&lt;p&gt;Friedrichs, J. 2012. ‘Useful lies: The twisted rationality of denial’. Philosophical 	Psychology, ahead of print.&lt;/p&gt;

&lt;p&gt;Greer, J. M. 2008. The Long Descent. New Society Publishers.&lt;/p&gt;

&lt;p&gt;Greer, J. M. 2009. The Ecotechnic Future: Envisioning a Post-Peak World. Aztext Press.&lt;/p&gt;

&lt;p&gt;Heinberg, R. 2009. Blackout: coal, climate and the last energy crisis. New Society Publishers.&lt;/p&gt;

&lt;p&gt;Kunstler, J. H. 2006. The Long Emergency: Surviving the End of Oil, Climate Change, and Other Converging Catastrophes of the Twenty-First Century. Grove/Atlantic.&lt;/p&gt;

&lt;p&gt;Lovelace, R. 2011. ‘The Ecotechnic Future’. Now Then, 37: April 	http://nowthenmagazine.com/issue-37/the-ecotechnic-future/&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Modelling the energy savings of cycling</title>
   <link href="http://robinlovelace.github.com//2014/01/21/modelling-energy-cycling.html"/>
   <updated>2014-01-21T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/01/21/modelling-energy-cycling</id>
   <content type="html">&lt;p&gt;Below are the slides of a talk on modelling the energy and emissions savings offered by increased cycling. This is for a seminar on &lt;a href=&quot;http://modellingonthemove.org/events/modelling-on-the-move-6-cycling-transport-modelling/&quot;&gt;Cycling and Transport Modelling&lt;/a&gt;. The full &lt;code class=&quot;highlighter-rouge&quot;&gt;ppt&lt;/code&gt; file of this talk can be found on &lt;a href=&quot;https://www.dropbox.com/s/h7amogrzmbyzjzn/Energy-use-carbon.ppt&quot;&gt;Dropbox&lt;/a&gt;. This &lt;a href=&quot;https://github.com/Robinlovelace/energy-cycling/blob/master/ntm-dft-briefing.pdf?raw=true&quot;&gt;briefing document&lt;/a&gt; about the Department for Transport’s rather pessimistic National Transport Model may also be of interest. Audio and additional materials from the talk to be uploaded in due course.&lt;/p&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;5093885064ca013102f332951b5ee316&quot; data-ratio=&quot;1.33333333333333&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

</content>
 </entry>
 
 <entry>
   <title>Spatial clipping and aggregation in R</title>
   <link href="http://robinlovelace.github.com//2014/01/10/spatial-clipping-and-aggregation-in-R.html"/>
   <updated>2014-01-10T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/01/10/spatial-clipping-and-aggregation-in-R</id>
   <content type="html">&lt;p&gt;A common task in GIS is comparing the spatial extent of one layer with another. 
Say you have a load of points, some of which overlay a polygon layer. You are only interested 
in the points that &lt;em&gt;intersect&lt;/em&gt; with the points. What do you do? Also, how can you aggregated-up
the values contained in the points to correspond with the polygons. 
These are complex computational problems. In this post 
we will see how recent updates to R’s &lt;code class=&quot;highlighter-rouge&quot;&gt;sp&lt;/code&gt; package make
the solution surprisingly intuitive and incredibly terse.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/Sampling_and_plotting_stations.png&quot; alt=&quot;Input data for spatial clipping/aggregation&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;h1 id=&quot;loading-the-data&quot;&gt;Loading the data&lt;/h1&gt;

&lt;p&gt;All of the data (and more) for this can be downloaded from the 
tutorial page on &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;GitHub&lt;/a&gt;.
To make this tutorial reproducible on any computer, we will download each input dataset 
from within R using &lt;code class=&quot;highlighter-rouge&quot;&gt;download.file&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;download.file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://robinlovelace.net/data/lnd.RData&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lnd.RData&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;download.file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://robinlovelace.net/data/stations.RData&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;stations.RData&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lnd.RData&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;stations.RData&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nrow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/Input_data.png&quot; alt=&quot;plot of chunk Input data&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;spatial-subsetting-clipping&quot;&gt;Spatial subsetting (clipping)&lt;/h1&gt;

&lt;p&gt;As the plot demonstrates, the stations are far more exentsive than polygons of 
central London. We must therefore clip them. Doing this manually would take 
much time - we’d have to interrogate the coordinates of each point to see 
whether or not it falls within one of the polygon boundaries.&lt;/p&gt;

&lt;p&gt;Fortunately with have the &lt;code class=&quot;highlighter-rouge&quot;&gt;over&lt;/code&gt; function from the &lt;code class=&quot;highlighter-rouge&quot;&gt;sp&lt;/code&gt; package to make this 
operation more terse:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;over&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;is.na&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;As if that weren’t enough, the developers of &lt;code class=&quot;highlighter-rouge&quot;&gt;sp&lt;/code&gt; have integrated 
spatial subsetting into R’s main index system with the square brackets.
Because this is a common procedure it is actually possible 
to perform it with a single line of code:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/The_clipped_stations_dataset.png&quot; alt=&quot;plot of chunk The clipped stations dataset&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As the figure shows, only stations within the London borroughs are now shown.
All that was needed was to place another spatial object in the row 
index of the points (&lt;code class=&quot;highlighter-rouge&quot;&gt;[lnd, ]&lt;/code&gt;) and R automatically understood that a
subset based on location should be produced. This line of code is an example 
of R’s ‘terseness’ - only a single line of code is needed to perform what 
is in fact quite a complex operation.&lt;/p&gt;

&lt;p&gt;The &lt;em&gt;third&lt;/em&gt; way to acheive the 
same result uses the &lt;code class=&quot;highlighter-rouge&quot;&gt;rgeos&lt;/code&gt; package. 
This is more complex and not included in this tutorial
(interested readers can see a vignette of this, to accomany the tutorial 
on &lt;a href=&quot;http://rpubs.com/RobinLovelace/11796&quot;&gt;RPubs.com/Robinlovelace&lt;/a&gt;). 
The next section demonstrates
spatial aggregation, a more advanced version of spatial subsetting.&lt;/p&gt;

&lt;h1 id=&quot;spatial-aggregation&quot;&gt;Spatial aggregation&lt;/h1&gt;

&lt;p&gt;As with R’s very terse code for spatial subsetting, the base function 
&lt;code class=&quot;highlighter-rouge&quot;&gt;aggregate&lt;/code&gt; (which provides summaries of variables based on some grouping variable)
also behaves differently when the inputs are spatial objects.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;stations.c&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aggregate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations.c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;##  [1] 48 22 43 18 12 13 25 24 12 46 18 20 28 32 38 19 30 25 31  7 10 38 12
## [24] 16 28 17 16 28  4  6 14 26  5
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The above code performs a number of steps in just one line:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;aggregate&lt;/code&gt; identifies which &lt;code class=&quot;highlighter-rouge&quot;&gt;lnd&lt;/code&gt; polygon (borrough) each &lt;code class=&quot;highlighter-rouge&quot;&gt;station&lt;/code&gt; is located in and groups them accordingly&lt;/li&gt;
  &lt;li&gt;it counts the number of stations in each borrough&lt;/li&gt;
  &lt;li&gt;a new spatial object is created and assigned the name &lt;code class=&quot;highlighter-rouge&quot;&gt;stations.c&lt;/code&gt;, the count of stations&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As shown below, the spatial implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;aggregate&lt;/code&gt; can provide summary statistics of variables.
In this case we take the variable &lt;code class=&quot;highlighter-rouge&quot;&gt;NUMBER&lt;/code&gt; and find its mean value for the stations in each ward.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;stations.m&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aggregate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;NUMBER&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FUN&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;For an optional advanced task, let us analyse and plot the result.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cut&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations.m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NUMBER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;breaks&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations.m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NUMBER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;include.lowest&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;summary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;## [1.82e+04,1.94e+04] (1.94e+04,1.99e+04] (1.99e+04,2.05e+04] 
##                   9                   8                   8 
##  (2.05e+04,2.1e+04] 
##                   8
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;clr&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as.character&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;factor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paste0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations.m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;legend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;legend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paste0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;q&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paste0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;topright&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://robinlovelace.net/figure/Choropleth_map_of_mean_values_of_stations_in_each_borrough.png&quot; alt=&quot;plot of chunk Choropleth map of mean values of stations in each borrough&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;areas&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stations.m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;polygons&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;area&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This results in a simple choropleth map and a new vector containing the area of each
borrough. As an additional step, try comparing the mean area of each borrough with the 
mean value of stations within it: &lt;code class=&quot;highlighter-rouge&quot;&gt;plot(stations.m$NUMBER, areas)&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;If you’d like to learn more about R’s rapidly improving spatial functionality, 
you can download the complete tutorial, in .pdf or .Rmd form, from 
&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/&quot;&gt;github.com/Robinlovelace/Creating-maps-in-R/&lt;/a&gt;.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>The fracking debate</title>
   <link href="http://robinlovelace.github.com//2014/01/01/fracking.html"/>
   <updated>2014-01-01T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2014/01/01/fracking</id>
   <content type="html">&lt;p&gt;Fracking is at the forefront of the climate change debate
at the moment, as it literally shoves the issue into your face,
especially if you happen to live near a rig. This is likely to
become increasingly common, with many proposed and granted sites in the
pipeline (see map &lt;a href=&quot;http://frack-off.org.uk/locations/&quot;&gt;here&lt;/a&gt;).
Of course, the industry says it has the best of intentions, and that
fracking is actually &lt;em&gt;beneficial&lt;/em&gt; for the climate, as it emits less
carbon dioxide than coal. The problem is &lt;em&gt;fugitive emissions&lt;/em&gt;:
because methane is such a potent greenhouse gas, if even a small quantity
leaks into the atmosphere - &lt;a href=&quot;http://www.theguardian.com/environment/georgemonbiot/2013/oct/24/dame-helen-ghosh-fracking-wind-turbines-national-trust&quot;&gt;around 3%&lt;/a&gt; -
shale gas is worse than coal. This finding is neatly illustrated in
a figure published in a visualisation from a debate in &lt;a href=&quot;http://www.nature.com/nature/journal/v477/n7364/abs/477271a.htmli&quot;&gt;Nature&lt;/a&gt;.
&lt;img src=&quot;https://dl.dropboxusercontent.com/u/15008199/Images-2-share/fracking-emissions.png&quot; alt=&quot;fracking-emissions&quot; /&gt;&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Kungfury - the future of DIY action movies</title>
   <link href="http://robinlovelace.github.com//2013/12/30/kungfury.html"/>
   <updated>2013-12-30T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2013/12/30/kungfury</id>
   <content type="html">&lt;p&gt;Kungfury! Could this be the future of the film industry?
With £10 ticket prices, the blandness of modern movies and the 
awesomeness of the trailer, I hope so. Enjoy!&lt;/p&gt;

&lt;iframe width=&quot;480&quot; height=&quot;360&quot; src=&quot;http://www.kickstarter.com/projects/kungfury/kung-fury/widget/video.html&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot;&gt; &lt;/iframe&gt;
</content>
 </entry>
 
 <entry>
   <title>Coxcomb plots and 'spiecharts' in R</title>
   <link href="http://robinlovelace.github.com//2013/12/27/coxcomb-plots-spiecharts-R.html"/>
   <updated>2013-12-27T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2013/12/27/coxcomb-plots-spiecharts-R</id>
   <content type="html">&lt;p&gt;I was contacted recently by a housing organisation who wanted 
an attractive visualisation of their finances, arranged in a circular 
form. Because there were two 4 continuous variables to include, all
of which were proportions of each other, the client suggested a plot
similar to a pie chart, but with each segment extending out a different
radius from the segment. I realised later that what I had been asked to 
make was a modified &lt;a href=&quot;http://en.wikipedia.org/wiki/Coxcomb_diagram#Polar_area_diagram&quot;&gt;coxcomb&lt;/a&gt; 
plot, invented by 
&lt;a href=&quot;http://en.wikipedia.org/wiki/Florence_Nightingale&quot;&gt;Florence Nightingale&lt;/a&gt; 
to represent statistics on cause of death during the Crimean War.
In fact, I had been asked to make a “&lt;a href=&quot;http://www.cs.huji.ac.il/~feit/papers/Spie03TR.pdf&quot;&gt;spie chart&lt;/a&gt;.”
This post demonstrates, for the first time to my knowledge, how it can be done 
using ggplot2. A reproducible example of this, including sample data input, can be 
found on the project’s github repository: https://github.com/Robinlovelace/lilacPlot . Please fork and attribute as appropriate!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-53.png&quot; alt=&quot;plot of chunk unnamed-chunk-5&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;h1 id=&quot;reading-and-looking-at-the-data&quot;&gt;Reading and looking at the data&lt;/h1&gt;

&lt;p&gt;This is the original dataset I was given:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read.csv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;F2.csv&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Without worrying too much about the details, the basics of the dataset are
as follows:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;One observation per row, these will later be bars on the box plot&lt;/li&gt;
  &lt;li&gt;Two components of data - captital and revenue&lt;/li&gt;
  &lt;li&gt;Different orders of magnitude: some data is in absolute monetary terms, some in percentages&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Base on the above points, a prerequisite was to create preliminary plots and manipulate the 
data so it would better fit in a coxcomb plot.&lt;/p&gt;

&lt;p&gt;The first stage, however, is to demonstrate how the addition of 
&lt;code class=&quot;highlighter-rouge&quot;&gt;coord_polar&lt;/code&gt; to a barchart can conver it into a pie chart:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-21.png&quot; alt=&quot;plot of chunk unnamed-chunk-2&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_polar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-22.png&quot; alt=&quot;plot of chunk unnamed-chunk-2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The above example works well, but notice that all the bars are of equal widths. 
What we want is to be proportional to a value (variable “Value”) of each observation.
To do this we use the age-old function &lt;code class=&quot;highlighter-rouge&quot;&gt;cumsum&lt;/code&gt;, as described in an
answer to a &lt;a href=&quot;http://stackoverflow.com/questions/20688376/how-to-make-variable-bar-widths-in-ggplot2-not-overlap-or-gap&quot;&gt;stackexchange question&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cumsum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cumsum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-31.png&quot; alt=&quot;plot of chunk unnamed-chunk-3&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_polar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale_x_continuous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;breaks&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-32.png&quot; alt=&quot;plot of chunk unnamed-chunk-3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally a spie chart has been created. After that revelation, it was essentially about adding the ‘bells and 
whistles’, including a 10% line to represent how much more or less than their share each observation was
paying.&lt;/p&gt;

&lt;h1 id=&quot;adding-the-10-&quot;&gt;Adding the 10 %&lt;/h1&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Deposit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;##  [1] 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1
## [18] 0.1 0.1 0.1
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# add 10% in there
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_polar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-41.png&quot; alt=&quot;plot of chunk unnamed-chunk-4&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# make proportional to area
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_polar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-42.png&quot; alt=&quot;plot of chunk unnamed-chunk-4&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# add capital
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;capital&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Captial&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Deposit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allocation&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;capital&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;capital&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;capital&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_polar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale_x_continuous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;breaks&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-43.png&quot; alt=&quot;plot of chunk unnamed-chunk-4&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# add ablines
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lightgrey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;capital&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-44.png&quot; alt=&quot;plot of chunk unnamed-chunk-4&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# calculate vertical ablines of divisions
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.51&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cumsum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.31&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cumsum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.64&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lightgrey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_vline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_vline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_vline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_polar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-45.png&quot; alt=&quot;plot of chunk unnamed-chunk-4&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# putting it all together
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lightgrey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;capital&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_vline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_vline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_vline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_polar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale_x_continuous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;breaks&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theme_classic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-46.png&quot; alt=&quot;plot of chunk unnamed-chunk-4&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The above looks great, but ideally, for an ‘infographic’ feel, it would 
have no annoying axes clogging up the visuals. This was done by creating an 
entirely new ggpot theme.&lt;/p&gt;

&lt;h1 id=&quot;create-theme-with-no-axes&quot;&gt;Create theme with no axes&lt;/h1&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;theme_infog&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theme_classic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theme&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;axis.line&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;element_blank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;axis.title&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;element_blank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;axis.ticks&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;element_blank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;axis.text.y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;element_blank&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;last_plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theme_infog&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-5.png&quot; alt=&quot;plot of chunk unnamed-chunk-5&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;creating-a-ring&quot;&gt;Creating a ring&lt;/h1&gt;

&lt;p&gt;To add the revenue element to the graph is not a task to be taken likely. 
This was how I tackled the problem, by creating a tall, variable-width 
bar chart first, and later adding the original spie chart after:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cap.r&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cont.r&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Contribution&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Rep.r&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cont.r&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Repayments&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;d&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;e&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;f&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;g&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;h&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;i&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;j&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;k&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;l&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;m&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;n&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;o&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;p&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;q&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;r&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;t&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lightgrey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-61.png&quot; alt=&quot;plot of chunk unnamed-chunk-6&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# we need the axes to be bigger for starters - try 1.3 to 1.5
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cap.r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;white&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Rep.r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey80&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cont.r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey30&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.196&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;white&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;white&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-62.png&quot; alt=&quot;plot of chunk unnamed-chunk-6&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;last_plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey80&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;capital&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey30&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_polar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale_x_continuous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;breaks&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theme_infog&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-63.png&quot; alt=&quot;plot of chunk unnamed-chunk-6&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;just-inner&quot;&gt;Just inner&lt;/h1&gt;

&lt;p&gt;After all that it was decided it looked nicer with only the inner ring anyway.
Here is the finished product:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Allo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey80&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;capital&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey30&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;grey40&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;black&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_abline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intercept&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0.9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linetype&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_polar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale_x_continuous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;breaks&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theme_infog&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.github.com/Robinlovelace/robinlovelace.github.io/master/figure/unnamed-chunk-7.png&quot; alt=&quot;plot of chunk unnamed-chunk-7&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;ggsave&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;just-inner.png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dpi&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;800&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</content>
 </entry>
 
 <entry>
   <title>Introduction to R and ggplot2 course</title>
   <link href="http://robinlovelace.github.com//2013/12/06/introduction-to-R-course.html"/>
   <updated>2013-12-06T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2013/12/06/introduction-to-R-course</id>
   <content type="html">&lt;p&gt;This course is about getting to grips with the basics of the R command line
for basic data analysis and visualisation. There’s a focus on maps and ggplot2.&lt;/p&gt;

&lt;p&gt;The first part of the course uses Rich Harris’s “Short Introduction to R” 
(&lt;a href=&quot;http://www.social-statistics.org/wp-content/uploads/2012/12/intro_to_R1.pdf&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;The second part works through an “Introduction to Spatial Data and ggplot2” (&lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R/blob/master/intro-spatial-rl.pdf&quot;&gt;Cheshire
and Lovelace, 2013&lt;/a&gt;),
which can be found on an updated &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;GitHub repository&lt;/a&gt;
or as an &lt;a href=&quot;http://rpubs.com/RobinLovelace/intro-spatial&quot;&gt;RPubs document&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;All the data for this second practical can be found here: https://www.dropbox.com/sh/0z9a0hrn72poql5/Bx3rgWZ0kN .&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Installing rgdal in Ubuntu 13.04</title>
   <link href="http://robinlovelace.github.com//2013/11/26/installing-rgdal-on-ubuntu.html"/>
   <updated>2013-11-26T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2013/11/26/installing-rgdal-on-ubuntu</id>
   <content type="html">&lt;p&gt;The Geospatial Data Abstraction Library (GDAL) is a workhorse of digital mapping.
Written in c++, it underpins many online and desktop geoprocessing programs including
&lt;a href=&quot;http://www.qgis.org/en/site/&quot;&gt;QGIS&lt;/a&gt; and &lt;a href=&quot;http://geoserver.org/display/GEOS/Welcome&quot;&gt;GeoServer&lt;/a&gt;.
Through its &lt;a href=&quot;http://www.gdal.org/ogr/&quot;&gt;OGR&lt;/a&gt; library, 
GDAL enables the import and export of most 
common spatial data formats, including the trusty ESRI Shapefile. 
These features and more make access to GDAL capabilities critical for 
anyone using R for serious spatial analysis. It’s almost a match made heaven:
R is the premier free and open source program for statistical analysis; GDAL 
is one of the top geoprocessing libraries and is also free and open source. 
This has led to the creation of &lt;a href=&quot;http://cran.r-project.org/web/packages/rgdal/index.html&quot;&gt;rgdal&lt;/a&gt;, 
a ‘wrapper’ that allows R to access all of GDAL’s wonderful tools. 
Importantly for free software advocates, both work in Linux. The only problem 
is that installing GDAL in a way that is accessible to R in Linux is tricky, to put it mildly. 
Having installed rgdal on several computers, I still find it tricky to set-up correctly 
on new machines. The aim of this post is to make it less painful to others.&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;R provides a cryptic response to the install command &lt;code class=&quot;highlighter-rouge&quot;&gt;install.packages(&quot;rgdal&quot;)&lt;/code&gt; first time around:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;downloaded 1.5 Mb

* installing *source* package ‘rgdal’ ...
** package ‘rgdal’ successfully unpacked and MD5 sums checked
configure: CC: gcc -std=gnu99
configure: CXX: g++
configure: rgdal: 0.8-10
checking for /usr/bin/svnversion... no
configure: svn revision: 494
configure: gdal-config: gdal-config
checking gdal-config usability... 
./configure: line 1397: gdal-config: command not found
no
Error: gdal-config not found
The gdal-config script distributed with GDAL could not be found.
If you have not installed the GDAL libraries, you can
download the source from  http://www.gdal.org/
If you have installed the GDAL libraries, then make sure that
gdal-config is in your path. Try typing gdal-config at a
shell prompt and see if it runs. If not, use:
 --configure-args='--with-gdal-config=/usr/local/bin/gdal-config'
with appropriate values for your installation. 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Essentially what this is telling you is that GDAL is not 
visibly installed on your system. Typing &lt;code class=&quot;highlighter-rouge&quot;&gt;gdal-config&lt;/code&gt; in 
a terminal instructs you to install GDAL with the following command:
&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo apt-get install libgdal-dev&lt;/code&gt;. Unfortunately, this 
often causes problems due to unmet dependencies - many times
I’ve seen Ubuntu’s Synaptic Package Manager program and its 
command line cousin &lt;code class=&quot;highlighter-rouge&quot;&gt;apt-get&lt;/code&gt; claim that packages are ‘broken’.
Once this happens things become difficult to resolve using usual 
Ubuntu logic and tools. You cannot remove the broken packages or install 
new ones so things can seem stuck. 
Even building the &lt;a href=&quot;http://trac.osgeo.org/gdal/wiki/BuildingOnUnix&quot;&gt;GDAL binaries&lt;/a&gt; from 
scratch did not work.&lt;/p&gt;

&lt;p&gt;This is never truly the case with open source software, however, and
there is a strong community providing solution to these kinds of issues. 
To cut to the chase, the solution lies not in how to install this particular
package, but how to deal with broken packages in general.
As the top response to &lt;a href=&quot;http://askubuntu.com/questions/223237/unable-to-correct-problems-you-have-held-broken-packages&quot;&gt;this issue&lt;/a&gt; shows, the package manager &lt;code class=&quot;highlighter-rouge&quot;&gt;aptitude&lt;/code&gt;, not installed as default on Ubuntu systems
can work wonders for faulty package dependencies. Just typing the following solved the problem:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install aptitude # install aptitude as an alternative to apt-get
sudo aptitude install libgdal-dev # install the package (you may have to respond to queries here)
sudo aptitude install libproj-dev # install the proj.4 projection library
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Once these packages were installed on the system, rgdal installed without a glitch on Lubuntu
13.04. The key is to ensure that the gdal and &lt;a href=&quot;http://trac.osgeo.org/proj/&quot;&gt;proj.4&lt;/a&gt;
 packages install correctly, and 
debian’s &lt;a href=&quot;https://wiki.debian.org/Aptitude&quot;&gt;aptitude&lt;/a&gt; seems to help with this. 
Why is Debian’s default package manager &lt;a href=&quot;http://askubuntu.com/questions/1743/is-aptitude-still-considered-superior-to-apt-get&quot;&gt;better than apt-get&lt;/a&gt; 
in many ways when the latter is paid for by a large company? Who knows, but its great to 
have the aptitude alternative in times of need.&lt;/p&gt;

&lt;p&gt;Another issue that can occur from the R side of things is that the 
&lt;a href=&quot;http://stackoverflow.com/questions/15569720/install-rgdal-library-in-rstudio-gdalallregister-not-found-in-libgdal&quot;&gt;g++ compiler is not installed&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Incidentally, installing gdal on Mac systems has also been problematic in the past, 
although there are &lt;a href=&quot;http://spatial.ly/2010/11/installing-rgdal-on-mac-os-x/&quot;&gt;solutions&lt;/a&gt;, 
including pre-build gdal packages for Macs.&lt;/p&gt;

&lt;p&gt;Hopefully this experience will help myself and others spend less time 
installing spatial R packages and more time actually using them!&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>The open source movement and geography</title>
   <link href="http://robinlovelace.github.com//2013/11/21/open-source-geography.html"/>
   <updated>2013-11-21T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2013/11/21/open-source-geography</id>
   <content type="html">&lt;p&gt;This is the topic of a talk for a lecture and tutorial I delivered at the University of Sheffield.
All slides, the tutorial and example data can be found in this &lt;a href=&quot;https://dl.dropboxusercontent.com/u/15008199/osm-challenge-public.zip&quot;&gt;zip file&lt;/a&gt;.&lt;/p&gt;

&lt;iframe src=&quot;http://www.slideshare.net/robinlovelace1985/slideshelf&quot; width=&quot;615px&quot; height=&quot;470px&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:none;&quot; allowfullscreen=&quot;&quot; webkitallowfullscreen=&quot;&quot; mozallowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;!--more--&gt;

&lt;p&gt;The students were asked to install and test QGIS, the free and open source mapping software, before the course. 
Thankfully everyone managed to get the software installed and working on their own laptops which came
as a pleasant surprise after the multiple glitches experienced for a similar course last year. 
People seemed to enjoy the lecture and were very impressed at the capabilities of QGIS. Three students even 
said they planned to take the approach, which involved filtering and mapping Open Street Map data for local areas, 
and use it in real-world applications, including to make a new map of an isolated village in France and creating 
a map for delivering a local magazine in York.&lt;/p&gt;

&lt;p&gt;Not only did students respond with enthusiasm to the software, they also seemed to understand the 
importance of the broader open source movement. After the talk I am convinced that open source 
is the future of all geographic software. This, I believe, will help make geography a more inclusive 
subject, of the kind advocated by &lt;a href=&quot;http://en.wikipedia.org/wiki/Patrick_Geddes&quot;&gt;Patrick Geddes&lt;/a&gt; in contrast to the elitist tradition in geography 
embodied by &lt;a href=&quot;http://en.wikipedia.org/wiki/Halford_Mackinder&quot;&gt;Halford Mackinder&lt;/a&gt;. The whole tutorial has been made available to anyone, 
so please give it a try to see the potential of open access data combined with open source software.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Mapping for the masses with geojson.io</title>
   <link href="http://robinlovelace.github.com//2013/11/16/mapping-for-the-masses.html"/>
   <updated>2013-11-16T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2013/11/16/mapping-for-the-masses</id>
   <content type="html">&lt;p&gt;Finally, after weeks of deliberation and numerous conversations, &lt;a href=&quot;http://gis.stackexchange.com/questions/77734/can-osms-id-editor-be-used-on-custom-maps&quot;&gt;on-line&lt;/a&gt;
and off, I think I’ve found 
a satisfactory solution to my long-standing question: how do you build collaborative maps online 
in realtime using open source software? The one word answer, &lt;a href=&quot;http://geojson.io&quot;&gt;geojson.io&lt;/a&gt;, is contained in the map below. A 
more detailed answer is provided below.&lt;/p&gt;

&lt;iframe frameborder=&quot;0&quot; width=&quot;100%&quot; height=&quot;300&quot; src=&quot;http://bl.ocks.org/d/d7defc8f828f444b5e25&quot;&gt;&lt;/iframe&gt;

&lt;!--more--&gt;

&lt;p&gt;This problem emerged for me when I move to a new city and wanted to help out their equivalent of &lt;a href=&quot;http://growsheffield.com/abundance/&quot;&gt;Abundance&lt;/a&gt;.
Now, if you plan on collecting food in a city, even if you think you know it well, you will need maps.
Fine you say, just edit Google Maps or create your own paper one. Unfortunately neither solution is acceptable: one’s too
social (and the data is controlled instantly by Google) and the other is too antisocial. We want collaboration!&lt;/p&gt;

&lt;h2 id=&quot;various-alternatives&quot;&gt;Various alternatives&lt;/h2&gt;
&lt;p&gt;After a while of searching I &lt;a href=&quot;http://gis.stackexchange.com/questions/74600/whats-the-most-appropriate-toolset-for-creating-a-community-map&quot;&gt;narrowed-down&lt;/a&gt;
my options to the following:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Do it in &lt;a href=&quot;http://geoserver.org/display/GEOS/Welcome&quot;&gt;GeoServer&lt;/a&gt;,
the open source multi-purpose map server. This would be blatant overkill for small community solutions 
(although it’s one to bear in mind if community maps ever need to join up and scale).&lt;/li&gt;
  &lt;li&gt;Use some kind of 3rd party to host the data, such as &lt;a href=&quot;http://blog.mangomap.com/&quot;&gt;MangoMap&lt;/a&gt; or QGIS cloud. Each of 
these solutions were attractive in one way or another but didn’t offer the mass editing or horizontal organisational 
structure I was after.&lt;/li&gt;
  &lt;li&gt;Manage the geodata files in my favourite version control software Github, taking advantages of the recently 
added &lt;a href=&quot;https://github.com/blog/1541-geojson-rendering-improvements&quot;&gt;ability to display &lt;code class=&quot;highlighter-rouge&quot;&gt;.geojson&lt;/code&gt; files&lt;/a&gt;
in an overview map. This would be great if I was working with a team of crack coders, but it’s simply too tricky to expect people
to edit these files then upload them back up to github from the command line.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Weeks after asking this question to the OSGEO community, I returned to rediscover the following little comment under my 
original question:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Would add Tilemill to the list
At the time this seemed like one option too many, so I gave up. But when I actually found out who was behind TileMill, 
the web mapping wizard outfit &lt;a href=&quot;https://www.mapbox.com/&quot;&gt;MapBox&lt;/a&gt;, I decided to try again.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;discovering-geojsonio&quot;&gt;Discovering geojson.io&lt;/h2&gt;
&lt;p&gt;It was thanks to direct communications with MapBox developers, not the TileMill solution itself
that led me to geojson.io. This software has only been available for a month or so: still rough 
around the edges. Yet it offers speed, stability and, crucially, the ability to visually edit
&lt;code class=&quot;highlighter-rouge&quot;&gt;.geojson&lt;/code&gt; files online and save them to existing GitHub accounts. 
To make the mapping a community project, all that’s needed is a Github team, and anyone in that 
team can add to the map. If it needs to be private, that can happen too, via bitbucket&lt;/p&gt;

&lt;h2 id=&quot;polishing-it-in--mapbox&quot;&gt;Polishing it in  MapBox&lt;/h2&gt;
&lt;p&gt;This is the final stage, to be approached after the map has actually been completed.
But given that MapBox specialize in making beautiful maps this should be the easy part.&lt;/p&gt;

&lt;iframe src=&quot;http://infoamazonia.org/embed/?map_id=6731&amp;amp;width=600&amp;amp;height=400&quot; width=&quot;600&quot; height=&quot;400&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;

</content>
 </entry>
 
 <entry>
   <title>Utopias conference, Ecuador</title>
   <link href="http://robinlovelace.github.com//2013/11/14/utopias-conference.html"/>
   <updated>2013-11-14T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2013/11/14/utopias-conference</id>
   <content type="html">&lt;p&gt;Check out this post about a festival about petrol-free future utopias in 
Ecuador. Really makes me question whether the UK’s reputation for ‘cutting edge’ 
thinking and creativity is justified… Only wish I could go. Seems to 
be linked to the website &lt;a href=&quot;http://www.amazoniaporlavida.org/es/Feria-de-las-utopias-concretas/&quot;&gt;amazoniaporlavida&lt;/a&gt; 
although I can find no more information about it online.&lt;/p&gt;

&lt;div id=&quot;fb-root&quot;&gt;&lt;/div&gt;
&lt;script&gt;(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = &quot;//connect.facebook.net/en_US/all.js#xfbml=1&quot;; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));&lt;/script&gt;

&lt;div class=&quot;fb-post&quot; data-href=&quot;https://www.facebook.com/photo.php?fbid=10151799298403424&amp;amp;set=a.10151799281438424.1073741826.698708423&amp;amp;type=1&quot; data-width=&quot;550&quot;&gt;&lt;div class=&quot;fb-xfbml-parse-ignore&quot;&gt;&lt;a href=&quot;https://www.facebook.com/photo.php?fbid=10151799298403424&amp;amp;set=a.10151799281438424.1073741826.698708423&amp;amp;type=1&quot;&gt;Post&lt;/a&gt; by &lt;a href=&quot;https://www.facebook.com/gustavoahenao&quot;&gt;Gustavo Henao&lt;/a&gt;.&lt;/div&gt;&lt;/div&gt;

</content>
 </entry>
 
 <entry>
   <title>Transport in development lecture, Birmingham</title>
   <link href="http://robinlovelace.github.com//2013/11/01/transport-in-development-lecture.html"/>
   <updated>2013-11-01T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2013/11/01/transport-in-development-lecture</id>
   <content type="html">&lt;p&gt;The slideshow below provides an outline of the lecture I’ve been asked 
to do at the University of Birmingham. To put this in context, I’ve
been heavily involved with &lt;a href=&quot;http://www.ewb-uk.org/&quot;&gt;Engineers Without Borders&lt;/a&gt;.
I joined &lt;a href=&quot;https://ewb.shef.ac.uk/&quot;&gt;EWB Sheffield&lt;/a&gt; when I moved there and 
was on the committe for
the past 4 years. My job was a project manager, first for the wind 
turbine project, and then for pedal powered machines group, which &lt;a href=&quot;https://www.facebook.com/groups/363796170375539/&quot;&gt;lives
on&lt;/a&gt;.
My main involvement now is with the “&lt;a href=&quot;http://engineeringindevelopment.org/&quot;&gt;EinD&lt;/a&gt;”
project, co-writing a chapter on 
transport in development. And so I was invited to do this talk, 
which is part of a push by Birmingham and other Engineering departments
to engage more closely with issues of poverty, sustainability and 
ethics. I think this is a fantastic idea as todays engineers will&lt;br /&gt;
quite literally help build tomorrow’s world.
&lt;br /&gt;&lt;/p&gt;

&lt;iframe src=&quot;http://www.slideshare.net/slideshow/embed_code/27782144&quot; width=&quot;427&quot; height=&quot;356&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px&quot; allowfullscreen=&quot;&quot;&gt; 
&lt;/iframe&gt;
&lt;div style=&quot;margin-bottom:5px&quot;&gt; &lt;strong&gt; &lt;a href=&quot;https://www.slideshare.net/robinlovelace1985/transport-for-development&quot; title=&quot;Transport for development&quot; target=&quot;_blank&quot;&gt;Transport for development&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href=&quot;http://www.slideshare.net/robinlovelace1985&quot; target=&quot;_blank&quot;&gt;Robin Lovelace&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;

</content>
 </entry>
 
 <entry>
   <title>Vim for Markdown (md) file editing</title>
   <link href="http://robinlovelace.github.com//2013/10/31/vim-for-markdown.html"/>
   <updated>2013-10-31T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//2013/10/31/vim-for-markdown</id>
   <content type="html">&lt;p&gt;&lt;a href=&quot;http://www.vim.org/&quot;&gt;Vim&lt;/a&gt; is rapidly becoming my favourite text editor. This may seem strange
because progress is often seen in terms of larger, flashier and - in terms of computing at least -
bulkier and more resource intensive. Vim long ago overtook the grotesquely obese and colourful
Microsoft Word, which does not even work properly on my favourite operating system Linux without
resorting to Wine or booting up an entire virtual machine. Both of these solutions add complexity
and bother. In any case, the 
free &lt;a href=&quot;http://www.noobslab.com/2013/05/microsoft-office-alternative-kingsoft.html&quot;&gt;M$ Office clone Kingsoft Office&lt;/a&gt;&lt;br /&gt;
Kingsoft’s elegant Microsof Word clone, ‘Writer’, and LibreOffice’s open source ‘Writer’
are both stable, native on Linux and visually attractive, largely solving the problem.
Much nicer writing in fancy fonts than
boring monospace right? Well not always - sometimes the visual content of these GUI-based text
editors can get in the way and distract from the main task - communication.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;a href=&quot;http://www.zimagez.com/zimage/screenshot-311013-162900.php&quot;&gt;
  &lt;img src=&quot;http://www.zimagez.com/miniature/screenshot-311013-162900.php&quot; /&gt;
  &lt;/a&gt;&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;To deal with this issue, some people prefer to write their work in LaTeX, which brings me to the
final and hardest-to-beat competitors for text editing: Kile and Rstudio. At the outset these are
very different, the former being a dedicated LaTeX editor with a strong following, the latter being
an IDE for the R statistical programming language. But both offer excellent support for just
writing, the former in LaTeX (which can easily be converted to Markdown), the latter in RMarkdown
(which provides some additional features) or Markown directly. Both offer excellent facilities for
projects, searching and auto-completion. So I’m still not convinced Vim is better, especially as
Kile can compile to LaTeX with a single mouse click and RStudio provides a rich graphical
environment that is ideal for testing R code and plotting the output. Yet Vim still has some
advantages for editing raw markdown (.md) files that we will see below. Vim has a reputation as
being impenetrable and a ‘coders’ tool, but in fact many people swear by it for much more. There are
even very strong arguments for using Vim to write prose and novels, as pointed out by &lt;a href=&quot;http://alols.github.io/2012/11/07/writing-prose-with-vim/&quot;&gt;Albin
Olsson&lt;/a&gt;. But that’s getting away from the
point. The first stage is to get comfortable with the small but daunting Vim program.&lt;/p&gt;

&lt;h2 id=&quot;vim-versions&quot;&gt;Vim versions&lt;/h2&gt;
&lt;p&gt;There are two main flavours of Vim available: ‘vanilla’ vim that only run’s within a Unix terminal
or &lt;a href=&quot;http://gvim.en.softonic.com/download&quot;&gt;GVim&lt;/a&gt; (short for ‘graphical vim’), a version that works 
like and other text editor such as Microsoft’s notorious Notepad,
the excellent Notepad++ or Gedit. GVim is a great way to access the world of Vim
 as it’s easier and a gentle way into the world of Vim that maintains all the functionallity of
the terminal-based editor.&lt;/p&gt;

&lt;h2 id=&quot;opening-files&quot;&gt;Opening files&lt;/h2&gt;
&lt;p&gt;Once you have Vim installed and are comfortable with its basic operation, the next stage
is opening the files. From a graphical file system, this is as simple as right clicking on the file&lt;br /&gt;
and selecting “open with GVim”:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://dl.dropboxusercontent.com/u/15008199/Images-2-share/gvim-open.png&quot; alt=&quot;gvim-open&quot; /&gt;&lt;/p&gt;

&lt;p&gt;GVim is a pleasure to use, so please check out the help pages contained within the program to get to grips 
with it. For the purposes of this post we’ll persevere with the command-line option, which 
works in exactly the same way: the following applies equally to GVim as to Vim.&lt;/p&gt;

&lt;h2 id=&quot;opening-from-the-command-line&quot;&gt;Opening from the command line&lt;/h2&gt;
&lt;p&gt;If you get used to using Vim from within a Linux terminal (which many system administrators and some
programmers do - it’s fun) you can open a file simply by typing &lt;code class=&quot;highlighter-rouge&quot;&gt;vim filename.md&lt;/code&gt;. That does the job
well, but when we are using files that all begin with a similar string of characters, this can be a
hassle. As it happens, one of the fastest growing uses of Markdown is for blogs using the program
Jekyll. By default, Jekyll names its files in chronological order, with the format yyyy-mm-dd.
Clearly, if you write more than posts in one day, you will have to type in at least 11 characters
(10 to select the correct date, one so that pressing &lt;code class=&quot;highlighter-rouge&quot;&gt;tab&lt;/code&gt; results in the correct file being
selected) to get the right file loaded in vim.&lt;/p&gt;

&lt;p&gt;This technique works fine. For the lazy, however, it is just too slow and cumbersome. In addition,
if you remember part of the title of the post but not its date (e.g. I wrote about bicycle trailers
a few days ago, but cannot remember the exact date), it can lead to a lot of typing and a lot of
looking at the filenames (e.g. via &lt;code class=&quot;highlighter-rouge&quot;&gt;ls _posts&lt;/code&gt;, assuming you’re in your website’s root directory).
What is really needed is a way of telling Vim “open the markdown file that contains &lt;code class=&quot;highlighter-rouge&quot;&gt;trailer&lt;/code&gt; in its
title”. Vim does not understand English though, so we must tell it how to that in code.&lt;/p&gt;

&lt;p&gt;The first thing is to test that we can find files properly using the &lt;code class=&quot;highlighter-rouge&quot;&gt;find&lt;/code&gt; command at the terminal.
Typing &lt;code class=&quot;highlighter-rouge&quot;&gt;find . -name *trailer*.md'&lt;/code&gt; in the root of my website, for example, generates a single
respone: &lt;code class=&quot;highlighter-rouge&quot;&gt;\_posts/2013-09-29-sheffield-to-leeds-bike-trailer-move.md&lt;/code&gt;, which is exactly what I was
looking for. The difficulty is telling Vim to then open that file, without having to retype it
again. Originally I used the command xargs to do this, but like one gentleman on Stackoverflow, I
soon discovered that this &lt;a href=&quot;http://superuser.com/questions/336016/invoking-vi-through-find-xargs-breaks-my-terminal-why&quot;&gt;breaks
terminal&lt;/a&gt;.
The solution to this problem, is contained within the same thread, but only at the bottom: use
&lt;code class=&quot;highlighter-rouge&quot;&gt;-exec&lt;/code&gt; instead. So the command becomes as follows:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;find . -name &lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;trailer&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;.md -exec vim &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; +
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Observant readers may have registered that the additional &lt;code class=&quot;highlighter-rouge&quot;&gt;-exec vim {} +&lt;/code&gt; commands add 14
characters, more than would have been necessary had we known the date of the entry. Still, it is
still beneficial when we know the a string contained with the file we want to edit but not its
beginning or its full name. This is especially common when editing Markdown files for personal
websites.&lt;/p&gt;

&lt;p&gt;An even quicker way to open the file is as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-{bash}&quot;&gt;vim _posts/*trailer*.md
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;syntax-highlighting&quot;&gt;Syntax highlighting&lt;/h2&gt;
&lt;p&gt;There are a number of discussion threads on the internet about Vim not formatting Markdown 
files correctly. In fact, Vim is perfectly capable of displaying Markdown files correctly in 
its default configuration form. The issue that most commonly arises is that people label their
Markdown files as *.md, rather than providing the full ‘official’ suffix of *.markdown. Vim
is only set-up to understand the latter, so with its default settings it will display .md files
incorrectly, as illustrated below:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://dl.dropboxusercontent.com/u/15008199/Images-2-share/gvim-syntax-fail.png&quot; alt=&quot;incorrect syntax highlighting&quot; /&gt;&lt;/p&gt;

&lt;p&gt;There are many solutions to this problem and a few people have created their own custom highlighting 
solutions by writing Vim plugins. A far simpler solution is to simply make Vim see .md files as 
Markdown. &lt;a href=&quot;http://stackoverflow.com/questions/10964681/enabling-markdown-highlighting-in-vim&quot;&gt;To do this&lt;/a&gt;,
 just create a file called .vimrc in your home directory and add the following line:&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;au&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;BufRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;BufNewFile&lt;/span&gt; *&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;md &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;filetype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;markdown
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;viewing-the-results&quot;&gt;Viewing the results&lt;/h2&gt;
&lt;p&gt;There are a number of options available here.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;To convert the Markdown files directly to html, 
there is a &lt;a href=&quot;http://vimcasts.org/episodes/converting-markdown-to-structured-html-with-a-macro/&quot;&gt;plugin available&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;To have real-time updates of the compiled Markdown files in Chrome, there is a Java application which 
has impressive functionality (based on the video loaded on its Github page), although I found it difficult to install.&lt;/li&gt;
  &lt;li&gt;The solution favoured by me is also the simplest: just save the latest version of the file you’re writing (&lt;code class=&quot;highlighter-rouge&quot;&gt;:w&lt;/code&gt;) 
and then serve the website locally using &lt;code class=&quot;highlighter-rouge&quot;&gt;jekyll serve --drafts&lt;/code&gt; to compile the drafts and then view the results on a 
browser of your choice.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h2&gt;
&lt;p&gt;Vim is an excellent all-round IDE and text editor. It can also, with a few tweaks reviewed in this article,
also be a great editor for your Markdown files.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Sharing folders with Ubuntu One</title>
   <link href="http://robinlovelace.github.com//2013/10/23/publishing-folders-ubuntu1.html"/>
   <updated>2013-10-23T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2013/10/23/publishing-folders-ubuntu1</id>
   <content type="html">&lt;p&gt;&lt;a href=&quot;https://one.ubuntu.com/&quot;&gt;Ubuntu One&lt;/a&gt; - U1 for short -  is an alternative to other internet storage spaces such as Dropbox. 
It’s useful because it gives you 5Gb of storage for free, works on any common operating system and 
allows music streaming and other features. Even better, you can get 25Gb of storage for only 99p if you buy any music from their store.
Downsides of U1 are that it does not back-up your work, and does not have a ‘public’ folder like &lt;a href=&quot;https://www.dropbox.com/help/16/en&quot;&gt;dropbox used to&lt;/a&gt;.
For these reasons, I use U1 for sharing big files that I could live without if I lost them, like films I want to share with friends. 
Below I show how a little Python script can be used to share entire folders, 
like &lt;a href=&quot;http://ubuntuone.com/03U1iH0VJGDbK3qa7iXzqp&quot;&gt;this one&lt;/a&gt; of documentaries to share.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://dl.dropboxusercontent.com/u/15008199/Images-2-share/U1-share.png&quot; alt=&quot;U1-image&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;As with many things in Linux, the solution is not provided on a plate. 
A tiny program called &lt;code class=&quot;highlighter-rouge&quot;&gt;u1-publish-folder&lt;/code&gt; is used. No actual coding is reqired:
all you need to do is type the following into a terminal, and the program should be accessible:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;# download the program script from the internet&lt;/span&gt;
wget http://bazaar.launchpad.net/~sil/+junk/utility-programs/download/head:/u1publishfolder-20120417145707-dzynnctfx0qgro9a-1/u1-publish-folder
sudo mv u1-publish-folder /bin/ &lt;span class=&quot;c&quot;&gt;# place the binary into the right directory&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is a good start, but it will still not work: try typing &lt;code class=&quot;highlighter-rouge&quot;&gt;u1-publish-folder&lt;/code&gt;
into a terminal: you should get an error saying &lt;code class=&quot;highlighter-rouge&quot;&gt;command not found&lt;/code&gt;.
The reason why this has happened is probably because the &lt;em&gt;permissions&lt;/em&gt; in the
binary script are not set-up correctly.&lt;/p&gt;

&lt;p&gt;We can check this from the command line with the following code:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;ls -l /bin/ &lt;span class=&quot;c&quot;&gt;# list the binary files available to your system&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This will generate a list of files and tell you about what permissions
different users have. It’s not worth worrying about this if all you
want to do is to get folders published on U1 quickly - search for “chmod”
and “ls Linux” if interested to learn the details. From the image below,
we can see that the &lt;code class=&quot;highlighter-rouge&quot;&gt;u1-publish-folder&lt;/code&gt; file has a different permission
status than the others:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://dl.dropboxusercontent.com/u/15008199/Images-2-share/u1-not-executable.png&quot; alt=&quot;not-executable-image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;All we really need to know is how to change the permissions so that the
&lt;code class=&quot;highlighter-rouge&quot;&gt;u1-publish-folder&lt;/code&gt; program can run on your system. This will most
likely work on your system using the following command:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo chmod -g+rwx /bin/u1-publish-folder &lt;span class=&quot;c&quot;&gt;# add read, write and execute permissions to all users in the group&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Finally, we are ready to use the program. It’s as simple as typing
&lt;code class=&quot;highlighter-rouge&quot;&gt;u1-publish-folder&lt;/code&gt; followed directly by a space and the name of
the folder you wish to make available to the world.
In my case I created a folder called &lt;code class=&quot;highlighter-rouge&quot;&gt;worldwide&lt;/code&gt; in my &lt;code class=&quot;highlighter-rouge&quot;&gt;Ubuntu One&lt;/code&gt;
directory for files I want to share.
So the full command is as follows:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;u1-publish-folder /home/robin/Ubuntu One/Worldwide &lt;span class=&quot;c&quot;&gt;# publish folder to the internet&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The output you should see is as follows:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Examining folder /home/robin/Ubuntu One/Worldwide
Publishing 3 files...
  published /home/robin/Ubuntu One/Worldwide/eg.pdf
  published /home/robin/Ubuntu One/Worldwide/R-class.zip
  published /home/robin/Ubuntu One/Worldwide/osm-challenge.zip
Constructing the folder index...
Waiting &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Ubuntu One to upload index...
Done.
Publishing the folder index...
Folder index now available at http://ubuntuone.com/3Wk6wDn2urH0Y2mnhZdiZy
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;When I clicked on &lt;a href=&quot;http://ubuntuone.com/3Wk6wDn2urH0Y2mnhZdiZy&quot;&gt;http://ubuntuone.com/3Wk6wDn2urH0Y2mnhZdiZy&lt;/a&gt;
I found that, indeed, all the files were now available, but not sub-folders,
which is good in some ways, offering you more control over what’s public and what is not.&lt;/p&gt;

&lt;p&gt;The details of the program are
 &lt;a href=&quot;http://kryogenix.org/days/2012/04/18/publishing-a-folder-with-ubuntu-one&quot;&gt;explained well here&lt;/a&gt;.
Hope this tutorial helps someone - please let me know if so!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Moving house by bicycle trailer</title>
   <link href="http://robinlovelace.github.com//2013/10/13/bicycle-trailer-move.html"/>
   <updated>2013-10-13T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2013/10/13/bicycle-trailer-move</id>
   <content type="html">&lt;p&gt;Back in 2009 I moved from York to Sheffield to start a PhD on the &lt;a href=&quot;http://e-futures.group.shef.ac.uk/page/home/&quot;&gt;Energy Futures&lt;/a&gt; 4 year Doctoral Training Centre. 
Young and naive, some friends and I decided to do it by bicycle, with one bicycle trailer filled to the brim and 4 large panniers carrying most of my stuff.&lt;/p&gt;

&lt;p&gt;4 years later and I’ve moved again, this time to Leeds. I’ve got a new a job at Leeds University,
 working on the &lt;a href=&quot;http://www.geotalisman.org/&quot;&gt;Geotalisman&lt;/a&gt; project in the department of geography. 
Older and hopefully wiser, I decided to move house by bicycle again: it’s shorter than the trip to York 
(40 miles, not 60), I was more organised with planning (providing a month’s notice for friends and 
family to attend and after 4 years in Sheffield I knew many people who would be up for the ride. 
To make it more exciting, this time we brought music, in the form of a 12v sound system.
See the map, words, images and video below for the full low-down on this epic ride.&lt;/p&gt;

&lt;iframe src=&quot;http://www.gpsies.com/mapOnly.do?fileId=nueyoqzfqmingzgc&quot; width=&quot;600&quot; height=&quot;400&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot; marginheight=&quot;0&quot; marginwidth=&quot;0&quot;&gt;&lt;/iframe&gt;

&lt;!--more--&gt;
&lt;h2 id=&quot;introduction-preparation-and-kit&quot;&gt;Introduction: preparation and kit&lt;/h2&gt;
&lt;p&gt;The first stage was to recruit people. With a month’s notice, I managed to get around 15 people to 
sign-up to the challenge. One issue for some people was lack of a suitable bicycle, so additional 
ones were found and leant out. The best of these was a large tandem leant to me by a friend.
Trailers would be a major limiting factor for most people, but, as a member of 
&lt;a href=&quot;https://ewb.shef.ac.uk/&quot;&gt;EWB Sheffield&lt;/a&gt; who had helped on the bike trailer project, this was 
less of an issue. We borrowed one trailer from EWB, and the other one was my own, purchased 
from Ebay &lt;a href=&quot;http://www.ebay.co.uk/bhp/bicycle-trailer&quot;&gt;for around £60&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The plan was to set-off at 11 am. But it took almost an hour for to say final goodbyes, for everyone to 
sort their stuff out and to decide who would be riding which 
bikes. So it was essentially a midday start.&lt;/p&gt;

&lt;h2 id=&quot;stage-one-navigating-the-urban-jungle&quot;&gt;Stage one: navigating the urban jungle&lt;/h2&gt;

&lt;p&gt;Getting out of any major city is usually a challenge by bicycle, and Sheffield is no 
exception, with the giant M1 dominating the norther route. 
Fortunately we were ably guided for the first 10 miles or so by Sustrans Ranger 
Simon Geller, who took us safely out via Northern General hospital and out onto 
the car-free &lt;a href=&quot;http://www.sustrans.org.uk/ncn/map/route/trans-pennine-trail-central&quot;&gt;Trans Pennine Trail&lt;/a&gt; to Leeds.&lt;/p&gt;

&lt;p&gt;It was a major relief to get off the road, despite the hassle of hauling the big 
bike trailers over the barriers - see video below.
After that the route was quite tranquil until, realising we were behind schedule, 
we decided to just get onto the A61 for the final 5 miles to Barnesley, 
where we had agreed to meet other people and from where people could go home early.&lt;/p&gt;

&lt;h2 id=&quot;stage-two-barnesley-to-wakefield&quot;&gt;Stage two: Barnesley to Wakefield&lt;/h2&gt;
&lt;p&gt;We were all quite tired in Barnesley, so a good rest was had by all in the 
lush sunshine. Our only puncture of the trip was fixed, we ate and waited for 
Nokolai - a new recuit from Leeds, who would help out greatly with lugging the trailers.
By the time we set off again it was almost 5. Conscious of the need to go faster to 
arrive before sunset, we changed our route plan completely and decided just to 
get our heads down and pedal along the A61 all the way.&lt;/p&gt;

&lt;p&gt;The difference in speed was noticeable. With fresh legs towing the bicycle trailers 
and some of the less experienced cyclists leaving us in Barnesley it felt like we 
were flying. The road is wide and flat, so it did not feel especially dangerous.
Cycling in convoy is probably safer anyway because people notice a flock of cyclists
more than a single one or two. There was a hard climb up to Wakefield where we 
had a number of small stops. The overall feeling was “let’s just get there” so 
we pressed on, after another couple of people headed to the train station.
The proximity of rail stations to the route was one of its major advantages, 
allowing people to leave when they wanted to, and meaning that setting off 
was not such a major commitment. It was all downhill from Wakefield, or 
so we thought.&lt;/p&gt;

&lt;h2 id=&quot;the-final-straight-into-leeds&quot;&gt;The final straight: into Leeds&lt;/h2&gt;
&lt;p&gt;As dusk descended, the group re-united. With various distractions, we had become 
dispersed on the fast downhill stretch directly north of Wakefield. As the traffic 
volume increased again near central Leeds, and as our level of visibility decreased
it made sense to stick together. At this stage we turned the volume up on the 
bicycle trailer soundsystem. This helped a great deal to raise spirits that were flagging 
after a longer than expected ride.&lt;/p&gt;

&lt;p&gt;We arrived in Leeds city centre at around 8pm. Knackered, we went directly to 
the &lt;a href=&quot;http://www.wharfchambers.org/&quot;&gt;Wharf Chambers&lt;/a&gt; for a pint and some food. 
Before I knew it we were watching live music, most of my Sheffield friends had
gone back after heartfelt goodbyes, and it was approaching midnight. 
But we still had two bicycle trailers to get back to my final destination, which was still another 
mile away, uphill. This final stretch was a real slog, but, thanks to Nikolai’s 
indominatable spirit we made it there before 12. Finally I was home!&lt;/p&gt;

&lt;h2 id=&quot;why-move-house-by-bike-trailer&quot;&gt;Why move house by bike trailer?&lt;/h2&gt;
&lt;p&gt;With all the extra hassle involved, you may wonder why I went to all these lengths. 
A van could have done the job in under 2 hours, with a lot less sweat and in fact 
I used this option a week later to move residual stuff that I could not 
fit into the trailers. So why bother?&lt;/p&gt;

&lt;p&gt;The main reason for doing this was social: instead of having a big ‘piss-up’ to see 
me off I much preferred people stayed in the night before. That way I got to have 
a sober conversation with some of my best friends in Sheffield whilst doing something fun. 
For a few people on the ride, it was the furthest they had ever travelled by bicycle, and 
this alone was worth-it for me.&lt;/p&gt;

&lt;p&gt;Another reason was that bicycle trailer moves are cheap. To hire a van can easily cost £100 for the day, 
and the price of breakfast for the ride (and buying many people drinks in Leeds) was considerably less.&lt;/p&gt;

&lt;p&gt;Finally, bicycling in general is healthy. It’s good for you because you get your heart pumping and 
some fresh air. It’s healthy for the environment too, as you get to leave the car at home.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Moving house by bicycle trailer was one of the the most enjoyable experiences
of 2013 for me. Being surrounded by friends, music and sunshine was infinitely 
preferable to the van-based alternative. The even also brought people together in 
a way that simply going out and drinking alcohol cannot. It was fun, free (in every 
sense of the word) but definitely not fast, so if you have a tight schedule to move
bicycle trailers may not be the best way forward. There are also obvious physical limits
in how far you can actually move bulky items in a single day and 40 miles was already 
pushing the limit for us.&lt;/p&gt;

&lt;p&gt;I would strongly recommend anyone who’s moving house to a not too distant 
new location to consider bicycle trailers. They are so much more fun and 
sociable than just jumping in a van, you just can’t go wrong. 
If this little article on the matter has not persuaded you, check the video 
below, sounds and all.&lt;/p&gt;

&lt;p&gt;I will be forever grateful to all the people who helped out with this move.&lt;/p&gt;

&lt;iframe width=&quot;420&quot; height=&quot;315&quot; src=&quot;//www.youtube.com/embed/6a8QLiC4LV8&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
</content>
 </entry>
 
 <entry>
   <title>Feral, a book review</title>
   <link href="http://robinlovelace.github.com//2013/09/23/feral-book-review.html"/>
   <updated>2013-09-23T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2013/09/23/feral-book-review</id>
   <content type="html">&lt;p&gt;George Monbiot is a well-known environmentalist. He has a regular column in the Guardian newspaper, writes occasionally for a number of other publications (all his articles can be viewed on the clutter free website &lt;a href=&quot;http://www.monbiot.com&quot;&gt;www.monbiot.com&lt;/a&gt;) and a &lt;a href=&quot;http://en.wikipedia.org/wiki/George_Monbiot#Published_works&quot;&gt;number of books&lt;/a&gt; already under his name. As a child, I sometimes dreamed of ‘saving the rainforest’ and probably for this reason Monbiot became a natural role model as I grew up, even though he quickly destroyed my overly simplistic views of ‘good’ conservationists vs the ‘bad’ deforesters. His writing is broad, encapsulating the links between many different elements of what is, invariably, a more complex problem than what first impressions indicate. In the mid 2000s, George Monbiot took-on the ‘greatest environmental threat’ - climate change - almost head-on in his acclaimed book Heat. This provided motivation for me to seek solutions, not only on some abstract policy level, but in my everyday life.&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;Fast-forward five years. Instead of fretting over our collective failure to overcome society’s enduring addiction to fossil fuels, it is refreshing to see that Monbiot has moved on. Environmental problems are big and, due partly to the long timespans over which they develop, can seem intractible. Instead of discussing the problem, in this case lack of wild or ‘self-willed’ ecosystems, from an abstract perspective, Monbiot dives into some vivid descriptions of experiences in the wilderness. Contrast this with the monotony of everyday life and it becomes apparent that many people are suffering from ecological boredom. We have got to the point in which opening a poorly designed bag of nuts constitutes the most exciting manual task of the day! The escapism of video games and the many other distractions of the modern world is provided as anecdotal evidence for this, alongside a wealth of peer-reviewed literature on &lt;a href=&quot;http://en.wikipedia.org/wiki/Nature_deficit_disorder&quot;&gt;nature deficit disorder&lt;/a&gt; provides an undeniable argument: we need to re-engage with nature.&lt;/p&gt;

&lt;p&gt;As Monbiot has himself said &lt;a href=&quot;http://www.foe.co.uk/living/articles/george_monbiot.html&quot;&gt;elsewhere&lt;/a&gt;, the underlying concept of this book is a simple one. It is eloquently written, yet succinct and without excessive diversions. The personal story that provides the backdrop to the ideas presented is not self-indulgent, but clear, concise and at times brutal.&lt;/p&gt;

&lt;p&gt;Regarding the actual policies that he is proposing, George Monbiot seems to have moved further towards the ‘pragmatist’ camp of environmentalism since the ‘&lt;a href=&quot;http://www.amazon.co.uk/Age-Consent-George-Monbiot/dp/0007150431&quot;&gt;Age of Consent&lt;/a&gt;’, in which global issues are tackled head-on and 
the real-politik of potential solutions are apparently hammered-out (disclaimer: I’ve not read the book). Older and perhaps wiser, the solutions in Feral are less complex and eminently more feasible. These include (in the order that they are presented in the book) the return of trees and ‘keystone species’ such as the moose and otter to low-intensity farmland; a reduction in overgrazing in ‘Sheepwrecked’ uplands, and the enforcement of ‘no fish zones’. All of these could easily have economic benefits that dwarf their costs over time, even for the farmers and fishing industries that currently resist any whiff of environmentally beneficial regulation. The description of whales as a keystone species with the potential to fertilise the seas and sequester large volumes of carbon dioxide in the process in “Rewilding the Sea” was particularly interesting, and supported with ample peer-reviewed literature to persuade even the most hard-nosed ‘&lt;a href=&quot;http://thoughtssoloud.wordpress.com/2013/05/15/morning-roundup-why-are-we-still-talking-about-bono/&quot;&gt;factivist&lt;/a&gt;’.&lt;/p&gt;

&lt;p&gt;Ultimately this book is not about facts, though, but about our inbuilt need to interact with nature, the wider benefits this could bring, and practical steps towards making it happen. I heartily recommend this book to anyone: young and old; deep environmentalist or environmental skeptic;high-powered businessman or local forager. The ideas will change the way you think about nature and, at the very least, encourage you get out there more often.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Presentation at FOSS4G</title>
   <link href="http://robinlovelace.github.com//2013/09/22/foss4g-presentation.html"/>
   <updated>2013-09-22T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2013/09/22/foss4g-presentation</id>
   <content type="html">&lt;p&gt;I presented last Thursday at &lt;a href=&quot;http://2013.foss4g.org/&quot;&gt;FOSS4G&lt;/a&gt;, THE conference to go to for Free Open Source Software for Geo applications (get it?). It was an interesting event, with hundreds of delegates dressing up in one form or another as Robin Hood, fantastic food and a very wide range of talks. Just take a look at the &lt;a href=&quot;http://2013.foss4g.org/conf/programme/daily/2/&quot;&gt;second day&lt;/a&gt; of talks: packed to the rafters with sessions, including &lt;a href=&quot;http://2013.foss4g.org/conf/programme/sessions/36/&quot;&gt;mine&lt;/a&gt;, on visualisation.&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;The slides can be seen below. With these as a backdrop, I discussed the various techniques I had used to ‘get my work out there’, to make it as accessible as possible to other people, especially those not involved in the stuffy world of academia. There was good feedback from the audience. Ben Hennig suggesting that I coloured only populated areas on my visualisations, to avoid attributing excessive visual importance to large uninhabited spaces. This technique can be witnessed to great effect on &lt;a href=&quot;http://oliverobrien.co.uk/2012/02/&quot;&gt;Olly O’brien’s blog&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;All of the talks were recorded, so if you are REALLY interested in the talk, you should also be able to listen to it - keep an eye out on the FOSS4G website to see when these go up live. For now, sit back and enjoy the visuals:&lt;/p&gt;

&lt;iframe src=&quot;http://www.slideshare.net/slideshow/embed_code/26396493&quot; width=&quot;427&quot; height=&quot;356&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px&quot; allowfullscreen=&quot;&quot; webkitallowfullscreen=&quot;&quot; mozallowfullscreen=&quot;&quot;&gt; &lt;/iframe&gt;
&lt;div style=&quot;margin-bottom:5px&quot;&gt; &lt;strong&gt; &lt;a href=&quot;https://www.slideshare.net/robinlovelace1985/visualising-the-energy-costs-of-commuting-26396493&quot; title=&quot;Visualising the energy costs of commuting&quot; target=&quot;_blank&quot;&gt;Visualising the energy costs of commuting&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href=&quot;http://www.slideshare.net/robinlovelace1985&quot; target=&quot;_blank&quot;&gt;Robin Lovelace&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>Mapping on Google Maps</title>
   <link href="http://robinlovelace.github.com//2013/09/12/mapping-fusion.html"/>
   <updated>2013-09-12T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2013/09/12/mapping-fusion</id>
   <content type="html">&lt;p&gt;Below is a map made by uploading my data to Google Fusion Tables using an online tool called &lt;a href=&quot;http://www.shpescape.com/&quot;&gt;shpescape&lt;/a&gt;. It shows the average energy costs of commuting to work in England, at the Ward level.&lt;/p&gt;

&lt;iframe width=&quot;600&quot; height=&quot;600&quot; scrolling=&quot;no&quot; frameborder=&quot;no&quot; src=&quot;https://www.google.com/fusiontables/embedviz?q=select+col2+from+1b37Wal1u5VWBne_uOpEjyNfyA1_Rk_5BprLTQbg&amp;amp;viz=MAP&amp;amp;h=false&amp;amp;lat=52.93871655962058&amp;amp;lng=-2.3290743055849816&amp;amp;t=1&amp;amp;z=5&amp;amp;l=col2&quot;&gt; &lt;/iframe&gt;

&lt;p&gt;Alasdaiar Rae has created a &lt;a href=&quot;http://undertheraedar.blogspot.co.uk/2011/10/mapping-methods.html&quot;&gt;basic tutorial&lt;/a&gt; on the use of Google Fusion Tables for hosting geographical information. The polygons in the above map were drastically simplified using the rgeos command gSimplify, to cut down on size. However, the zones are no longer contiguous. An alternative online tool for shapefile simplification is &lt;a href=&quot;http://mapshaper.org/&quot;&gt;mapshaper&lt;/a&gt;.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>E-Futures Presentation</title>
   <link href="http://robinlovelace.github.com//2013/09/12/e-futures-presentation.html"/>
   <updated>2013-09-12T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2013/09/12/e-futures-presentation</id>
   <content type="html">&lt;p&gt;&lt;a href=&quot;http://www.slideshare.net/robinlovelace1985/travelling-to-work-in-a-postcarbon-world&quot;&gt;These&lt;/a&gt; are the slides for my forthcoming talk at the E-Futures annual conference, in case anyone is interested in the content or links contained 
within.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Daily GPS data to study exploration of a new city</title>
   <link href="http://robinlovelace.github.com//2013/08/12/gps-exploration-new-city.html"/>
   <updated>2013-08-12T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2013/08/12/gps-exploration-new-city</id>
   <content type="html">&lt;p&gt;The inspiration for this idea came one night in Sheffield, dreaming of my move to Leeds. How would I fit-in to my new surroundings? How long would it take to adapt? What would I do? and, crucially for this idea, where would I go?&lt;/p&gt;

&lt;p&gt;With these thoughts bouncing around in my head, keeping me awake, the following plan was devised:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Keep the GPS on at all times&lt;/li&gt;
  &lt;li&gt;Save the waypoints periodically in a continuous track using Orux or another map service&lt;/li&gt;
  &lt;li&gt;Upload the data periodically to map-out my discovery of a new city&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This ideas would be fun but could also be useful: it could inform about ‘spatial bias’ and flag unexplored places. It also has big visualisation potential, both static and dynamic. Most grandly, making the dataset open source and free to anyone, it could potentially be used as a testbed by researchers interested in human behaviour in the city.&lt;/p&gt;

&lt;p&gt;Will this plan ever become reality? I hope so - will need to remember to charge my second-hand Galaxy S2 nightly for it to work!&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Austerity Sheffield</title>
   <link href="http://robinlovelace.github.com//2013/08/08/austerity-sheffield.html"/>
   <updated>2013-08-08T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2013/08/08/austerity-sheffield</id>
   <content type="html">&lt;p&gt;Here’s a little post about Austerity Sheffield, a new site about the impact of the spending cuts in South Yorkshire. You can find the website &lt;a href=&quot;http://jus.shef.ac.uk/mawebdissertations2013/austerity-sheffield/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The latest story is on McKenzie Friends, volunteers who help people in court with no legal representation. Check it out &lt;a href=&quot;http://jus.shef.ac.uk/mawebdissertations2013/austerity-sheffield/mckenzie-friends-legal-assistance-for/&quot;&gt;here&lt;/a&gt;!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Github pages - blogging for free</title>
   <link href="http://robinlovelace.github.com//2013/08/07/on-github-pages.html"/>
   <updated>2013-08-07T00:00:00+01:00</updated>
   <id>http://robinlovelace.github.com//2013/08/07/on-github-pages</id>
   <content type="html">&lt;p&gt;This is my first post on Github pages. For a while I’ve been sharing some thoughts and files with the world via my  &lt;a href=&quot;http://robinlovelace.wordpress.com/&quot;&gt;wordpress.com&lt;/a&gt; account.&lt;/p&gt;

&lt;p&gt;It’s a bit limited, so testing out &lt;a href=&quot;http://github.com/mojombo/jekyll/tree/master&quot;&gt;Jekyll&lt;/a&gt;, a website compiler and blogging platform written in Ruby.&lt;/p&gt;

&lt;p&gt;Instead of starting from scratch, I cloned &lt;a href=&quot;http://github.com/schacon/schacon.github.com&quot;&gt;Scott Chacon’s&lt;/a&gt; pages website.&lt;/p&gt;

&lt;p&gt;In Scott’s words, this is how it works: “I keep the source for
my blog in a specially named GitHub repository and every time I push to it, 
GitHub pixies automagically generate my static blog pages for me.”&lt;/p&gt;

&lt;p&gt;Because github can be used like dropbox to synch files directly with your computer, this essentially means that you have your entire personal website on your computer. This means no more logging-in and out of wordpress to change anything, rapid updates from the Linux command line (e.g. via ‘git commit’) and light-weight text-based editing of my posts.&lt;/p&gt;

&lt;p&gt;Final words: while I’ve built this site on the work of Scott, he built his on the work of others. “I copied the theme and javascript from from &lt;a href=&quot;http://github.com/mbleigh&quot;&gt;Michael Bleigh&lt;/a&gt;, and you’re welcome to copy
it from me, in turn (do remember to credit Michael, though).” Maybe one day someone will fork the project from me.&lt;/p&gt;

&lt;p&gt;Github rules!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Template</title>
   <link href="http://robinlovelace.github.com//1999/01/01/template.html"/>
   <updated>1999-01-01T00:00:00+00:00</updated>
   <id>http://robinlovelace.github.com//1999/01/01/template</id>
   <content type="html">&lt;!--more--&gt;

</content>
 </entry>
 
 
</feed>
